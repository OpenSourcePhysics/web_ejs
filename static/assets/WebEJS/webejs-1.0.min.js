var WebEJS_GEN;(WebEJS_GEN=WebEJS_GEN||{}).generate_code={addListing:function(e,t,n,a){var o=0;for(const i of t.split("\n"))o+=1,e.push(n+i+" // > "+a+" - line "+o)},appendCodeEnabled:function(e,t){for(const n of t){const t=n.Name.trim(),a=n.Active;e.push("    __pagesEnabled['"+t+"'] = "+a+";")}},appendInitializationCode:function(e,t){for(const n of t){const t=n.Name.trim(),a=n.Code;e.push("  _model.addToInitialization(function() {"),e.push("    if (!__pagesEnabled['"+t+"']) return;"),WebEJS_GEN.generate_code.addListing(e,a,"    ","Initialization page: "+t),e.push("  });\n")}},appendFixedRelationsCode:function(e,t){for(const n of t){const t=n.Name.trim(),a=n.Code;e.push("  _model.addToFixedRelations(function() {"),e.push("    if (!__pagesEnabled['"+t+"']) return;"),WebEJS_GEN.generate_code.addListing(e,a,"    ","Fixed Relations page: "+t),e.push("  });\n")}},appendCustomCode:function(e,t){for(const n of t){if("true"!=n.Active)continue;const t=n.Name.trim(),a=n.Code;WebEJS_GEN.generate_code.addListing(e,a,"  ","Custom code page: "+t),e.push("")}},appendEvolutionEnabled:function(e,t){for(const n of t){const t=n.Name.trim(),a=n.Active;if(e.push("    __pagesEnabled['"+t+"'] = "+a+";"),"ODE_EDITOR"==n.Type){if("Events"in n)for(const t of n.Events.pages){const n=t.Name.trim(),a=t.Active;e.push("    __pagesEnabled['"+n+"'] = "+a+";")}if("Discontinuities"in n)for(const t of n.Discontinuities.pages){const n=t.Name.trim(),a=t.Active;e.push("    __pagesEnabled['"+n+"'] = "+a+";")}if("ErrorHandling"in n)for(const t of n.ErrorHandling.pages){const n=t.Name.trim(),a=t.Active;e.push("    __pagesEnabled['"+n+"'] = "+a+";")}}}},appendEvolutionResetCode:function(e,t){e.push("  _model.addToReset(function() {"),e.push("    _privateOdesList=[];");for(var n=1;n<=t;n++)e.push("    _ODEi_evolution"+n+" = _ODE_evolution"+n+"();"),e.push("    _privateOdesList.push(_ODEi_evolution"+n+");");return e.push("  })\n"),t},appendEvolutionCode:function(e,t,n){n>0&&(e.push("  _model.addToInitialization(function() {"),e.push("    _initializeSolvers();"),e.push("  });"),e.push(""));var a=0;for(const n of t){const t=n.Name.trim();e.push("  _model.addToEvolution(function() {"),e.push("    if (!__pagesEnabled['"+t+"']) return;"),"ODE_EDITOR"==n.Type?(a+=1,e.push("    _ODEi_evolution"+a+".step();")):(pagecode=n.Code,WebEJS_GEN.generate_code.addListing(e,pagecode,"  ","Evolution page: "+t)),e.push("  })\n")}}},(WebEJS_GEN=WebEJS_GEN||{}).generate_model={getModelCode:function(e,t){const n=e.model,a=n.variables.pages,o=t?n.evolution.pages:null;var i=0,s=[];if(s.push("function _simulation (_topFrame, _libraryPath, _codebasePath, _inputParameters) {"),WebEJS_GEN.generate_model.__appendInitialCode(s,n,t),WebEJS_GEN.generate_variables.appendDefinition(s,a),t){WebEJS_GEN.generate_variables.appendSerializeCode(s,a);for(const e of o)"ODE_EDITOR"==e.Type&&i++;WebEJS_GEN.generate_ode.appendODEdeclaration(s,i),s.push("  _model.addToReset(function() {"),WebEJS_GEN.generate_code.appendCodeEnabled(s,n.initialization.pages),WebEJS_GEN.generate_code.appendEvolutionEnabled(s,o),WebEJS_GEN.generate_code.appendCodeEnabled(s,n.fixed_relations.pages),s.push("  });\n")}if(WebEJS_GEN.generate_variables.appendReset(s,a),t){s.push("  if (_inputParameters) {"),s.push("    _inputParameters = _model.parseInputParameters(_inputParameters);"),s.push("    if (_inputParameters) _model.addToReset(function() { _model._readParameters(_inputParameters); });"),s.push("  }\n"),i>0&&WebEJS_GEN.generate_ode.appendODEreset(s,i);const t="false"==e.information.RunAlways?"true":"false";s.push("  _model.addToReset(function() {"),WebEJS_GEN.generate_model.__appendModelParametersCode(s,n.evolution,"    ",t),s.push("  });\n")}if(WebEJS_GEN.generate_code.appendCustomCode(s,n.custom.pages),t&&(WebEJS_GEN.generate_code.appendInitializationCode(s,n.initialization.pages),WebEJS_GEN.generate_code.appendEvolutionCode(s,o,i),s.push("  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });\n"),WebEJS_GEN.generate_code.appendFixedRelationsCode(s,n.fixed_relations.pages),s.push("  // Intentionally repeated"),s.push("  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });\n"),i>0)){var r=[];for(const e of o)"ODE_EDITOR"==e.Type&&r.push(e);WebEJS_GEN.generate_ode.appendODEcode(s,r,a,!0)}s.push("  _model._fontResized = function(iBase,iSize,iDelta) {"),s.push("    _view._fontResized(iBase,iSize,iDelta);"),s.push("  }; // end of _fontResized\n");const l=e.view,c=WebEJS_GEN.generate_variables.getVariableList(a);WebEJS_GEN.generate_view.appendCreationCode(s,l,c,t),t&&WebEJS_GEN.generate_model.__appendModelParametersCode(s,n.evolution,"  ",""),s.push("  _createView(); // this includes _model.reset()"),s.push("  return _model;"),s.push("}\n");const u=t?e.description.pages:[];return{model:s.join("\n"),view:WebEJS_GEN.generate_view.getTreeCode(l.Tree,u,c,t)}},__appendInitialCode:function(e,t,n){e.push(WebEJS_GEN.generate_model.__INITIAL_CODE),n&&(WebEJS_GEN.generate_model.__addElementsCode(e,t),e.push(WebEJS_GEN.generate_model.__FULLMODEL_ADDITIONAL_CODE))},__appendModelParametersCode:function(e,t,n,a){var o=!1;for(const e of t.pages)if("true"==e.Active){o=!0;break}const i=t.information;o?(e.push(n+"_model.setAutoplay("+i.Autoplay+");"),a&&e.push(n+"_model.setPauseOnPageExit("+a+");")):e.push(n+"_model.setAutoplay(false);"),i.FPS.trim()?e.push(n+"_model.setFPS("+i.FPS+");"):e.push(n+"_model.setFPS(10);"),i.SPD.trim()?e.push(n+"_model.setStepsPerDisplay("+i.SPD+");"):e.push(n+"_model.setStepsPerDisplay(1);")},__getElementInfo:function(e,t){for(const n of t)if("elements"in n)for(const t of n.elements)if(t.classname==e)return t;return console.error("-----\x3e>>>> ERROR IN GENERATING MODEL ELEMENTS"),console.error("  : classname not supported: "+e),null},addElementsScriptCode:function(e,t,n){const a=t.elements.list;if(a.length<=0)return;const o=sMainGUI.getSystemInformation("model_elements");if(n){const t=[];for(const e of a){const n=WebEJS_GEN.generate_model.__getElementInfo(e.Classname,o);if(n)for(const e of n.js)t.includes(e)||t.push(e)}for(const n of t)e.push("<script src='"+sMainGUI.getSystemInformation("model_elements_folder")+n+"'><\/script>")}else{var i=[],s=[];for(const e of a){const t=WebEJS_GEN.generate_model.__getElementInfo(e.Classname,o);if(t){const n=t.lint_code.replaceAll("{{NAME}}",e.Name);i.includes(n)||i.push(n);const a=t.source_code.replaceAll("{{NAME}}",e.Name);s.includes(a)||s.push(a)}}e.push('<script type="text/javascript">\x3c!--//--\x3e<![CDATA[//>\x3c!--');for(const t of i)e.push("      "+t);e.push("");for(const t of s)e.push("      "+t);e.push("//--\x3e<!]]><\/script>\n")}},__addElementsCode:function(e,t){const n=t.elements.list;if(n.length<=0)return;const a=sMainGUI.getSystemInformation("model_elements");for(const t of n){const n=WebEJS_GEN.generate_model.__getElementInfo(t.Classname,a);if(n){const a=n.source_code.replaceAll("{{NAME}}",t.Name);e.push("  "+a)}}},__INITIAL_CODE:"\n  var _model = EJSS_CORE.createAnimationLMS();\n  var _view;\n  var _isPlaying = false;\n  var _isPaused = true;\n  var _isEPub = false;\n  var _isMobile = (navigator===undefined) ? false : navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i);\n\n  var _stringProperties = {};\n  var _tools = {\n    showInputDialog : EJSS_INTERFACE.BoxPanel.showInputDialog,\n    showOkDialog : EJSS_INTERFACE.BoxPanel.showOkDialog,\n    showOkCancelDialog : EJSS_INTERFACE.BoxPanel.showOkCancelDialog,\n    downloadText: EJSS_TOOLS.File.downloadText,\n    uploadText: function(action) { EJSS_TOOLS.File.uploadText(_model,action); } \n  };\n\n  function _play()  { _isPaused = false; _isPlaying = true;  _model.play();  }\n  function _pause() { _isPaused = true;  _isPlaying = false; _model.pause(); }\n  function _step()  { _pause();  _model.step(); }\n  function _reset() { _model.reset();  _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); }\n  _model._play  = _play;\n  _model._pause = _pause;\n  _model._step  = _step;\n  _model._reset = _reset;",__FULLMODEL_ADDITIONAL_CODE:"\n  function _update() { _model.update(); }\n  function _initialize() { _model.initialize(); }\n  function _setFPS(_fps) { _model.setFPS(_fps); }\n  function _setDelay(_delay) { _model.setDelay(_delay); }\n  function _setStepsPerDisplay(_spd) { _model.setStepsPerDisplay(_spd); }\n  function _setUpdateView(_updateView) { _model.setUpdateView(_updateView); }\n  function _setAutoplay(_auto) { _model.setAutoplay(_auto); }\n  function _println(_message) { console.log(_message); }\n  function _breakAfterThisPage() { _model.setShouldBreak(true); }\n  function _resetSolvers() { if (_model.resetSolvers) _model.resetSolvers(); }\n  function _saveText(name,type,content) { if (_model.saveText) _model.saveText(name,type,content); }\n  function _saveState(name) { if (_model.saveState) _model.saveState(name); }\n  function _saveImage(name,panelname) { if (_model.saveImage) _model.saveImage(name,panelname); }\n  function _readState(url,type) { if (_model.readState) _model.readState(url,type); }\n  function _readText(url,type,varname) { if (_model.readText) _model.readText(url,type,varname); }\n  // Is this still needed if we don't have locales???\n  function _getStringProperty(propertyName) {\n    var _value = _stringProperties[propertyName];\n    if (_value===undefined) return propertyName;\n    else return _value;\n  }\n\n  var __pagesEnabled = [];\n  function _setPageEnabled(pageName,enabled) { __pagesEnabled[pageName] = enabled; }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_ode={appendODEdeclaration:function(e,t){const n=[];if(t>0){e.push("  var _privateOdesList;");for(var a=1;a<=t;a++)e.push("  var _ODEi_evolution"+a+";"),1==a?n.push("_ODEi_evolution"+a):n.push(",_ODEi_evolution"+a),e.push("  var _userEvents"+a+" = [];\n")}e.push("  _model.getOdes = function() { return ["+n.join("")+"]; }\n"),e.push("  _model.removeEvents = function(){");for(a=1;a<=t;a++)e.push("    _userEvents"+a+" = [];");e.push("  }\n")},appendODEreset:function(e,t){e.push("  _model.addToReset(function() {"),e.push("    _privateOdesList=[];");for(var n=1;n<=t;n++)e.push("    _ODEi_evolution"+n+" = _ODE_evolution"+n+"();"),e.push("    _privateOdesList.push(_ODEi_evolution"+n+");");e.push("  });\n")},appendODEcode:function(e,t,n,a){if(a){e.push(WebEJS_GEN.generate_ode.INIT_SOLVER_PIECE),e.push("  _getODE = function (_odeName) {");var o=1;for(const n of t)e.push("    if (_odeName=='"+n.Name+"') return _ODEi_evolution"+o+";"),o++;e.push("    return null;"),e.push("  }"),e.push(WebEJS_GEN.generate_ode.GET_EVENT_SOLVER_PIECE),o=1;for(const a of t){const t=WebEJS_GEN.generate_ode.oneODE(a,o,n);t.appendCode(e),t.appendHistoricFunctionsCode(e),o++}}else for(const n of t)for(const t of n.Equations)t.state.trim()&&e.push("  function _historic_"+t.state+"(__time) {}")},oneODE:function(e,t,n){var a={};a.odePage=e,a.pageIndex=t,a.indepVar=e.IndependentVariable,a.eqnList=[],a.followedByDerivative=[];for(const t of e.Equations){const e=t.state.trim(),i=t.rate.trim();if(e.length<=0||i.length<=0)continue;i.endsWith(";")&&(i=i.slice(0,-1));const s=e.indexOf("[");var o=!0;if(s<0&&(o=WebEJS_GEN.generate_variables.isArrayOfDouble(n,e)),o)if(s<0){WebEJS_GEN.generate_variables.isArrayOfDouble(n,i)?a.eqnList.push({state:e,index:"__i",rate:i+"[__i]"}):a.eqnList.push({state:e,index:"__i",rate:i})}else{const t=[];for(const n of e.split(/\s+|\[|\]/))n&&t.push(n);const n=t.pop(0);t.len<=0?a.eqnList.push({state:n,rate:i}):a.eqnList.push({state:n,index:t.pop(0),rate:i})}else a.eqnList.push({state:e,rate:i})}if(a.eqnList.length>0)for(var i=a.eqnList[0].rate,s=1;s<a.eqnList.length;s++){const e=a.eqnList[s];var r=e.state;"index"in e&&(r+="["+e.index+"]"),r==i&&a.followedByDerivative.push(a.eqnList[s-1]),i=e.state}if(e.Method.toLowerCase().indexOf("verlet")>=0)for(s=0;s<a.eqnList.length-1;s+=2)a.followedByDerivative.includes(a.eqnList[s])||alert("ODE error! Verlet order not respected in ODE page : "+e.Name);return a.appendHistoricFunctionsCode=function(e){const t="_ODEi_evolution"+a.pageIndex;var n="0";for(const o of a.eqnList){const a=o.state;if(e.push("  function _historic_"+a+"(__time) {"),"index"in o){const o=a+".length";e.push("    var __beginIndex = "+n+";"),e.push("    return "+t+".getEventSolver().getStateHistory().interpolate(__time,new Array("+o+"),__beginIndex,"+o+");"),e.push("  }\n"),n+=" + "+o}else e.push("    var __index = "+n+";"),e.push("    return "+t+".getEventSolver().getStateHistory().interpolate(__time,_index);"),e.push("  }\n"),n+=" + 1 "}},a.appendCode=function(e){const t=a.odePage.Name,n="false"==a.odePage.ForceSynchronization,o=a.__setStateFromVariablesTemplate(!1),i=n?a.__setStateFromVariablesTemplate(!0):o,s=a.__getVariablesFromStateTemplate(!1),r=a.__getVariablesFromStateTemplate(!0),l="Events"in a.odePage?a.odePage.Events.pages:[],c="Discontinuities"in a.odePage?a.odePage.Discontinuities.pages:[];e.push("  function _ODE_evolution"+a.pageIndex+"() {"),e.push("    var __odeSelf = {};"),e.push("    var __eventSolver;"),e.push("    var __solverClass = _getEngineSolverClass('"+a.odePage.Method+"');"),e.push("    var __state=[];");for(var u=1;u<=l.length;u++)e.push("    var _ODE_evolution"+a.pageIndex+"_Event"+u+";");for(u=1;u<=c.length;u++)e.push("    var _ODE_evolution"+a.pageIndex+"_Discontinuity"+u+";");a.odePage.ErrorHandling.pages.length<=0&&e.push("    var __ignoreErrors=false;"),e.push("    var __mustInitialize=true;"),e.push("    var __isEnabled=true;"),e.push("    var __mustUserReinitialize=false;"),n&&e.push("    var __mustReinitialize=true;\n");for(const t of a.eqnList)"index"in t&&e.push("    var _"+t.state+"Length;");e.push("\n    __odeSelf._getOdeVars = function (){ return "+a.__getVarsNames()+"; }\n"),e.push("    __odeSelf.setSolverClass = function(__aSolverClass) {"),e.push("      __solverClass = __aSolverClass;"),e.push("      __instantiateSolver();"),e.push("    }\n"),e.push("    function __instantiateSolver() {"),e.push("      __state=[];");for(const t of a.eqnList)"index"in t&&e.push("      _"+t.state+"Length = "+t.state+".length;");e.push("      __pushState();"),e.push("      __eventSolver = EJSS_ODE_SOLVERS.interpolatorEventSolver(__solverClass(),__odeSelf);"),e.push("      __mustInitialize = true;"),e.push("    }\n"),e.push("    __odeSelf.setEnabled = function(_enabled) { __isEnabled = _enabled; }\n"),e.push("    __odeSelf.getIndependentVariableValue = function() { return __eventSolver.getIndependentVariableValue(); }\n"),e.push("    __odeSelf.getInternalStepSize = function() { return __eventSolver.getInternalStepSize(); }\n"),e.push("    __odeSelf.isAccelerationIndependentOfVelocity = function() { return "+a.odePage.AccelerationIndependentOfVelocity+"; }\n"),e.push("    __odeSelf.initializeSolver = function() {"),e.push("      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); return; }"),e.push("      __pushState();");const d="Increment"in a.odePage?a.odePage.Increment.trim():"0",p="InternalStep"in a.odePage?a.odePage.InternalStep.trim():"",m="MemoryLength"in a.odePage?a.odePage.MemoryLength.trim():"",g="MaximumStep"in a.odePage?a.odePage.MaximumStep.trim():"",f=a.odePage.MaximumNumberOfSteps.trim();p?e.push("      __eventSolver.initialize("+p+");"):e.push("      __eventSolver.initialize("+d+");"),e.push("      __eventSolver.setBestInterpolation("+a.odePage.UseBestInterpolation+");"),m&&e.push("      __eventSolver.setHistoryLength("+m+");"),g&&e.push("      __eventSolver.setMaximumInternalStepSize("+g+");"),f&&e.push("      __eventSolver.setMaximumInternalSteps("+f+");"),e.push("      __eventSolver.removeAllEvents();");for(u=1;u<=l.length;u++){const t=l[u-1];e.push("      if (__pagesEnabled['"+t.Name+"']) __eventSolver.addEvent(_ODE_evolution"+a.pageIndex+"_Event"+u+"());")}for(u=1;u<=c.length;u++){const t=c[u-1];e.push("      if (__pagesEnabled['"+t.Name+"']) __eventSolver.addDiscontinuity(_ODE_evolution"+a.pageIndex+"_Discontinuity"+u+"());")}e.push("      for (k in _userEvents"+a.pageIndex+") {__eventSolver.addEvent(_userEvents"+a.pageIndex+"[k]);}"),"ZenoEffect"in a.odePage&&a.odePage.ZenoEffect.Code&&e.push("      __eventSolver.addZenoEffectListener(__odeSelf);"),e.push("      __eventSolver.setEstimateFirstStep("+a.odePage.EstimateFirstStep+");"),e.push("      __eventSolver.setEnableExceptions(false);");const h=a.odePage.AbsoluteTolerance.trim();var b="";if(h){var v="RelativeTolerance"in a.odePage?a.odePage.RelativeTolerance.trim():null;v||(v=h),b="setTolerances("+h+","+v+")"}b&&e.push("      __eventSolver."+b+";"),n&&e.push("      __mustReinitialize = true;"),e.push("      __mustInitialize = false;"),e.push("    }\n"),e.push("    function __pushState() {"),e.push(i.replaceAll("{{PREFIX}}","      ").replaceAll("{{STATE_STR}}","__state")),e.push("    }\n"),e.push("    function __arraysChanged () {");for(var _=0;_<a.eqnList.length;_++){const t=a.eqnList[_];if("index"in t){const n=t.state;e.push("      if (_"+n+"Length != "+n+".length) return true;")}}if(e.push("      return false;"),e.push("    }\n"),e.push("    __odeSelf.getEventSolver = function() {"),e.push("      return __eventSolver;"),e.push("    }\n"),e.push("    __odeSelf.resetSolver = function() {"),e.push("      __mustUserReinitialize = true;"),e.push("    }\n"),e.push("    __odeSelf.automaticResetSolver = function() {"),n&&e.push("      __mustReinitialize = true;"),e.push("    }\n"),e.push("    function __errorAction () {"),a.odePage.ErrorHandling.pages.length>0){n&&(e.push("      // Make sure the solver is reinitialized;"),e.push("      __mustReinitialize = true;")),e.push("      var _errorCode = __eventSolver.getErrorCode();");for(const n of a.odePage.ErrorHandling.pages){const a=n.Name,o=n.Type,i=n.Code,s=n.Comment;e.push("      if (__pagesEnabled['"+a+"']) {"),"ANY_ERROR"==o?e.push("        { // For any error: "+s):e.push("        if (__eventSolver.getErrorCode()==EJSS_ODE_SOLVERS.ERROR."+o+") { // "+s),WebEJS_GEN.generate_code.addListing(e,i,"          ","ErrorHandler for "+t+" - "+a),e.push("        }"),e.push("      }")}}else e.push("      if (__ignoreErrors) return;"),e.push("      console.log (__eventSolver.getErrorMessage());"),e.push("      if (window.confirm('Numerical solver error. Continue the simulation?')) __ignoreErrors = true;"),e.push("      else _pause();"),n&&(e.push("      // Make sure the solver is reinitialized;"),e.push("      __mustReinitialize = true;"));if(e.push("    }\n"),e.push("    __odeSelf.step = function() { return __privateStep(false); }\n"),e.push("    __odeSelf.solverStep = function() { return __privateStep(true); }\n"),e.push("    function __privateStep(__takeMaximumStep) {"),e.push("      if (!__isEnabled) return 0;"),e.push("      if ("+d+"===0) return 0;"),e.push("      if (__mustInitialize) __odeSelf.initializeSolver();"),e.push("      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); }"),e.push("      __eventSolver.setStepSize("+d+");"),p?e.push("      __eventSolver.setInternalStepSize("+p+");"):e.push("      __eventSolver.setInternalStepSize("+d+");"),m&&e.push("      __eventSolver.setHistoryLength("+m+");"),g&&e.push("      __eventSolver.setMaximumInternalStepSize("+g+");"),f&&e.push("      __eventSolver.setMaximumInternalSteps("+f+");"),"EventMaximumStep"in a.odePage){const t=a.odePage.EventMaximumStep.trim();t&&e.push("      __eventSolver.setMaximumEventStep("+t+");")}if(b&&e.push("      __eventSolver."+b+";"),e.push("      __pushState();"),e.push("      if (__mustUserReinitialize) {"),e.push("        __eventSolver.userReinitialize();"),e.push("        __mustUserReinitialize = false;"),n&&e.push("        __mustReinitialize = false;"),e.push("        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),e.push("      }"),n?(e.push("      else if (__mustReinitialize) {"),e.push("        __eventSolver.reinitialize();"),e.push("        __mustReinitialize = false;"),e.push("        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),e.push("      }")):(e.push("      __eventSolver.reinitialize(); // force synchronization: inefficient!"),e.push("      if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();")),e.push("      var __stepTaken = __takeMaximumStep ? __eventSolver.maxStep() : __eventSolver.step();"),e.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","      ")),e.push("      // Check for error"),e.push("      if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();"),e.push("      return __stepTaken;"),e.push("    }\n"),e.push("    __odeSelf.getState = function() { return __state; }\n"),"DelayList"in a.odePage&&a.odePage.DelayList.trim()){e.push("    __odeSelf.setStateHistory = function(_history) { }; // deliberately left empty\n"),e.push("    __odeSelf.getDelays = function(__aState) {"),e.push(r.replaceAll("{{STATE_STR}}","__aState").replaceAll("{{PREFIX}}","      ")),e.push("      return ["+a.odePage.DelayList+"];"),e.push("    }\n"),e.push("    __odeSelf.getMaximumDelay = function() {");const n=a.odePage.DelayMaximum.trim();n?e.push("      return "+n+";"):(e.push("      var _delaysArray = __odeSelf.getDelays(__state);"),e.push("      var _maximum = Number.POSITIVE_INFINITY;"),e.push("      for (var _i=0,_n=_delaysArray.length; _i<_n; _i++) _maximum = Math.max(_maximum,Math.abs(_delaysArray[_i]));"),e.push("      return _maximum;")),e.push("    }\n"),e.push("    __odeSelf.getInitialConditionDiscontinuities = function() {"),e.push("      return ["+a.odePage.DelayAddDiscont+"];"),e.push("    }\n"),e.push("    function _userDefinedInitialCondition(_time) {"),e.push("      // In case it uses the independent variable"),e.push("      var "+a.indepVar+" = _time;"),a.odePage.DelayInitialCondition.Code.trim()?WebEJS_GEN.generate_code.addListing(e,a.odePage.DelayInitialCondition.Code,"      ","Delay initial conditions page: "+t):(e.push("      return []; // > Error? Delay initial conditions page NOT SET: "+t),alert("DDE error! Initial conditions for DDE not set in page "+t)),e.push("    }\n"),e.push("    __odeSelf.getInitialCondition = function(_time, _state) {"),e.push("      var _userDelayInitCond = _userDefinedInitialCondition(_time);"),e.push("      if (_userDelayInitCond!==null) {"),e.push("        for (var _i=0, _n=_state.length-1; _i<_n; _i++) _state[_i] = _userDelayInitCond[_i];"),e.push("        _state[_state.length-1] = _time;"),e.push("      }"),e.push("    }\n")}e.push("    __odeSelf.getRate = function(_aState,_aRate) {"),a.odePage.PreliminaryCode.Code.trim()?(e.push("      _aRate[_aRate.length-1] = 0.0; // In case the prelim code returns"),e.push("      var __index=-1; // so that it can be used in preliminary code"),e.push(r.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),e.push("      // Preliminary code: "+a.odePage.PreliminaryCode.Comment),WebEJS_GEN.generate_code.addListing(e,a.odePage.PreliminaryCode.Code,"      ","Preliminary code for ODE "+t)):e.push(r.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),a.__computeRateCode(e,"Rate for ODE: "+t),e.push("    } //end of getRate\n"),"ZenoEffect"in a.odePage&&a.odePage.ZenoEffect.Code.trim()&&(e.push("    // Implementation of org.opensourcephysics.numerics.ZenoEffectListener"),e.push("    __odeSelf.zenoEffectAction = function(_anEvent, _aState) {"),e.push(s.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),WebEJS_GEN.generate_code.addListing(e,a.odePage.ZenoEffect.Code,"        ","Zeno code for ODE."+t),e.push(o.replaceAll("{{PREFIX}}","      ").replaceAll("{{STATE_STR}}","_aState")),e.push("        return "+a.odePage.ZenoEffect.StopAfterEffect+";"),e.push("      }\n")),e.push(WebEJS_GEN.generate_ode.BLOCKLY_ADD_EVENT_PIECE.replaceAll("{{EXTRACT_VARIABLES_A_STATE}}",r.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","          ")).replaceAll("{{EXTRACT_VARIABLES_STATE}}",s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","          ")).replaceAll("{{UPDATE_VARIABLES_STATE}}",o.replaceAll("{{PREFIX}}","          ").replaceAll("{{STATE_STR}}","__state")).replaceAll("{{PAGE_INDEX}}",a.pageIndex));for(u=0;u<l.length;u++){const n=l[u];e.push("    _ODE_evolution"+a.pageIndex+"_Event"+(u+1)+" = function() {"),e.push("      var _eventSelf = {};"),e.push("      _eventSelf.getTypeOfEvent = function() { return EJSS_ODE_SOLVERS.EVENT_TYPE."+n.EventType+"; }"),e.push("      _eventSelf.getRootFindingMethod = function() { return EJSS_ODE_SOLVERS.EVENT_METHOD."+n.Method+"; }"),e.push("      _eventSelf.getMaxIterations = function() { return "+n.Iterations+"; }"),"Tolerance"in n&&n.Tolerance.trim()?e.push("      _eventSelf.getTolerance = function() { return "+n.Tolerance+"; }"):e.push("      _eventSelf.getTolerance = function() { return "+h+"; }\n"),e.push("      _eventSelf.evaluate = function(_aState) {"),e.push(r.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","        ")),WebEJS_GEN.generate_code.addListing(e,n.ZeroCondition,"        ","Event zero-condition for page "+t),e.push("      }\n"),e.push("      _eventSelf.action = function() {"),e.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","        ")),e.push("        var _returnValue = __userDefinedAction();"),e.push(o.replaceAll("{{PREFIX}}","        ").replaceAll("{{STATE_STR}}","__state")),e.push("        return _returnValue;"),e.push("      }\n"),e.push("      function __userDefinedAction() {"),WebEJS_GEN.generate_code.addListing(e,n.Action,"        ","Event action for page "+t),e.push("        return "+n.StopAtEvent+";"),e.push("      }"),e.push("      return _eventSelf;"),e.push("    } // End of event\n")}for(u=0;u<c.length;u++){const n=c[u];e.push("    _ODE_evolution"+a.pageIndex+"_Discontinuity"+(u+1)+" = function() {"),e.push("      var _discontinuitySelf = {};\n"),"Tolerance"in n&&n.Tolerance?e.push("      _discontinuitySelf.getTolerance = function() { return "+n.Tolerance+"; }\n"):e.push("      _discontinuitySelf.getTolerance = function() { return "+h+"; }\n"),e.push("      _discontinuitySelf.evaluate = function(_aState) {"),e.push(r.replaceAll("{{STATE_STR}}","_aState").replaceAll("{{PREFIX}}","      ")),WebEJS_GEN.generate_code.addListing(e,n.ZeroCondition,"        ","Discontinity zero-condition for page "+t),e.push("      }\n"),e.push("      _discontinuitySelf.action = function() {"),e.push(s.replaceAll("{{STATE_STR}}","__state").replaceAll("{{PREFIX}}","        ")),e.push("        var _returnValue = __userDefinedAction();"),e.push(o.replaceAll("{{PREFIX}}","        ").replaceAll("{{STATE_STR}}","__state")),e.push("        return _returnValue;"),e.push("      }\n"),e.push("      function __userDefinedAction() {"),WebEJS_GEN.generate_code.addListing(e,n.Action.trim(),"        ","Discontinuity action for page "+t),e.push("        return "+n.StopAtDiscontinuity+";"),e.push("      }\n"),e.push("      return _discontinuitySelf;"),e.push("    } // End of discontinuity\n")}e.push("    __instantiateSolver();"),e.push("    return __odeSelf;"),e.push("  }\n")},a.__getVarsNames=function(){for(var e="[",t=0;t<a.eqnList.length;t++){const n=a.eqnList[t].state;e+=0==t?"'"+n+"'":",'"+n+"'"}return a.eqnList.length>0?e+=",'"+a.indepVar+"']":e+="'"+a.indepVar+"']",e},a.__computeRateCode=function(e,t){e.push("      // Compute the rate"),e.push("      var __cRate=0;");const n=["__i"];for(var o=!1,i=0;i<a.eqnList.length;i++){if(o){o=!1;continue}const s=a.eqnList[i],r=s.state,l=" // "+t+" : "+r,c=s.rate;if("index"in s){const u=s.index.trim();if(n.includes(u)||(e.push("      var "+u+";"),n.push(u)),a.followedByDerivative.includes(s)){const n=a.eqnList[i+1],s=n.state,d=n.rate;e.push("      for ("+u+"=0;"+u+"<_"+r+"Length;"+u+"++) { // These two alternate in the state"),e.push("        _aRate[__cRate++] = Array.isArray("+c+") ? "+c+"["+u+"] : "+c+";"+l),e.push("        _aRate[__cRate++] = Array.isArray("+d+") ? "+d+"["+u+"] : "+d+"; // "+t+" :"+s),e.push("      }"),o=!0}else e.push("      for ("+u+"=0;"+u+"<_"+r+"Length;"+u+"++) {"),e.push("        _aRate[__cRate++] = Array.isArray("+c+") ? "+c+"["+u+"] : "+c+";"+l),e.push("      }")}else e.push("      _aRate[__cRate++] = "+c+";"+l)}e.push("      _aRate[__cRate++] = 1; // independent variable"),e.push("      return _aRate;")},a.__setStateFromVariablesTemplate=function(e){const t=[];t.push("{{PREFIX}}// Copy our variables to {{STATE_STR}}[]"),t.push("{{PREFIX}}var __j=0;"),t.push("{{PREFIX}}var __n=0;"),t.push("{{PREFIX}}var __cIn=0;");for(var n=!1,o=0;o<a.eqnList.length;o++){if(n){n=!1;continue}const i=a.eqnList[o],s=i.state;if("index"in i)if(a.followedByDerivative.includes(i)){const i=a.eqnList[o+1].state;e&&(t.push("{{PREFIX}}if (!__mustReinitialize)"),t.push("{{PREFIX}}  for (__j=0,__n=__cIn; __j<_"+s+"Length; __j++)"),t.push("{{PREFIX}}    if ({{STATE_STR}}[__n++]!="+s+"[__j] || {{STATE_STR}}[__n++]!="+i+"[__j]) { __mustReinitialize = true; break; }")),t.push("{{PREFIX}}for (__j=0; __j<_"+s+"Length; __j++) { // These two alternate in the state"),t.push("{{PREFIX}}   {{STATE_STR}}[__cIn++] = "+s+"[__j];"),t.push("{{PREFIX}}   {{STATE_STR}}[__cIn++] = "+i+"[__j];"),t.push("{{PREFIX}}}"),n=!0}else e&&(t.push("{{PREFIX}}if (!__mustReinitialize)"),t.push("{{PREFIX}}  for (__j=0,__n=__cIn; __j<_"+s+"Length; __j++)"),t.push("{{PREFIX}}     if ({{STATE_STR}}[__n++]!="+s+"[__j]) { __mustReinitialize = true; break; }")),t.push("{{PREFIX}}  for (__j=0;__j<_"+s+"Length; __j++) {"),t.push("{{PREFIX}}    {{STATE_STR}}[__cIn++] = "+s+"[__j];"),t.push("{{PREFIX}}  }");else e&&t.push("{{PREFIX}}if ({{STATE_STR}}[__cIn]!="+s+") __mustReinitialize = true;"),t.push("{{PREFIX}}{{STATE_STR}}[__cIn++] = "+s+";")}return e&&t.push("{{PREFIX}}if ({{STATE_STR}}[__cIn]!="+a.indepVar+") __mustReinitialize = true;"),t.push("{{PREFIX}}{{STATE_STR}}[__cIn++] = "+a.indepVar+";"),t.join("\n")},a.__getVariablesFromStateTemplate=function(e){const t=[];t.push("{{PREFIX}}// Extract our variables from {{STATE_STR}}"),t.push("{{PREFIX}}var __i=0;"),t.push("{{PREFIX}}var __cOut=0;");for(var n=!1,o=0;o<a.eqnList.length;o++){if(n){n=!1;continue}const i=a.eqnList[o],s=i.state;if("index"in i)if(e&&t.push("{{PREFIX}}var "+s+" = [];"),a.followedByDerivative.includes(i)){const i=a.eqnList[o+1].state;e&&t.push("{{PREFIX}}var "+i+" = [];"),t.push("{{PREFIX}}for (__i=0; __i<_"+s+"Length; __i++) { // These two alternate in the state"),t.push("{{PREFIX}}  "+s+"[__i] = {{STATE_STR}}[__cOut++];"),t.push("{{PREFIX}}  "+i+"[__i] = {{STATE_STR}}[__cOut++];"),t.push("{{PREFIX}}}"),n=!0}else t.push("{{PREFIX}}for (__i=0;__i<_"+s+"Length; __i++) {"),t.push("{{PREFIX}}  "+s+"[__i] = {{STATE_STR}}[__cOut++];"),t.push("{{PREFIX}}}");else e?t.push("{{PREFIX}}var "+s+" = {{STATE_STR}}[__cOut++];"):t.push("{{PREFIX}}"+s+" = {{STATE_STR}}[__cOut++];")}return e?t.push("{{PREFIX}}var "+a.indepVar+" = {{STATE_STR}}[__cOut++];"):t.push("{{PREFIX}}"+a.indepVar+" = {{STATE_STR}}[__cOut++];"),t.join("\n")},a},INIT_SOLVER_PIECE:"\n  function _initializeSolvers() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].initializeSolver();\n  }\n\n  function _automaticResetSolvers() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].automaticResetSolver();\n  }\n\n  _model.resetSolvers = function() {\n    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].resetSolver();\n  }\n",GET_EVENT_SOLVER_PIECE:"\n  function _getEventSolver(_odeName) {\n    var ode = _getODE(_odeName);\n    if (ode===null) return null;\n    return ode.getEventSolver();\n  }\n\n  function _getEngineSolverClass(classname) {\n    classname = classname.toLowerCase();\n    if (classname.indexOf('rungekuttafehlberg')>=0) return EJSS_ODE_SOLVERS.cashKarp45;\n    if (classname.indexOf('cash')>=0)   return EJSS_ODE_SOLVERS.cashKarp45;\n    if (classname.indexOf('boga')>=0)   return EJSS_ODE_SOLVERS.bogackiShampine23;\n    if (classname.indexOf('dopri5')>=0) return EJSS_ODE_SOLVERS.doPri5;\n    if (classname.indexOf('dopri8')>=0) return EJSS_ODE_SOLVERS.doPri853;\n    if (classname.indexOf('richa')>=0)  return EJSS_ODE_SOLVERS.eulerRichardson;\n    if (classname.indexOf('euler')>=0)  return EJSS_ODE_SOLVERS.euler;\n    if (classname.indexOf('fehlberg78')>=0) return EJSS_ODE_SOLVERS.fehlberg78;\n    if (classname.indexOf('fehlberg8')>=0)  return EJSS_ODE_SOLVERS.fehlberg8;\n    //if (classname.indexOf('radau')>=0)  return EJSS_ODE_SOLVERS.radau5;\n    if (classname.indexOf('runge')>=0)  return EJSS_ODE_SOLVERS.rungeKutta4;\n    if (classname.indexOf('verlet')>=0) return EJSS_ODE_SOLVERS.velocityVerlet;\n    return EJSS_ODE_SOLVERS.rungeKutta4;\n  }\n\n  function _setSolverClass(_odeName, _engine) {\n    var ode = _getODE(_odeName);\n    if (ode===null) return;\n    if (!_engine.setODE) _engine = _getEngineSolverClass(_engine);\n    if (_engine) ode.setSolverClass(_engine);\n  }\n",BLOCKLY_ADD_EVENT_PIECE:"\n    __odeSelf._addEvent = function(userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent) {\n    \n      var __User_Event = function (userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent) {\n        var _eventSelf = {};\n        _eventSelf.getTypeOfEvent = function() { return eventType; }\n        _eventSelf.getRootFindingMethod = function() { return eventMethod; }\n        _eventSelf.getMaxIterations = function() { return maxIter; }\n        _eventSelf.getTolerance = function() { return eventTolerance; }\n\n        _eventSelf.evaluate = function(_aState) {\n{{EXTRACT_VARIABLES_A_STATE}}\n          return eval(userCondition);\n        }\n\n        _eventSelf.action = function() {\n{{EXTRACT_VARIABLES_STATE}}\n          var _returnValue = __userDefinedAction();\n{{UPDATE_VARIABLES_STATE}}\n          return _returnValue;\n        }\n\n        function __userDefinedAction() {\n          if (undefined != functions) eval(functions.toString());\n          eval(userAction);\n          return endAtEvent;\n        }\n\n        return _eventSelf;\n      } // End of event\n     _userEvents{{PAGE_INDEX}}.push(__User_Event(userCondition,userAction,eventType,eventMethod,maxIter,eventTolerance,endAtEvent));\n    }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_variables={getVariableList:function(e){var t=[];for(const a of e)if("true"==a.Active)for(const e of a.Variables){const a=e.Name.trim();if(a){var n=a.indexOf("[");n<0?t.push(a):t.push(a.substring(0,n))}}return t},isArrayOfDouble:function(e,t){const n=function(e,t){for(const n of e)if("true"==n.Active)for(const e of n.Variables)if(e.Name==t)return e;return null}(e,t);if(!n)return!1;const a=n.Dimension.replaceAll(" ","");return a&&a.trim().length>0},appendDefinition:function(e,t){function n(e){var t=e.indexOf("[");return t<0?e:e.substring(0,t)}for(const o of t)if("true"==o.Active){const t=o.Name;for(const i of o.Variables){var a=i.Name.trim();a&&(a=n(a),e.push("  var "+a+"; // Model.Variables."+t+"."+a))}e.push("")}},appendSerializeCode:function(e,t){function n(e,t){for(const a of e)if("true"==a.Active)for(const e of a.Variables){const a=e.Name.trim();if(a){var n=a.indexOf("[");if(n<0)t(e,a,"");else{const o=a.substring(0,n),i=a.substring(n+1);t(e,o,(n=i.indexOf("]"))<0?"__i":i.substring(0,n))}}}}e.push("  function _serialize() { return _model.serialize(); }\n"),e.push("  _model._userSerialize = function() {");var a=[];n(t,((e,t,n)=>{a.push(t+" : "+t)})),e.push("    return { "+a.join(", ")+" };"),e.push("  }"),e.push("  function _serializePublic() { return _model.serializePublic(); }\n"),e.push("  _model._userSerializePublic = function() {"),a=[],n(t,((e,t,n)=>{"domain"in e?(e.domain.includes("public")||e.domain.includes("output"))&&a.push(t+" : "+t):a.push(t+" : "+t)})),e.push("    return { "+a.join(", ")+" };"),e.push("  }\n"),e.push("  _model._readParameters = function(json) {"),n(t,((t,n,a)=>{e.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";")})),e.push("  }\n"),e.push("  _model._readParametersPublic = function(json) {"),n(t,((t,n,a)=>{"domain"in t?(t.domain.includes("public")||t.domain.includes("output"))&&e.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";"):e.push("    if(typeof json."+n+" != 'undefined') "+n+" = json."+n+";")})),e.push("  }"),e.push(WebEJS_GEN.generate_variables.__FINAL_SERIALIZE_CODE)},appendReset:function(e,t){function n(e){var t=[];for(const n of e.split(/\s+|\[|\]/))n&&t.push(n);return t}function a(e,t,a,o,i,s){if(!s){return e+o+" = new Array("+n(i).shift()+"); "+t}if(s.startsWith("new ")||s.startsWith("["))return e+o+" = "+s+"; "+t;const r=[],l=n(i);r.push(e+o+" = new Array("+l[0]+"); "+t),r.push(e+"(function () {"),prefix="  "+e,accumIndexStr="";var c=null;const u=l.length;if(a)c=a.split(","),r.push(prefix+"var "+a+";");else if(u>1){for(var d="",p=1;p<u;p++)d+=", _i"+p;r.push(prefix+"var _i0"+d+";")}else r.push(prefix+"var _i0;");for(p=0;p<u;p++){const e=l.shift();var m=a?c.shift().trim():"_i"+p;r.push(prefix+"for ("+m+"=0; "+m+"<"+e+"; "+m+"+=1) { "+t),prefix+="  ",accumIndexStr+="["+m+"]",p<u-1?r.push(prefix+o+accumIndexStr+" = [];"):r.push(prefix+o+accumIndexStr+" = "+s+"; "+t)}for(p=0;p<u;p++)prefix=prefix.substring(2),r.push(prefix+"}");return r.push(e+"}());"),r.join("\n")}for(const r of t){if("true"!=r.Active)continue;const t=r.Name;e.push("  _model.addToReset(function() { // Reset of "+t);for(const l of r.Variables){const r=l.Name.trim();if(!r)continue;const c=l.Value.trim(),u=l.Dimension.replaceAll(" ","");var o="// Model.Variables."+t+"."+r;if(u&&u.trim()){var i=r;const l=n(u).length,d=n(i),p=d.length;var s=null;if(p>1){i=d.shift();for(s=d.shift();d.length>0;)s+=", "+d.shift();p-1!=l&&alert("Syntax error: Dimension brackets in variable name "+r+" ("+t+") do not match the dimension "+u)}e.push(a("    ",o,s,i,u,c))}else c&&e.push("    "+r+" = "+c+"; "+o)}e.push("  }); // End of reset of "+t+"\n")}},__FINAL_SERIALIZE_CODE:"\n  function _unserializePublic(json) { return _model.unserializePublic(json); }\n\n  _model._userUnserializePublic = function(json) {\n    _model._readParametersPublic(json);\n    _resetSolvers();\n    _model.update();\n  }\n\n  function _unserialize(json) { return _model.unserialize(json); }\n\n  _model._userUnserialize = function(json) {\n    _model._readParameters(json);\n    _resetSolvers();\n    _model.update();\n  }\n"},(WebEJS_GEN=WebEJS_GEN||{}).generate_view={__getPropertyInfo:function(e,t){for(const n of e)if(n.name==t)return n;return{}},__getElementPropertyList:function(e){const t=e.split("."),n=sMainGUI.getSystemInformation("view_elements_info")[t[0]][t[1]];var a=[];return"properties"in n&&a.push(...n.properties),"parent"in n&&a.push(...WebEJS_GEN.generate_view.__getElementPropertyList(n.parent)),a},_isJSExpressionWithIdentifiers:function(e){try{const n=esprima.parseScript(e,{tokens:!0});for(var t in n.tokens){if("Identifier"==n.tokens[t].type)return!0}}catch(e){}return!1},__getSortedProperties:function(e,t){var n=[],a=[];for(const o of e){const e=o.name,i=WebEJS_GEN.generate_view.__getPropertyInfo(t,e);"types"in i&&("modifiers"in i&&i.modifiers.includes("PREVIOUS")?n.push(o):a.push(o))}return n.push(...a),n},__getMultilineValue:function(e,t){if(e.startsWith("{")&&e.endsWith("}"))return e;if(e=e.replaceAll("\n"," ").replaceAll("\r"," ").trim(),t.includes("String")){const t=e.at(0),n=e.at(-1);'"'!=t&&"'"!=t||(e=e.slice(1)),'"'!=n&&"'"!=n||(e=e.slice(0,-1)),e='"'+e.replaceAll("\\","\\\\").replaceAll('"','\\"')+'"'}return e},__appendDefinition:function(e,t,n,a){for(const i of t){var o=!1;const t=sMainGUI.getSystemInformation("view_elements").classnames[i.Type],s=[];if("Properties"in i&&i.Properties.length){const e=WebEJS_GEN.generate_view.__getElementPropertyList(t);for(const t of WebEJS_GEN.generate_view.__getSortedProperties(i.Properties,e)){const n=t.name,r=WebEJS_GEN.generate_view.__getPropertyInfo(e,n),l=t.value;"GraphicsMode"==n&&"Canvas"==l&&(o=True),"types"in r?r.types.includes("Action")||l.startsWith("%")&&l.endsWith("%")||a.includes(l)||WebEJS_GEN.generate_view._isJSExpressionWithIdentifiers(l)||("modifiers"in r&&r.modifiers.includes("MULTILINE")?text=WebEJS_GEN.generate_view.__getMultilineValue(l,r.types):text=l.replaceAll("\r"," ").replaceAll("\n"," ").trim(),s.push('      .setProperty("'+n+'",'+text+")")):(console.error("property has no 'types' field !!!"),console.error("prop :"+n+" for element :"+i.Name),console.error("prop_info:"),console.error(r))}}command=o?"    _view._addElement("+t+", '"+i.Name+"', _view."+n+", 'GRAPHICS2D_CANVAS')":"    _view._addElement("+t+", '"+i.Name+"', _view."+n+")",s.length?(e.push(command),s.push("      ;"),e.push(s.join("\n"))):e.push(command+";"),"Children"in i&&WebEJS_GEN.generate_view.__appendDefinition(e,i.Children,i.Name,a)}return e.join("\n")},__appendLinks:function(e,t,n,a){for(const s of t){const t=sMainGUI.getSystemInformation("view_elements").classnames[s.Type],r=s.Name;if("Properties"in s){const l=WebEJS_GEN.generate_view.__getElementPropertyList(t);for(const t of WebEJS_GEN.generate_view.__getSortedProperties(s.Properties,l)){const c=t.name,u=WebEJS_GEN.generate_view.__getPropertyInfo(l,c);var o=t.value.trim();if("types"in u)if(u.types.includes("Action")){if(!a)continue;const t="// Action "+c+" for element "+r;if(o.startsWith("%")&&o.endsWith("%"))o=o.slice(1,-1),e.push("      _view."+r+".setAction('"+c+"', "+o+"); "+t);else{e.push("      _view."+r+".setAction('"+c+"', function(_data, _info) { "+t);var i=0;for(const t of o.split("\n"))i+=1,e.push("        "+t+" // property "+c+" of "+r+": line "+i);e.push("      });")}}else{const t=o.startsWith("%")&&o.endsWith("%");if(t||n.includes(o)){const n="_view."+r+".linkProperty('"+c+"',",a="// linking "+c+" of "+r;t&&(o=o.slice(1,-1));const i="function() { return "+o+"; }, function(_v) { "+o+" = _v; });";e.push("      "+n+" "+i+" "+a)}else if(o=o.replaceAll("\r"," ").replaceAll("\n"," "),WebEJS_GEN.generate_view._isJSExpressionWithIdentifiers(o)){const t="_view."+r+".linkProperty('"+c+"',",n="// linking "+c+" of "+r,a=o.includes("return")?"function() { "+o+"; });":"function() { return "+o+"; });";e.push("      "+t+" "+a+" "+n)}}else console.error("property has no 'types' field !!!"),console.error("prop :"+c+" for element :"+s.Name),console.error("prop_info:"),console.error(u)}}"Children"in s&&WebEJS_GEN.generate_view.__appendLinks(e,s.Children,n,a)}},getTreeCode:function(e,t,n,a){const o=[];a||o.push("function _getBase64Image(__base64ImageName) { return __base64ImageName; }\n"),o.push("function _simulationView (_topFrame,_libraryPath,_codebasePath) {"),o.push("  var _view = EJSS_CORE.createView(_topFrame);\n"),o.push("  if (_libraryPath)  _view._setLibraryPath(_libraryPath);"),o.push("  if (_codebasePath) _view._setResourcePath(_codebasePath);\n");var i=0;for(const e of t)"true"==e.External?o.push('  _view._addDescriptionPage("'+e.Name+'","'+e.Code.trim()+'");'):o.push('  _view._addDescriptionPage("'+e.Name+'","_description_'+i+'.html");'),i++;return o.push("\n  _view._reset = function() {"),o.push("    _view._clearAll();"),e.length?WebEJS_GEN.generate_view.__appendDefinition(o,e,"_topFrame",n):o.push(WebEJS_GEN.generate_view.__EMPTY_VIEW.replaceAll("{{WEBEJS_ASSETS_FOLDER}}",sMainEjsAssetsFolder)),o.push("  }; // end of _view._reset"),o.push("  return _view;"),o.push("}"),o.push(""),o.join("\n")},appendCreationCode:function(e,t,n,a){if(e.push("  function _createView() {"),e.push("    _view = new _simulationView(_topFrame,_libraryPath,_codebasePath);"),e.push("    var _view_super_reset = _view._reset;"),e.push("    _view._reset = function() {"),e.push("      _view_super_reset();"),a){const n=WebEJS_GEN.generate_view.__getElementPropertyList("EJSS_SIMULATION.root");for(const a of t.RootProperties){const t=a.name,i=WebEJS_GEN.generate_view.__getPropertyInfo(n,t);var o=a.value.trim();console.log("Root Property %s has types = %s",i.types),i.types.includes("Action")?o=o.startsWith("%")&&o.endsWith("%")?o.slice(1,-1):"function(_data, _info) { "+o+" }":"modifiers"in i&&i.modifiers.includes("MULTILINE")&&(o=WebEJS_GEN.generate_view.__getMultilineValue(o,i.types));const s="// Root property "+t;e.push("      _view._setRootProperty(_model,'"+t+"', "+o+"); "+s)}}WebEJS_GEN.generate_view.__appendLinks(e,t.Tree,n,a),e.push("    }; // end of new reset"),e.push(""),e.push("    _model.setView(_view);"),e.push("    _model.reset();"),a&&e.push("    _view._enableEPub();"),e.push("  } // end of _createView\n")},__EMPTY_VIEW:'  \n\tvar _model = EJSS_CORE.createAnimationLMS();\n  const EMPTY_HTML = `<span style="text-align: center; color:red; font-size: 2em;">Your view is empty</span>\n        <hr/>\n        <span style="text-align: center; font-size: 1.5em;">To populate your view:</span>\n        <ul>\n            <li style="list-style-type: none; font-size: 1.25em;">\n                1. Select the <span style=\'font-weight: bold; color: rgb(0,128,192);\'>View</span> panel on the top left group of buttons (see figure.)\n            </li>\n            <li style="list-style-type: none; text-align: center;">\n                <img width=\'60%\' src=\'{{WEBEJS_ASSETS_FOLDER}}/WebEJS/EmptyView/ViewButton.png\' />\n            </li>\n            <li style="list-style-type: none;">\n                <span style="font-size: 1.25em;">\n                    2. Drag an drop an element from the <b>Compound</b> or <b>Containers</b> palettes onto the <b>Simulation view</b>.\n                </span>\n                <br/><br/>\n                The image shows the <b>SingleDrawing</b> compound element being dragged onto the simulation view.\n                This creates a nice initial setting for a simulation with a two-dimensional scene.\n            </li>\n            <li style="list-style-type: none;">\n                <img width=\'95%\' src="{{WEBEJS_ASSETS_FOLDER}}/WebEJS/EmptyView/DragAndDrop.png" />\n            </li>\n            <li style="list-style-type: none;">\n                <span style="font-size: 1.25em;">\n                    3. Add and customize elements to fit your needs...\n                </span>\n                <br/><br/> \n                For more information visit <a href="https://www.um.es/fem/EjsWiki/Main/View" target="_blank" rel="noopener noreferrer">the EJS View help</a>.\n            </li>\n        </ul>\n        `;\n    _view._addElement(EJSS_INTERFACE.panel, \'_empty_panel\', _view._topFrame)\n       // .setProperty("Background","#ebe9e9")\n        .setProperty("Html",EMPTY_HTML)\n'},(WebEJS_GEN=WebEJS_GEN||{}).generate=function(e){function t(t,n){return t in e&&e[t]==n}var n,a=(t("useCDN",!0)?sMainEjsAssetsFolder:"./")+"_ejs_library/";if(t("forPackage",!0))n="null";else{const e=window.location.protocol+"//"+window.location.host;n=e+sMainGUI.getURLpathFor("")}const o='\n      var _model;\n      var _scorm;\n      window.addEventListener(\'load\',\n        function () {\n          _model = new {{MODEL_NAME}}("_topFrame","{{EJS_LIBRARY_FOLDER}}","{{CODEBASE_FOLDER}}");\n  \n          if (typeof _isApp !== "undefined" && _isApp) _model.setRunAlways(true);\n          TextResizeDetector.TARGET_ELEMENT_ID = \'_topFrame\';\n          TextResizeDetector.USER_INIT_FUNC = function () {\n            var iBase = TextResizeDetector.addEventListener(function(e,args) {\n                _model._fontResized(args[0].iBase,args[0].iSize,args[0].iDelta);\n                },null);\n            _model._fontResized(iBase);\n          };\n          _model.onload();\n        }, false);';const i=sMainGUI.saveObject(),s=i.information,r=t("separatePage",!0)?function(e){const t=e.Title,n=e.Logo,o=e.Author,i=e.AuthorLogo,s=o.join(", ");var r=e.Copyright.trim();r||(r=s);const l=new Date;var c=[];c.push("    <div id='metadata' class='metadata'>"),c.push("      <br />"),c.push("      <div id='title_author'>"),c.push("        <hr />"),c.push("        <b>Title and author:</b>"),c.push("        <p>"),t&&c.push("          "+t+"<br/>");for(const e of n)c.push("          <img alt='Logo' src='"+e+"'/>");c.push("        </p>"),c.push("        <p>");for(const e of i)c.push("          <img alt='author image' src='"+e+"'/>");return c.push(s),c.push("        </p>"),c.push("        <hr />"),c.push("      </div>"),c.push("      <p></p>"),c.push("      <div id='copyright_message'>"),c.push("        <div class='cc_left'  style='float:left'>"),c.push("          &#169;"+l.getFullYear()+", "+r+". <br />"),c.push("          Compiled with <a href='https://t.um.es/webejs' target='_blank'>WebEJS : the web version of Easy JavaScript Simulations</a>.<br />"),c.push("          Version 1.0 (2404101)"),c.push("        </div>"),c.push("        <div class='cc_right' style='float:right'>"),c.push("          Released under a <a rel='license' target='_blank' href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US'>"),c.push("          <img alt='Creative Commons Attribution-NonCommercial-ShareAlike' src='"+a+"images/cc_icon.png' />"),c.push("          </a> license."),c.push("        </div>"),c.push("      </div>"),c.push("    </div>"),c.join("\n")}(s):"",l=function(t){var a=[];for(filename of t.information.AuxiliaryFiles)filename.trim().toLowerCase().endsWith(".js")&&a.push("    <script src='"+n+filename+"'><\/script>");return WebEJS_GEN.generate_model.addElementsScriptCode(a,t.model,e.fullModel),a.join("\n")}(i),c=[a+"css/ejss.css"];for(const e of s.CSSFile.split(";"))e.toLowerCase().endsWith(".css")&&c.push(e);t("type","PWA")&&c.push("manifest.json");var u=WebEJS_GEN.generate_model.getModelCode(i,t("fullModel",!0)),d=['    <script type="text/javascript">\x3c!--//--\x3e<![CDATA[//>\x3c!--'];d.push(u.model),d.push(u.view),d.push("    //--\x3e<!]]><\/script>");var p=function(e,t,n,o,i){var s=['<?xml version="1.0" encoding="utf-8"?>'];s.push("<!DOCTYPE html>"),s.push('<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">'),s.push("  <head>"),s.push('    <meta charset="utf-8" />'),s.push("    <title>"+e.Title+"</title>"),s.push(e.HTMLHead);for(const e of t)s.push('    <link rel="stylesheet"  type="text/css" href="'+e+'" />');return n&&s.push('\n    <link rel="manifest" href="'+n+'" />'),s.push('\n    <script type=\'text/javascript\'>\x3c!--//--\x3e<![CDATA[//>\x3c!--\n      var gOldOnError = window.onerror;\n      window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {\n        console.log(errorMsg + " (at " + url.toString() + " => line:" + lineNumber + ")" );\n        if (gOldOnError) return gOldOnError(errorMsg, url, lineNumber);\n        return false;\n      }\n    //--\x3e<!]]><\/script>'),s.push('    <script src="'+a+'scripts/textresizedetector.js"><\/script>'),s.push('    <script src="'+a+'ejsS.v1.min.js"><\/script>'),o&&s.push(o),i&&s.push(i),s.push("\n  </head>"),s}(s,c,"",l,d.join("\n"));return p.push("  <body>"),p.push('    <div role="button" id="_topFrame" style="text-align:center"></div>'),r&&p.push(r),p.push('    <script type="text/javascript">\x3c!--//--\x3e<![CDATA[//>\x3c!--'),p.push(o.replaceAll("{{MODEL_NAME}}","_simulation").replaceAll("{{EJS_LIBRARY_FOLDER}}",a).replaceAll("{{CODEBASE_FOLDER}}",n)),t("separatePage",!1)&&p.push("        window.console = window.parent.console;"),p.push("    //--\x3e<!]]><\/script>"),t("extraScripts",!0)&&p.push(options.extraScripts),p.push("  </body>"),p.push("</html>"),p.join("\n")},(WebEJS_GUI=WebEJS_GUI||{}).comm=function(e){var t={};function n(t){return t.indexOf("?")>=0?t+"&id="+e:t+"?id="+e}function a(e,t,n){n?sMainGUI.errorLine(sMainResources.getString(t)+" : "+n):sMainGUI.errorLine(sMainResources.getString(t)),sMainGUI.errorLine(sMainResources.getString("Server message")+" : "+e.responseText),sMessageForm.showWarning("Communication error",t,"Check out the output area.")}function o(e,t,o,i){$.ajax({type:"GET",url:n(e),headers:{"X-CSRFToken":csrftoken},contentType:"application/json; charset=UTF-8",success:t,error:e=>{a(e,o,i)}})}function s(e,t,o,i,s,r){$.ajax({type:"POST",url:n(e),headers:{"X-CSRFToken":csrftoken},contentType:"application/json; charset=UTF-8",processData:!1,data:JSON.stringify(t),success:o,error:e=>{a(e,i,s),r&&r()}})}function r(e){if("simulation"in e)return sMainGUI.readObject(e.simulation);if("files"in e){const t=e.files;if(t.length>0)return function(e){const t=[];for(i in e)t.push({name:e[i]});sMainSelectChoiceForm.show("Choose simulation from the ZIP",t,e[0],(function(e){sMessageForm.showTemporal("Loading downloaded simulation...",sLocaleFor("Cleaning files..."),"This message should dissapear automatically when done."),o("/simulation/set_loaded?model="+e,(e=>{sMainGUI.readObject(e.simulation)}),"Error reading downloaded file!")}),null,!0)}(t)}sMainGUI.errorLine(sMainResources.getString("No simulation or file list in the server response!")),sMessageForm.showWarning("Reading error","There is no valid simulation file in ZIP!!!","Check out the output area.")}return t.disconnect=function(){window.location=n("/logout")},t.getSystemInformation=function(e){o("/system/system_information",e,"Error reading system information from server!")},t.saveWebEJSOptions=function(e){s("/system/save_options",e,(e=>{sMainGUI.logLine(sMainResources.getString("WebEJS options correctly saved")+" ("+e+")")}),"Error saving WebEJS options!")},t.addCustomElement=function(e){s("/system/add_custom_element",e,(e=>{sMainGUI.logLine(sMainResources.getString("Custom element correctly added")+" : "+e)}),"Error adding custom element!")},t.deleteCustomElement=function(e){s("/system/delete_custom_element",e,(e=>{sMainGUI.logLine(sMainResources.getString("Custom element correctly deleted")+" : "+e)}),"Error deleting custom element!")},t.updateRecentFiles=function(e){e?s("/system/recent_files",{action:"add",path:e},(function(e){sMainWebEJSOptions.setRecentFiles(e.files)}),"Error updating recent files list!"):s("/system/recent_files",{action:"clean"},(function(){sMainWebEJSOptions.setRecentFiles([])}),"Error cleaning recent files list!")},t.getPreviewURL=function(t,n){var a="/preview?id="+e;return t&&(a+="&fullmodel=true"),n&&(a+="&separated=true"),a},t.newSimulation=function(){sMessageForm.showTemporal("Loading new simulation...",sLocaleFor("Cleaning files..."),"This message should dissapear automatically when done."),o("/simulation/new?name=NewSimulation.ejs",(e=>{sMainGUI.readObject(e.simulation)}),"Error creating new file!")},t.getSimulation=function(){o("/simulation/get",(e=>{sMainGUI.readObject(e.simulation)}),"Error reading file!")},t.uploadUserZIPFile=function(e){!function(e,t,o,i,s,r){const l=new FormData;l.append("file",t),$.ajax({method:"POST",type:"POST",url:n(e),cache:!1,enctype:"multipart/form-data",contentType:!1,processData:!1,data:l,success:o,error:e=>{a(e,i,s),r&&r()}})}("/simulation/upload_local_zip",e,(e=>{sMainGUI.logLine(sMainResources.getString("ZIP file correctly uploaded.")),r(e)}),"Error uploading user's file: ",e)},t.downloadLibraryModel=function(e,t){sMessageForm.showTemporal("Downloading model...",t,"This message should dissapear automatically when done."),o("/simulation/library_download?url="+encodeURIComponent(e),(e=>{sMessageForm.hide(),sMainGUI.logLine(sMainResources.getString("ZIP file correctly downloaded.")),r(e)}),"Error downloading library model: ",t)},t.openFromLibrary=function(){sMainLibraryChooser.show((function(e,n){t.downloadLibraryModel(e,n)}))},t.updateSimulation=function(e,t,n){var a={simulation:sMainGUI.saveObject()};e&&(a.report=e),s("/simulation/update",a,t,"Error updating simulation!",null,n)},t.sendActionReport=function(e,n,a){t.updateSimulation(e,n,a)},t.zipSimulation=function(e,t){var n=sMainGUI.saveObject(),a=n.information.Title.trim();""==a||null==a?a="untitled":a.endsWith(".")&&(a=a.substring(0,a.length-1)),a=e?"webejs_model_"+a+".zip":"webejs_src_"+a+".zip",sMainFilenameForm.show(a,(a=>{var o="/simulation/zip_simulation?filename="+encodeURI(a);e&&(o+="&generate=true"),s(o,n,(e=>{sMainGUI.logLine(sMainResources.getString("ZIP simulation file correctly created.")),console.log("Zip ok created"),console.log(e),window.location=e.url,t&&t()}),"Error creating ZIP simulation file!")}))},t.checkRequiredFile=function(e,t,n){const a=sMainGUI.getURLpathFor(e);var o=new XMLHttpRequest;o.open("GET",a,!0),o.onreadystatechange=function(){4===o.readyState&&(404===o.status?n&&n(e):t&&(e.startsWith("/")||e.startsWith("./")||(e="./"+e),t(e,a)))},o.send()},t.refreshUserFiles=function(e){o("/manage/file_list",(t=>{e(t.listing)}),"Updating user files failed")},t.userFileCommand=function(arguments,e){s("/manage/file_command",arguments,(t=>{e(t.params)}),e,"User file command failed:"+arguments)},t},(WebEJS_GUI=WebEJS_GUI||{}).main=function(){var e={},t=null,n=!1,a="",o={};e.getURLpathFor=function(e){return a+e},e.getSystemInformation=function(e){return o[e]},e.getSystemIconURL=function(e){return o.system_icons_dir+e},e.getWebEJSLogo=function(){return e.getSystemIconURL("WebEJS_logo.png")},e.getWebEJSLogoImg=function(){return'<img  src="'+sMainGUI.getWebEJSLogo()+'" height="40" class="me-2 d-inline-block align-bottom">'};var i=25,s=50;function r(){return!$("#sPreviewPanel").hasClass("d-none")}function l(e){$("#"+e+"Panel").hasClass("d-none")?($("#"+e+"Panel").removeClass("d-none"),$("#sMainRadioButtons ."+e+"Btn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn"),$("#sMainRadioButtons ."+e+"BtnPlus").prop("disabled",!1),$("#sMainRadioButtons ."+e+"BtnMinus").prop("disabled",!1)):($("#"+e+"Panel").addClass("d-none"),$("#sMainRadioButtons ."+e+"Btn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff"),$("#sMainRadioButtons ."+e+"BtnPlus").prop("disabled",!0),$("#sMainRadioButtons ."+e+"BtnMinus").prop("disabled",!0))}e.showPanel=function(e){if($("#"+e+"Panel").hasClass("d-none")){var t=["sModel","sDescription","sView"],n=t.indexOf(e);for(var a in-1!==n&&t.splice(n,1),t)$("#"+t[a]+"Panel").addClass("d-none"),$("#sMainRadioButtons ."+t[a]+"Btn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff");$("#"+e+"Panel").removeClass("d-none"),$("#sMainRadioButtons ."+e+"Btn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn")}},$("#sMainRadioButtons .sDescriptionBtn").click((()=>{e.showPanel("sDescription")})),$("#sMainRadioButtons .sModelBtn").click((()=>{e.showPanel("sModel")})),$("#sMainRadioButtons .sViewBtn").click((()=>{e.showPanel("sView")})),e.setSimulationOptionsRadio=function(e){e?$("#sMainRadioButtons .sInformationBtn").removeClass("sRadioButtonOff").addClass("sRadioButtonOn"):$("#sMainRadioButtons .sInformationBtn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff")},$("#sMainRadioButtons .sInformationBtn").click((function(){sMainSimulationOptions.toggle()})),$("#sPreviewPanel").css("min-width",s+"vw"),$("#sMainRadioButtons .sPreviewBtn").click((()=>{l("sPreview"),r()&&p.updatePreview()})),$("#sMainRadioButtons .sPreviewBtnPlus").click((()=>{s=Math.min(75,s+25),$("#sPreviewPanel").css("min-width",s+"vw")})),$("#sMainRadioButtons .sPreviewBtnMinus").click((()=>{s=Math.max(25,s-25),$("#sPreviewPanel").css("min-width",s+"vw")})),$("#sOutputPanel").css("min-height",i+"vh"),$("#sMainRadioButtons .sOutputBtn").click((()=>{l("sOutput")})),$("#sMainRadioButtons .sOutputBtnPlus").click((()=>{i=Math.min(75,i+25),$("#sOutputPanel").css("min-height",i+"vh")})),$("#sMainRadioButtons .sOutputBtnMinus").click((()=>{i=Math.max(25,i-25),$("#sOutputPanel").css("min-height",i+"vh")})),sMainRefreshTooltips(),$(".sMainMenuAction").click((function(t){const n=t.currentTarget.dataset.action;$(this).tooltip("hide"),e.mainAction(n)}));var c=WebEJS_GUI.descriptionWorkpanel("#sDescriptionPanel"),u=WebEJS_GUI.modelWorkpanel(),d=WebEJS_GUI.viewWorkpanel(),p=WebEJS_GUI.previewArea(),m=WebEJS_GUI.outputArea();e.getModel=function(){return u},e.println=function(e){m.println(e)},e.logLine=function(e){m.logLine(e)},e.infoLine=function(e){m.infoLine(e)},e.warningLine=function(e){m.warningLine(e)},e.errorLine=function(e){m.errorLine(e)},e.setChanged=function(){n=!0};var g=!1,f=0,h=[];function b(){if(null!=t){h=[],a=t.url_path,window.top.document.title="WebEJS 1.0beta",sMainSimulationOptions.readObject(t.information),c.readObject(t);var o=u.readObject(t);g||alert("WebEJS view not yet ready. You should not see this alert!!!"),(o=o&&d.readObject(t))?(e.logLine(sLocaleFor("File successfully read!")),r()&&p.updatePreview(),sMessageForm.hide(),function(){if(!(h.length<=0)){for(var e="",t=0;t<h.length;t++)e+="<p>"+h[t]+"</p>";sMessageFormAux.showWarningHTML("Reading Warnings",e)}}()):(sMessageForm.showHTML("<h5>"+sLocaleFor("File read with errors!")+"</h5>","Error reading file!"),e.errorLine(sLocaleFor("File read with errors!")),p.clearPreview(sLocaleFor("Error reading simulation"))),sMainResources.prepareForTranslation("#sMainWorkpanel"),sMainSimulationOptions.updateDetectedFiles(),n=!1}else alert("WebEJS has received no simulation. You should not see this alert!!!")}function v(){!1===g?(f++,m.clear(),m.logLine(sLocaleFor("WebEJS initializing...")+" "+f),window.setTimeout(v,500)):(m.clear(),m.infoLine(sLocaleFor("WebEJS is ready!")),b())}function _(e){n?sMainConfirmationForm.showWarning("The simulation has changed","Proceeding will make you loose the changes!","Proceed",e):e()}return e.addReadingWarning=function(e){h.push(e)},e.saveObject=function(){var e={};return e.information=sMainSimulationOptions.saveObject(),e.description=c.saveObject(),e.model=u.saveObject(),e.view=d.saveObject(),e},e.readObject=function(e){t=e,console.info("Simulation received:"),console.info(t),!1===g?v():b()},e.getDetectedFiles=function(){var e=sMainSimulationOptions.getDetectedFiles();return e.push(...c.getDetectedFiles()),e.push(...u.getDetectedFiles()),e.push(...d.getDetectedFiles()),e},e.isViewEmpty=function(){return d.viewIsEmpty()},e.getTitleForPreview=function(){var e=sMainSimulationOptions.getTitle();return e.trim().length<=0&&(e=sLocaleFor("Simulation")),e},e.reportPreview=function(e){r()&&p.reportPreview(e)},e.mainAction=function(e,t){switch(e){case"New":return void _(sMainComm.newSimulation);case"LoadLocal":return void _((function(){$("#mMainLoadLocalField").click()}));case"OpenLibrary":return void _(sMainComm.openFromLibrary);case"FileManager":return void sMainFileChooser.showManager();case"ZipSource":return void sMainComm.zipSimulation(!1,(function(){n=!1}));case"Search":return void sMessageForm.showHTML("Search option","<h5>Not yet implemented</h5>");case"Run":return void p.runSimulation();case"ZipSimulation":return void sMainComm.zipSimulation(!0);case"Translate":return a=t,void sMainResources.setLocale(a);case"Options":return void sMainWebEJSOptions.show();case"Open":return void _(sMainComm.openSimulation);case"OpenRecent":return void _((function(){sMainComm.loadDiskSimulation(t)}));case"CleanRecent":return void sMainComm.updateRecentFiles(null);case"Save":return void sMainComm.saveSimulation();case"SaveAs":return void sMainComm.saveAsSimulation();case"Package":return void sMainComm.packageSimulation();case"Info":return void window.open(sMainWebEJS_wiki,"_blank");case"Disconnect":return void _((function(){sMainConfirmationForm.show("Disconnection","Sure you want to disconnect?","Disconnect",sMainComm.disconnect)}));case"RefreshPreview":case"SwitchFullmodel":return void p.updatePreview()}var a},sMainComm.getSystemInformation((e=>{o=e,console.log(e),d.buildPalette(o),u.getElementsPanel().buildPalette(o),g=!0})),e},WebEJS_GUI.optionsWebEJSPanel=function(){var e={},t=new bootstrap.Modal(document.getElementById("sMainWebEJSOptionsModal"));function n(){switch($("input[name=mWebEJSOptionsEditorShowPreviewSize]:checked").val()){case"small":$("#sPreviewPanel").css("min-width","25vw");break;case"large":$("#sPreviewPanel").css("min-width","75vw");break;default:$("#sPreviewPanel").css("min-width","50vw")}}function a(){switch($("input[name=mWebEJSOptionsEditorShowOutputSize]:checked").val()){case"small":$("#sOutputPanel").css("min-height","25vh");break;case"large":$("#sOutputPanel").css("min-height","75vh");break;default:$("#sOutputPanel").css("min-height","50vh")}}function o(){$("#mWebEJSOptionsEditorShorterLabels").is(":checked")?($("#sModelVariables-tab .sModelTabLabel").text("Vars"),$("#sModelInitialization-tab .sModelTabLabel").text("Init"),$("#sModelEvolution-tab .sModelTabLabel").text("Evol"),$("#sModelFixedRelations-tab .sModelTabLabel").text("FixRel"),$("#sModelCustom-tab .sModelTabLabel").text("Cstm"),$("#sModelElements-tab .sModelTabLabel").text("Elms")):($("#sModelVariables-tab .sModelTabLabel").text("Variables"),$("#sModelInitialization-tab .sModelTabLabel").text("Initialization"),$("#sModelEvolution-tab .sModelTabLabel").text("Evolution"),$("#sModelFixedRelations-tab .sModelTabLabel").text("Fixed Relations"),$("#sModelCustom-tab .sModelTabLabel").text("Custom"),$("#sModelElements-tab .sModelTabLabel").text("Elements")),sMainResources.updateTranslation(["#sModelVariables-tab","#sModelInitialization-tab","#sModelEvolution-tab","#sModelFixedRelations-tab","#sModelCustom-tab","#sModelElements-tab"])}return $("#mWebEJSOptionsEditorLogo").attr("src",sMainEjsLogo),$("#mWebEJSOptionsEditorCancelButton").click((function(){t.hide()})),$("#mWebEJSOptionsEditorSaveButton").click((function(){sMainComm.saveWebEJSOptions(function(){var e={};return e.panel_at_start_up=$("input[name=mWebEJSOptionsEditorShowPanel]:checked").val(),e.show_preview_at_start_up=$("#mWebEJSOptionsEditorShowPreview").is(":checked")?"true":"false",e.preview_size=$("input[name=mWebEJSOptionsEditorShowPreviewSize]:checked").val(),e.show_output_at_start_up=$("#mWebEJSOptionsEditorShowOutput").is(":checked")?"true":"false",e.output_size=$("input[name=mWebEJSOptionsEditorShowOutputSize]:checked").val(),e.use_short_labels=$("#mWebEJSOptionsEditorShorterLabels").is(":checked")?"true":"false",e.author_name=$("#mWebEJSOptionsEditorAuthorNameValue").val(),e.author_affiliation=$("#mWebEJSOptionsEditorAuthorAffiliationValue").val(),e.author_contact=$("#mWebEJSOptionsEditorAuthorContactValue").val(),e}()),t.hide()})),$("#mWebEJSOptionsEditorLanguage").on("change",(function(e){sMainResources.setLocale(this.value),console.log(this.value,this.options[this.selectedIndex].value,$(this).find("option:selected").val())})),$("#mWebEJSOptionsEditorShowPreviewSize").on("change",n),$("#mWebEJSOptionsEditorShowOutputSize").on("change",a),$("#mWebEJSOptionsEditorShorterLabels").on("change",o),e.show=function(){t.show()},e.readOptions=function(e){const t=(e=function(e){return"panel_at_start_up"in e||(e.panel_at_start_up="Description"),"show_preview_at_start_up"in e||(e.show_preview_at_start_up="true"),"preview_size"in e||(e.preview_size="medium"),"show_output_at_start_up"in e||(e.show_output_at_start_up="true"),"output_size"in e||(e.output_size="small"),"use_short_labels"in e||(e.use_short_labels="false"),"author_name"in e||(e.author_name=""),"author_affiliation"in e||(e.author_affiliation=""),"author_contact"in e||(e.author_contact=""),e}(e)).panel_at_start_up;$("#mWebEJSOptionsEditorShowPanel input[value="+t).prop("checked",!0),sMainGUI.showPanel("s"+t),"false"==e.show_preview_at_start_up&&($("#mWebEJSOptionsEditorShowPreview").prop("checked",!1),$("#sPreviewPanel").addClass("d-none"),$("#sMainRadioButtons .sPreviewBtn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff"),$("#sMainRadioButtons .sPreviewBtnPlus").prop("disabled",!0),$("#sMainRadioButtons .sPreviewBtnMinus").prop("disabled",!0)),"false"==e.show_output_at_start_up&&($("#mWebEJSOptionsEditorShowOutput").prop("checked",!1),$("#sOutputPanel").addClass("d-none"),$("#sMainRadioButtons .sOutputBtn").removeClass("sRadioButtonOn").addClass("sRadioButtonOff"),$("#sMainRadioButtons .sOutputBtnPlus").prop("disabled",!0),$("#sMainRadioButtons .sOutputBtnMinus").prop("disabled",!0)),$("#mWebEJSOptionsEditorShowPreviewSize input[value="+e.preview_size).prop("checked",!0),n(),$("#mWebEJSOptionsEditorShowOutputSize input[value="+e.output_size).prop("checked",!0),a(),"true"==e.use_short_labels&&($("#mWebEJSOptionsEditorShorterLabels").prop("checked",!0),o()),$("#mWebEJSOptionsEditorAuthorNameValue").val(e.author_name),$("#mWebEJSOptionsEditorAuthorAffiliationValue").val(e.author_affiliation),$("#mWebEJSOptionsEditorAuthorContactValue").val(e.author_contact)},e.setRecentFiles=function(e){const t=$("#sMainMenu_Previous");if(t){if(t.empty(),t.append($('<li><span class="sTranslatable dropdown-item-text fw-bold">Recent files:</span></li>')),t.append($('<li><hr class="dropdown-divider"></li>')),e.length>0)for(var n=0;n<e.length;n++){const o=$('<li><button type="button" class="sRecentFileAction btn btn-outline-primary border-0" data-action="OpenRecent"></button></li>');var a=e[n];a.startsWith("/source/")?$(o).find("button").text(a.substring(8)):$(o).find("button").text(a),$(o).find("button").data("path",a),t.append(o)}else t.append($('<li><span class="sTranslatable dropdown-item-text">(No recent files)</span></li>'));t.append($('<li><hr class="dropdown-divider"></li>')),t.append($('<li><button type="button" class="sTranslatable sRecentFileAction btn fw-bold" data-action="CleanRecent">Clean list</button></li>')),$(".sRecentFileAction").click((function(){const e=$(this).data("action"),t=$(this).data("path");sMainGUI.mainAction(e,t)}))}else alert("No recent files")},e};const sDescriptionIFrameOnLoad=function(e){var t=$("#mDescriptionExternalPageFrame_"+e).contents().find("head"),n='<link href="'+sMainEjsAssetsFolder+'_ejs_library/css/ejss.css" rel="stylesheet" type="text/css" />';t.append(n),sMainSimulationOptions.updateDetectedFiles()};(WebEJS_GUI=WebEJS_GUI||{}).descriptionWorkpanel=function(e){const t=WebEJS_TOOLS.tabbedPanel();var n={},a={};function o(e,t,n){t.find("img").each((function(){var t=$(this).attr("src");t.indexOf("//")<0&&(t.startsWith(n)||(t=n+t),e.push(t))}))}n.getMainPanelSelector=function(){return e},n.getKeyword=function(){return"Description"},n.getPageName=function(){return"Desc Page"},n.getDefaultPageType=function(){return"DESCRIPTION_EDITOR"},n.isPageSecondType=function(e){return e.find(".mDescriptionExternalHTMLFileField").length>0},n.getSecondType=function(){return"DESCRIPTION_VIEWER"},n.getSecondTypeLabel=function(){return"Create a new HTML display page"},n.reportableChange=function(e){sMainGUI.setChanged()},n.readObject=function(a){if("description"in a&&"pages"in a.description){const o=a.description.pages;if(null==o||o.length<=0)n.setNoPages();else{const a=function(e,t){for(var n=[],a=!1,o=0;o<e.length;o++){const i=e[o];i.Locale!=t?(sMainGUI.println(sMainResources.getString("WARNING: Ignoring locale file ("+i.Locale+") description for page: "+i.Name)),a=!0):n.push(i)}return a&&sMainGUI.addReadingWarning("<p>"+sMainResources.getString("The description of this simulation has non-default locale pages.")+'<br><small class="text-danger">'+sMainResources.getString("Locales (translations) are ignored and lost when you save!")+"</small></p>"),n}(o,"_default_");$(e).html(t.panelHTML(n,a)),t.initPanel(n,a)}}else n.setNoPages();return!0},n.saveObject=function(){return{pages:t.getAllPagesObject(n)}},n.getDetectedFiles=function(){return t.getAllPagesDetectedFiles(n)},n.setNoPages=function(){$(e).html('<div class="h-100 col-12 mx-auto btn-group-vertical" style="flex-grow:1;"><button class="sDescriptionBtn sPanelNoPageBtn rounded-0 col-12 h-50 active" data-type="'+n.getDefaultPageType()+'" ><h5 class="sTranslatable">Click to create a description page</h5></button><button class="sDescriptionBtn sPanelNoPageBtn rounded-0 col-12 h-50 active" data-type="'+n.getSecondType()+'" ><h5 class="sTranslatable">Click to create an HTML display page</h5></button></div>'),t.initPanel(n,null)},n.pageMainBuilder=function(e,t,n){return"DESCRIPTION_VIEWER"==n||t&&"true"==t.External?function(e,t){var n="",a="";t&&t.Code&&(n=(a=t.Code.trim()).startsWith("./")?sMainGUI.getURLpathFor(a.substring(2)):a);return'<div id="mDescriptionExternalPage_'+e+'" class="d-flex flex-column" style="flex-grow:1"><div class="sCommentPanel" style="flex-basis:0;flex-grow: 0"><div class="h-100 input-group input-group-sm"><span class="sTranslatable input-group-text">Title</span><input type="text" class="sPageCommentField form-control" id="mDescriptionEditorTitle_'+e+'"'+(t&&t.Title?' value="'+t.Title+'"':"")+'></div></div><div class="d-flex flex-column col-12 " style="flex-grow:1"><iframe id="mDescriptionExternalPageFrame_'+e+'" class="mDescriptionIFrame py-0" title="Description page" onload="sDescriptionIFrameOnLoad('+e+')" style="flex-grow:1; overflow: auto;" '+(n.length>0?' src="'+n+'"':"")+'></iframe></div><div class="mFileChooserPanel d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable input-group-text">HTML File</span><input type="text" class="mDescriptionExternalHTMLFileField form-control" id="mDescriptionExternalHTMLFileField_'+e+'" placeholder="&lt;Type or click the button to the right to select HTML file&gt;" aria-label="Filepath"'+(a.length>0?' value="'+a+'"':"")+'><span class="input-group-text"><i class=" bi bi-file-richtext cFileChooser"  data-field="#mDescriptionExternalHTMLFileField_'+e+'"  style="font-size: 1rem;"></i></span></div></div></div>'}(e,t):'<div class="sCommentPanel" style="flex-basis:0;flex-grow: 0"><div class="h-100 input-group input-group-sm"><span class="sTranslatable sDescriptionBtn input-group-text">Title</span><input type="text" class="sPageCommentField form-control" id="mDescriptionEditorTitle_'+e+'"'+(t&&t.Title?' value="'+t.Title+'"':"")+'></div></div><div id = "mDescriptionInternalPage_'+e+'" class="d-flex flex-column" style="flex-grow:1" ><textarea id="mDescriptionEditorArea_'+e+'" class="suneditor" style="flex-grow:1"></textarea></div>'},n.showUserFileError=function(e){var t="<p>"+sMainResources.getString("The selected file is not included in your simulation list of <i>User files</i>:")+'</p><p class="text-danger">'+e+"</p><p>"+sMainResources.getString("Please, add it before using it.","User file error")+"</p>";sMessageForm.showHTML("User File Error",t)},n.pageInitialization=function(e,o){const s=t.getPageDivHash(e);var r=o?o.Title:t.getPageDivName(n,e);if($("#mDescriptionEditorTitle_"+s).val(r),n.isPageSecondType(e))e.find(".cFileChooser").on("click",(a=>{t.isPageDisabled(n,e)||WebEJS_TOOLS.selectFile(["html","xhtml"],(function(e,t){$("#mDescriptionExternalHTMLFileField_"+s).val(e),$("#mDescriptionExternalPageFrame_"+s).attr("src",t)}),!0,null)}));else{var l=o?o.Code:"<h1>"+t.getPageDivName(n,e)+"</h1>";a[s]=SUNEDITOR.create(document.getElementById("mDescriptionEditorArea_"+s),{width:"100%",height:250,buttonList:[["undo","redo"],["bold","underline","italic",":t-More Text-default.more_text","strike","subscript","superscript"],["formatBlock","list","fontColor","horizontalRule",":p-More Paragraph-default.more_paragraph","font","fontSize","hiliteColor","textStyle","align","lineHeight","paragraphStyle","blockquote"],["removeFormat"],["outdent","indent"],["link","image",":r-More Rich-default.more_plus","table","video","audio"],["codeView",":v-View-text.View","fullScreen","showBlocks","preview"]],lang:SUNEDITOR_LANG[sMainResources.getLocale()]}),a[s].setContents(i(l,1))}},n.disablePage=function(e,o){const i=t.getDivPageByHash(n,e);n.isPageSecondType(i)||(o?a[e].disable():a[e].enable())},n.pageDeleted=function(e){const o=t.getPageDivHash(e);n.isPageSecondType(e)||(a[o]=null)},n.getPageObject=function(e){var o=t.getPageObject(n,e);const s=n.isPageSecondType(t.getDivPageByHash(n,e));var r;return o.Locale="_default_",o.Title=$("#mDescriptionEditorTitle_"+e).val(),o.External=s?"true":"false",o.Code=s?$("#mDescriptionExternalHTMLFileField_"+e).val():(r=a[e].getContents(),"<html>\n<head></head>\n<body>\n"+i(r,0)+"\n</body>\n</html>"),o},n.getPageDetectedFiles=function(e){var i=[];if(n.isPageSecondType(t.getDivPageByHash(n,e))){const t=$("#mDescriptionExternalHTMLFileField_"+e).val().trim();if(t.length>0){i.push(t);const n=t.split("\\").pop().split("/").pop(),a=t.substring(0,t.length-n.length);o(i,$("#mDescriptionExternalPageFrame_"+e).contents(),a)}}else o(i,$(a[e].getContents()),"./");return i};function i(e,t){const n=window.location.protocol+"//"+window.location.host+"/"+sMainGUI.getURLpathFor(""),a=n.length;for(var o=e.toLowerCase(),i="",s=o.indexOf("<img");s>=0;){var r=!0,l=o.indexOf("/>",s);if(l<0&&(r=!1,l=o.indexOf(">",s)),l<0)break;var c=o.substring(s,l),u=c.indexOf('src="')+5,d=s+c.indexOf('"',u);u=s+u;var p=e.substring(u,d);if(0===t)p.startsWith(n)&&(p="./"+p.substring(a));else p.startsWith("./")&&(p=n+p.substring(2));i+=e.substring(0,u)+p,i+=e.substring(d,l),r||(i+="/"),o=o.substring(l),e=e.substring(l),s=o.indexOf("<img")}return i+=e}return n},(WebEJS_GUI=WebEJS_GUI||{}).modelWorkpanel=function(){var e={},t=WebEJS_GUI.variablesPanel("#sModelVariablesPanel"),n=WebEJS_GUI.codePanel("initialization","#sModelInitializationPanel"),a=WebEJS_GUI.evolutionPanel("#sModelEvolutionMain"),o=WebEJS_GUI.codePanel("fixed_relations","#sModelFixedRelationsPanel"),i=WebEJS_GUI.codePanel("custom","#sModelCustomPanel"),s=WebEJS_GUI.elementsPanel("#sModelElementsPanel");function r(e){$(".sModelContentDiv").each((function(){$(this).index()==e?$(this).removeClass("d-none"):$(this).addClass("d-none")})),$(".sModelTabButton").each((function(){$(this).closest("li").index()==e?$(this).removeClass("bi-circle").addClass("bi-record-circle"):$(this).removeClass("bi-record-circle").addClass("bi-circle")}))}return e.getVariables=function(){return t},e.getCustomCode=function(){return i},e.getElementsPanel=function(){return s},e.saveObject=function(){var e={};return e.variables=t.saveObject(),e.initialization=n.saveObject(),e.evolution=a.saveObject(),e.fixed_relations=o.saveObject(),e.custom=i.saveObject(),e.elements=s.saveObject(),e},e.readObject=function(e){var r;r="model"in e?e.model:{variables:{},initialization:{},evolution:{},fixed_relations:{},custom:{},elements:{}};var l=!0;return l&=t.readObject(r.variables),l&=n.readObject(r.initialization),l&=a.readObject(r.evolution),l&=o.readObject(r.fixed_relations),l&=i.readObject(r.custom),l&=s.readObject(r.elements)},e.getDetectedFiles=function(){return[]},$(".sModelTabButton").click((e=>{r($(e.target).closest("li").index())})),r(0),e},WebEJS_GUI.odeEventsPanel=function(e,t,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(t),i=a.getPageDivName(e,t),s="ODEEventsEditor_"+o,r="m"+s,l="#"+r+"-Panel";var c={},u="",d={pages:[]},p={Code:"",Comment:"",StopAfterEffect:"true"};n&&(u=n.EventMaximumStep,"Events"in n&&"object"==typeof n.Events&&"pages"in n.Events&&(d=n.Events),"ZenoEffect"in n&&"object"==typeof n.ZenoEffect&&"Code"in n.ZenoEffect&&(p=n.ZenoEffect),e.showNumberOfEvents(d.pages.length,t));var m=null,g=null,f={},h={},b=null;function v(){u=$("#"+r+"-ZenoSteps").val(),d={pages:a.getAllPagesObject(c)}}function _(){p={Code:b.getValue(),Comment:$("#"+r+"-ZenoComment").val(),StopAfterEffect:$("#"+r+"-ZenoStopCheckbox").is(":checked")?"true":"false"}}c.getMainPanelSelector=function(){return l},c.getKeyword=function(){return s},c.getPageName=function(){return"Event"},c.getDefaultPageType=function(){return"EVENT_EDITOR"},c.pageDeleted=function(n){const o=a.getPageDivHash(n);delete f[o],delete h[o],e.showNumberOfEvents(a.getPagesCount(c)-1,t)},c.reportableChange=function(t){e.reportableChange(t)},c.getContent=function(e){m&&v(),g&&_(),e.EventMaximumStep=u,e.Events=d,e.ZenoEffect=p};const E={width:Math.min(.9*window.innerWidth,1e3),height:Math.min(.9*window.innerHeight,800)},S={width:Math.min(.7*window.innerWidth,800),height:Math.min(.7*window.innerHeight,600)};return c.show=function(){m?(m.resize(E),m.reposition(),m.front()):function(){sMainHideTooltips();const t={content:'<div id="'+r+'-Panel" class="sModelSubpanel h-100 col-12 d-flex flex-column" style="flex-grow:1"></div>',onbeforeclose:function(e){return g&&g.close(),v(),m=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><button type="button" id="'+r+'-ZenoButton"  class="sTranslatable sModelBtn btn btn-outline-secondary">'+sLocaleFor("Zeno effect action")+'</button><span id="'+r+'-ZenoLabel" class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Check events at steps not larger than")+'</span><input type="text" class="ms-1 form-control" id="'+r+'-ZenoSteps"'+sMainNoAutocorrect+' aria-describedby="'+r+'-ZenoLabel"  style="width:4em;" aria-label="'+sLocaleFor("Zeno step")+'"><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+r+'-ZenoSteps"  style="font-size: 1rem;"></i></span></div><button type="button" id="'+r+'-Button" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(t){$("#"+r+"-Button").click((function(){t.close()})),$("#"+r+"-ZenoButton").click((function(){g?(g.resize(S),g.reposition(),g.front()):function(){sMainHideTooltips();const t={content:'<div class="h-100 col-12 d-flex flex-column" style="flex-grow:1"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+r+'-ZenoStopCheckbox" id="'+r+'-ZenoStopCheckbox"><label class="sTranslatable form-check-label" for="'+r+'-ZenoStopCheckbox">'+sLocaleFor("End step after effect")+'</label></span></div></div></div><div class="ace h-100" id="'+r+'-ZenoEditor" style="flex-grow:1"></div></div>',onbeforeclose:function(e){return _(),g=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input type="text" class="flex flex-grow form-control" id="'+r+'-ZenoComment" placeholder="'+sLocaleFor("Page comment")+'" aria-label="'+sLocaleFor("Page comment")+'"></div><button type="button" id="'+r+'-ZenoCloseButton" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(t){$("#"+r+"-ZenoCloseButton").click((function(){g.close()})),b=a.initializeCodeEditor(r+"-ZenoEditor",p.Code,(()=>{e.reportableChange("Zeno Action")}),(()=>{e.nonReportableChange("Zeno Action")})),$("#"+r+"-ZenoStopCheckbox").prop("checked","true"==p.StopAfterEffect),$("#"+r+"-ZenoComment").val(p.Comment),$("#"+r+"-ZenoStopCheckbox").on("change",(()=>{e.reportableChange("Zeno stop")})),$("#"+r+"-ZenoComment").on("change",(()=>{e.reportableChange("Zeno Comment")}))}},n=sMainResources.getString("Zeno effect action for ODE")+" : "+i;g=WebEJS_TOOLS.createJSPanel(n,t,{minimize:"remove"},S)}()})),$("#"+r+"-ZenoSteps").change((function(){e.reportableChange("ODE ZenoSteps")})),$(t).find(".cVariableChooser").on("click",(t=>{e.selectVariable(t,i)})),function(){var e=d.pages;null==e||e.length<=0?c.setNoPages():($(l).html(a.panelHTML(c,e)),a.initPanel(c,e))}()}},n=sMainResources.getString("Events for ODE")+" : "+i;m=WebEJS_TOOLS.createJSPanel(n,t,{minimize:"remove"},E),$("#"+r+"-ZenoSteps").val(u)}()},c.hide=function(){m&&m.close()},c.setNoPages=function(){$(l).html('<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Events")+"</h5></button>"),a.initPanel(c,null)},c.pageInitialization=function(n,o){const i=a.getPageDivHash(n),s=a.getPageDivName(c,n);var l=o?o.ZeroCondition:"return 1.0; // Condition for "+s,u=o?o.Action:"// Action for "+s;f[i]=a.initializeCodeEditor(r+"-ZeroEditor-"+i,l,(()=>{e.reportableChange("Event Zero Condition")}),(()=>{e.nonReportableChange("Event Zero Condition")})),h[i]=a.initializeCodeEditor(r+"-ActionEditor-"+i,u,(()=>{e.reportableChange("Event Action")}),(()=>{e.nonReportableChange("Event Action")})),n.find("input").on("change",(t=>{e.reportableChange("ODE Event change "+t.target.id)})),n.find("select").on("change",(t=>{e.reportableChange("ODE Event change "+t.target.id)})),o&&($("#"+r+"-TypeSelector-"+i+' option[value="'+o.EventType+'"]').attr("selected",!0),$("#"+r+"-IterationsField-"+i).val(o.Iterations),$("#"+r+"-MethodSelector-"+i+' option[value="'+o.Method+'"]').attr("selected",!0),$("#"+r+"-TolField-"+i).val(o.Tolerance),$("#"+r+"-EndCheckbox-"+i).prop("checked","true"==o.StopAtEvent),$("#"+r+"-Comment-"+i).val(o.Comment)),n.find(".cVariableChooser").on("click",(t=>{a.isPageDisabled(c,n)||e.selectVariable(t,a.getPageDivName(c,n))})),e.showNumberOfEvents(a.getPagesCount(c),t)},c.getPageObject=function(e){var t=a.getPageObject(c,e);return t.Action=h[e].getValue(),t.Comment=$("#"+r+"-Comment-"+e).val(),t.EventType=$("#"+r+"-TypeSelector-"+e+" option:selected").val(),t.Iterations=$("#"+r+"-IterationsField-"+e).val(),t.Method=$("#"+r+"-MethodSelector-"+e+" option:selected").val(),t.StopAtEvent=$("#"+r+"-EndCheckbox-"+e).is(":checked")?"true":"false",t.Tolerance=$("#"+r+"-TolField-"+e).val(),t.ZeroCondition=f[e].getValue(),t},c.pageMainBuilder=function(e,t){return'<div class="h-100 d-flex flex-column" style="flex-grow:1"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Type")+'</span><select id="'+r+"-TypeSelector-"+e+'" class="form-select" ><option value="STATE_EVENT">State event</option><option value="CROSSING_EVENT" selected>Zero crossing</option><option value="POSITIVE_EVENT">Positive crossing</option></select></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Iterations")+'</span><input id="'+r+"-IterationsField-"+e+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:4em;" value="100"><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+r+"-IterationsField-"+e+'"  style="font-size: 1rem;"></i></span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Method")+'</span><select id="'+r+"-MethodSelector-"+e+'" class="form-select"><option value="BISECTION" selected>BISECTION</option><option value="SECANT">SECANT</option></select></div></div></div><div class="container" style="flex-grow:1;"><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span id="'+r+'-ZeroLabel" class="sTranslatable sModelBtn input-group-text btn text-decoration-none" >'+sLocaleFor("Zero condition")+'</span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Tol")+'</span><input id="'+r+"-TolField-"+e+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:8em;" value="1.0e-5" ><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+r+"-TolField-"+e+'"  style="font-size: 1rem;"></i></span></div></div></div><div class="ace" id="'+r+"-ZeroEditor-"+e+'" style="flex-grow:1"></div></div><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+r+"-EndCheckbox-"+e+'" id="'+r+'-EndCheckbox"><label class="sTranslatable form-check-label" for="'+r+'-EndCheckbox">'+sLocaleFor("End step at event")+'</label></span></div></div></div><div class="ace" id="'+r+"-ActionEditor-"+e+'" style="flex-grow:1"></div></div></div></div>'},c.pageCommentBuilder=function(e,t){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+r+"-Comment-"+e+'" placeholder="Page comment" aria-label="Page comment"></div>'},c},WebEJS_GUI.odeParametersPanel=function(e,t,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(t),i=a.getPageDivName(e,t),s="m"+("ODEParametersEditor_"+o),r=s+"-DiscontinuitiesDiv",l=s+"-ErrorHandlingDiv";var c={},u="false",d="false",p="false",m="false",g="",f="",h="",b="10000",v="",_="",E="",S="",T="",y={Comment:"",Code:""},P="",C={pages:[]},O={pages:[]};if(n){u=n.AccelerationIndependentOfVelocity,d=n.ForceSynchronization,p=n.UseBestInterpolation,m=n.EstimateFirstStep,g=n.MemoryLength,f=n.InternalStep,h=n.MaximumStep,b=n.MaximumNumberOfSteps,v=n.RelativeTolerance,_=n.Tolerance,E=n.DelayList,S=n.DelayMaximum,T=n.DelayAddDiscont,y=n.DelayInitialCondition,P=n.DirectIncidenceMatrix;const e=n.Discontinuities;e&&"pages"in e&&(C=e);const t=n.ErrorHandling;t&&"pages"in t&&(O=t)}var w=null,M=WebEJS_GUI.odeDiscontinuityEditor(e,r),x=WebEJS_GUI.odeErrorHandlingEditor(e,l),I=null;function R(){u=$("#"+s+"-AccInd").is(":checked")?"true":"false",d=$("#"+s+"-ForceSynchro").is(":checked")?"true":"false",p=$("#"+s+"-BestInter").is(":checked")?"true":"false",m=$("#"+s+"-EstimateFirst").is(":checked")?"true":"false",g=$("#"+s+"-MemoryLength").val(),f=$("#"+s+"-InternalStep").val(),h=$("#"+s+"-MaximumStep").val(),b=$("#"+s+"-MaxNumSteps").val(),v=$("#"+s+"-RelTol").val(),E=$("#"+s+"-Delays").val(),S=$("#"+s+"-MaximumDelay").val(),T=$("#"+s+"-DelayAddDisc").val(),y={Code:I.getValue(),Comment:$("#"+s+"-DelayComment").val()},C={pages:a.getAllPagesObject(M)},O={pages:a.getAllPagesObject(x)}}c.getContent=function(e){w&&R(),e.AccelerationIndependentOfVelocity=u,e.ForceSynchronization=d,e.UseBestInterpolation=p,e.EstimateFirstStep=m,e.MemoryLength=g,e.InternalStep=f,e.MaximumStep=h,e.MaximumNumberOfSteps=b,e.RelativeTolerance=v,e.Tolerance=_,e.DelayList=E,e.DelayMaximum=S,e.DelayAddDiscont=T,e.DelayInitialCondition=y,e.DirectIncidenceMatrix=P,e.Discontinuities=C,e.ErrorHandling=O};const D={width:Math.min(.7*window.innerWidth,800),height:Math.min(.7*window.innerHeight,800)};function L(){return'<div class="sModelSubpanel h-100 col-12 d-flex flex-column"><ul class="nav nav-tabs nav-fill border" role="tablist" ><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link active" id="'+s+'-OperationTab" data-bs-toggle="tab" data-bs-target="#'+s+'-OperationDiv"  type="button" role="tab" aria-controls="'+s+'-OperationDiv" aria-selected="true">'+sLocaleFor("Operation")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-DiscontinuitiesTab" data-bs-toggle="tab" data-bs-target="#'+s+'-DiscontinuitiesDiv"  type="button" role="tab" aria-controls="'+s+'-DiscontinuitiesDiv" aria-selected="true">'+sLocaleFor("Discontinuities")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-DDETab" data-bs-toggle="tab" data-bs-target="#'+s+'-DDEDiv"  type="button" role="tab" aria-controls="'+s+'-DDEDiv" aria-selected="true">'+sLocaleFor("DDE")+'</button></li><li class="nav-item" role="presentation"><button class="sTranslatable sModelBtn nav-link" id="'+s+'-ErrorHandlingTab" data-bs-toggle="tab" data-bs-target="#'+s+'-ErrorHandlingDiv"  type="button" role="tab" aria-controls="'+s+'-ErrorHandlingDiv" aria-selected="true">'+sLocaleFor("ErrorHandling")+'</button></li></ul><div class="tab-content h-100 col-12 d-flex flex-column" style="flex-grow:1"><div class="sModelSubpanel tab-pane show active" id="'+s+'-OperationDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-OperationTab"><div class="mt-2 form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-AccInd"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-AccInd">'+sLocaleFor("Acc Indep of Velocity")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-ForceSynchro"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-ForceSynchro">'+sLocaleFor("Force synchronization")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-BestInter"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-BestInter">'+sLocaleFor("Use best interpolation")+'</label></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="'+s+'-EstimateFirst"><label class="sTranslatable sModelBtn form-check-label" for="'+s+'-EstimateFirst">'+sLocaleFor("Estimate first step")+'</label></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Memory length")+'</span><input id="'+s+'-MemoryLength" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MemoryLength"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Internal step size")+'</span><input id="'+s+'-InternalStep" type="text" class="form-control"'+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-InternalStep"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Maximum step size")+'</span><input id="'+s+'-MaximumStep" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MaximumStep"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Max number of steps")+'</span><input id="'+s+'-MaxNumSteps" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-MaxNumSteps"  style="font-size: 1rem;"></i></span></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Relative tolerance")+'</span><input id="'+s+'-RelTol" type="text" class="form-control" '+sMainNoAutocorrect+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+s+'-RelTol"  style="font-size: 1rem;"></i></span></div></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-DiscontinuitiesDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-DiscontinuitiesTab"></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-DDEDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-DDETab"><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Delays")+'</span><input id="'+s+'-Delays" type="text" class="form-control" '+sMainNoAutocorrect+'></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Maximum delay")+'</span><input id="'+s+'-MaximumDelay" type="text" class="form-control" '+sMainNoAutocorrect+'></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Pre-IC discontinuities")+'</span><input id="'+s+'-DelayAddDisc" type="text" class="form-control" '+sMainNoAutocorrect+'></div><label for="'+s+'-DelayPreInitCode" class="mt-2 sModelBtn form-label">'+sLocaleFor("Code for pre-initial conditions for")+" "+i+'</label><div class="ace" id="'+s+'-DelayPreInitCode" style="height: 150px;"></div><div class="mt-2 input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input id="'+s+'-DelayComment" type="text" class="form-control" ></div></div><div class="sModelSubpanel tab-pane fade" id="'+s+'-ErrorHandlingDiv" style="flex-grow:1" role="tabpanel" aria-labelledby="'+s+'-ErrorHandlingTab"></div></div></div>'}return c.show=function(){w?(w.resize(D),w.reposition(),w.front()):function(){sMainHideTooltips();const t={content:L(),onbeforeclose:function(e){return R(),w=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<button type="button" id="'+s+'-CloseButton" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(t){$("#"+s+"-CloseButton").click((function(){t.close()})),I=a.initializeCodeEditor(s+"-DelayPreInitCode",y.Code,(()=>{e.reportableChange("Delay Pre Init Code Condition")}),(()=>{e.nonReportableChange("Delay Pre Init Code Condition")})),$(t).find("input").on("change",(t=>{e.reportableChange("ODE Parameter change "+t.target.id)})),$(t).find(".cVariableChooser").on("click",(t=>{e.selectVariable(t,i)})),function(){$("#"+s+"-AccInd").prop("checked","true"==u),$("#"+s+"-ForceSynchro").prop("checked","true"==d),$("#"+s+"-BestInter").prop("checked","true"==p),$("#"+s+"-EstimateFirst").prop("checked","true"==m),$("#"+s+"-MemoryLength").val(g),$("#"+s+"-InternalStep").val(f),$("#"+s+"-MaximumStep").val(h),$("#"+s+"-MaxNumSteps").val(b),$("#"+s+"-RelTol").val(v),$("#"+s+"-Delays").val(E),$("#"+s+"-MaximumDelay").val(S),$("#"+s+"-DelayAddDisc").val(T),$("#"+s+"-DelayPreInitCode").val(y.Code),$("#"+s+"-DelayComment").val(y.Comment);var e=C.pages;null==e||e.length<=0?M.setNoPages():($("#"+r).html(a.panelHTML(M,e)),a.initPanel(M,e));null==(e=O.pages)||e.length<=0?x.setNoPages():($("#"+l).html(a.panelHTML(x,e)),a.initPanel(x,e))}()}},n=sMainResources.getString("Parameters for ODE")+" : "+i;w=WebEJS_TOOLS.createJSPanel(n,t,{minimize:"remove"},D)}()},c.hide=function(){w&&w.close()},c},WebEJS_GUI.odeDiscontinuityEditor=function(e,t){const n=WebEJS_TOOLS.tabbedPanel(),a="#"+t;var o={},i={},s={};return o.getMainPanelSelector=function(){return a},o.getKeyword=function(){return"Discontinuity"},o.getPageName=function(){return"Discontinuity Page"},o.getDefaultPageType=function(){return"DISCONTINUITY_EDITOR"},o.pageDeleted=function(e){const t=n.getPageDivHash(e);delete i[t],delete s[t]},o.reportableChange=function(e){sMainGUI.setChanged()},o.setNoPages=function(){$(a).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Discontinuity")+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(a,r){const l=n.getPageDivHash(a),c=n.getPageDivName(o,a);var u=r?r.ZeroCondition:"return 1.0; // Condition for "+c,d=r?r.Action:"// Action for "+c;i[l]=n.initializeCodeEditor(t+"-ZeroEditor-"+l,u,(()=>{e.reportableChange("ODE Discontinuity Zero Condition")}),(()=>{e.nonReportableChange("ODE Discontinuity Zero Condition")})),s[l]=n.initializeCodeEditor(t+"-ActionEditor-"+l,d,(()=>{e.reportableChange("Disc Action")}),(()=>{e.nonReportableChange("Disc Action")})),a.find("input").on("change",(t=>{e.reportableChange("ODE Discontinuity change "+t.target.id)})),r&&($("#"+t+"-TolField-"+l).val(r.Tolerance),$("#"+t+"-EndCheckbox-"+l).prop("checked","true"==r.StopAtDiscontinuity),$("#"+t+"-Comment-"+l).val(r.Comment)),a.find(".cVariableChooser").on("click",(t=>{e.selectVariable(t,n.getPageDivName(o,a))}))},o.getPageObject=function(e){var a=n.getPageObject(o,e);return a.Action=s[e].getValue(),a.Comment=$("#"+t+"-Comment-"+e).val(),a.StopAtDiscontinuity=$("#"+t+"-EndCheckbox-"+e).is(":checked")?"true":"false",a.Tolerance=$("#"+t+"-TolField-"+e).val(),a.ZeroCondition=i[e].getValue(),a},o.pageMainBuilder=function(e,n){return'<div class="container h-100 d-flex flex-column" style="flex-grow:1"><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span id="'+t+'-ZeroLabel" class="sTranslatable sModelBtn input-group-text btn text-decoration-none" >'+sLocaleFor("Zero condition")+'</span></div><div class="col input-group"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Tol")+'</span><input id="'+t+"-TolField-"+e+'" type="text" class="form-control" '+sMainNoAutocorrect+'style="width:8em;" value="1.0e-5" ><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#'+t+"-TolField-"+e+'"  style="font-size: 1rem;"></i></span></div></div></div><div class="ace mt-1" id="'+t+"-ZeroEditor-"+e+'" style="flex-grow:1; min-height:100px;"></div></div><div class="row d-flex flex-column" style="height:50%;"><div class="container p-0" style="flex-grow:0; flex-basis:0;"><div class="row"><div class="col"><span class="sTranslatable sModelBtn input-group-text btn text-decoration-none">'+sLocaleFor("Action")+'</span></div><div class="col input-group"><span class="form-check"><input class="form-check-input" type="checkbox" value="" checked  name="'+t+"-EndCheckbox-"+e+'" id="'+t+'-EndCheckbox"><label class="sTranslatable form-check-label" for="'+t+'-EndCheckbox">'+sLocaleFor("End step at discontinuity")+'</label></span></div></div></div><div class="ace mt-1" id="'+t+"-ActionEditor-"+e+'" style="flex-grow:1; min-height:100px;"></div></div></div>'},o.pageCommentBuilder=function(e,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+t+"-Comment-"+e+'" placeholder="Page comment" aria-label="Page comment"></div>'},o},WebEJS_GUI.odeErrorHandlingEditor=function(e,t){const n=WebEJS_TOOLS.tabbedPanel(),a="#"+t;var o={},i={};return o.getMainPanelSelector=function(){return a},o.getKeyword=function(){return"OnError"},o.getPageName=function(){return"On Error Page"},o.getDefaultPageType=function(){return"ERROR_EDITOR"},o.pageDeleted=function(e){const t=n.getPageDivHash(e);delete i[t]},o.reportableChange=function(e){sMainGUI.setChanged()},o.setNoPages=function(){$(a).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">'+sLocaleFor("Click to create a page of")+" "+sLocaleFor("Error Handling")+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(a,s){const r=n.getPageDivHash(a),l=n.getPageDivName(o,a);var c=s?s.Code:"// Error handling for "+l;i[r]=n.initializeCodeEditor(t+"-Editor-"+r,c,(()=>{e.reportableChange("ODE Error handling")}),(()=>{e.nonReportableChange("ODE Error handling")})),a.find("input").on("change",(t=>{e.reportableChange("ODE Error handling change "+t.target.id)})),a.find("select").on("change",(t=>{e.reportableChange("ODE Error handling change "+t.target.id)})),s&&($("#"+t+"-TypeSelector-"+r+' option[value="'+s.ErrorType+'"]').attr("selected",!0),$("#"+t+"-Comment-"+r).val(s.Comment))},o.getPageObject=function(e){var a=n.getPageObject(o,e);return a.Code=i[e].getValue(),a.ErrorType=$("#"+t+"-TypeSelector-"+e+" option:selected").val(),a.Comment=$("#"+t+"-Comment-"+e).val(),a},o.pageMainBuilder=function(e,n){return'<div class=" h-100 d-flex flex-column" style="flex-grow:1"><div class="input-group" style="flex-grow:0; flex-basis:0;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Error Type")+'</span><select id="'+t+"-TypeSelector-"+e+'" class="form-select" ><option value="ANY_ERROR">ANY ERROR </option><option value="INTERNAL_SOLVER_ERROR" selected>INTERNAL SOLVER ERROR</option><option value="EVENT_NOT_FOUND">EVENT NOT FOUND</option><option value="ILLEGAL_EVENT_STATE">ILLEGAL EVENT STATE</option><option value="TOO_MANY_STEPS">TOO MANY STEPS</option><option value="DID_NOT_CONVERGE">DID NOT CONVERGE</option></select></div><div class="ace mt-1" id="'+t+"-Editor-"+e+'" style="flex-grow:1; min-height:200px;"></div></div>'},o.pageCommentBuilder=function(e,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="'+t+"-Comment-"+e+'" placeholder="Page comment" aria-label="Page comment"></div>'},o},WebEJS_GUI.odePreliminaryCodePanel=function(e,t,n){const a=WebEJS_TOOLS.tabbedPanel(),o=a.getPageDivHash(t),i=a.getPageDivName(e,t),s=sMainResources.getString("Preliminary code for ODE")+" : "+i,r="mODEPreliminaryCodeEditor_"+o;var l={},c=n?{Code:n.PreliminaryCode.Code,Comment:n.PreliminaryCode.Comment}:{Code:"// "+s,Comment:""},u=null,d=null;function p(){u&&(c={Code:d.getValue(),Comment:$("#"+r+"-Comment").val()})}l.getContent=function(){return p(),c};const m={width:Math.min(.9*window.innerWidth,1200),height:Math.min(.9*window.innerHeight,1200)};return l.show=function(){if(!u)return function(){sMainHideTooltips();const t={content:'<div id="'+r+'-ace" class="ace h-100" style="flex-grow:1"></div>',onbeforeclose:function(e){return p(),u=null,!0},position:{at:"center",of:"#sMainWorkpanel"},footerToolbar:'<div class="h-100 d-flex flex-row" style="flex-grow:1"><div class="input-group input-group-sm" style="flex-grow:1;"><span class="sTranslatable sModelBtn input-group-text">'+sLocaleFor("Comment")+'</span><input type="text" class="flex flex-grow form-control" id="'+r+'-Comment" placeholder="'+sLocaleFor("Page comment")+'" aria-label="'+sLocaleFor("Page comment")+'"></div><button type="button" id="'+r+'-Button" style="flex-grow:0; flex-basis:0;" class="sTranslatable ms-1 input-group-button btn btn-primary float-left">Done</button></div>',callback:function(t){$("#"+r+"-Button").click((function(){u.close()})),d=a.initializeCodeEditor(r+"-ace",c.Code,(()=>{e.nonReportableChange("PrelimCode")}),(()=>{e.nonReportableChange("PrelimCode")})),$("#"+r+"-Comment").val(c.Comment)}};u=WebEJS_TOOLS.createJSPanel(s,t,{minimize:"remove"},m)}();u.resize(m),u.reposition(),u.front()},l.hide=function(){u&&u.close()},l},WebEJS_GUI.codePanelMenuAction=function(e,t,n){switch(e){case"CustomMethods":sMainSelectCodeForm.show("Custom methods",sMainGUI.getModel().getCustomCode().getCustomMethods(),t,n);break;case"ModelMethods":sMainSelectCodeForm.show("Model methods",sMainGUI.getSystemInformation("model_methods"),t,n);break;case"ViewMethods":sMainSelectCodeForm.show("View methods",sMainGUI.getSystemInformation("view_methods"),t,n);break;case"ToolsMethods":sMainSelectCodeForm.show("Tools methods",sMainGUI.getSystemInformation("tools_methods"),t,n)}},WebEJS_GUI.codePanel=function(e,t){const n=WebEJS_TOOLS.tabbedPanel(),a=WebEJS_TOOLS.textTools();var o={},i={};return o.getKeyword=function(){switch(e){case"initialization":return"Initialization";case"fixed_relations":return"FixedRelations";case"custom":return"Custom";default:return e}},o.getPageName=function(){switch(e){case"initialization":return"Init Page";case"fixed_relations":return"FixRel Page";case"custom":return"Custom Page";default:return"Page"}},o.getMainPanelSelector=function(){return t},o.getDefaultPageType=function(){return"CODE_EDITOR"},o.readObject=function(e){if(i={},"pages"in e){const a=e.pages;null==a||a.length<=0?o.setNoPages():($(t).html(n.panelHTML(o,a)),n.initPanel(o,a))}else o.setNoPages();return!0},o.getPageObject=function(t){var a=n.getPageObject(o,t);return a.Comment=$("#m"+e+"PageComment_"+t).val(),a.Code=i[t].getValue(),a},o.saveObject=function(){return{pages:n.getAllPagesObject(o)}},o.getCustomMethods=function(){var e=[];for(var t in i){const s=n.getPageDivNameByHash(o,t),r=i[t].getValue();e.push(...a.getCustomMethods(s,r))}return e},o.reportableChange=function(e){sMainGUI.setChanged()},o.setNoPages=function(){$(t).html('<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create a page of '+function(e){switch(e){case"initialization":return"initialization";case"fixed_relations":return"fixed relations";case"custom":return"custom code"}}(e)+"</h5></button>"),n.initPanel(o,null)},o.pageInitialization=function(e,t){const a=n.getPageDivHash(e);e.find(".ace").each((function(){var s=t?t.Code:"// "+n.getPageDivName(o,e);i[a]=n.initializeCodeEditor($(this).attr("id"),s,(()=>{o.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))})),e.find(".sPageCommentField").on("change",(()=>{sMainGUI.setChanged()})),e.find(".cCodeMenuItem").on("click",(e=>{WebEJS_GUI.codePanelMenuAction($(e.target).data("action"),i[a],o)}))},o.pageDeleted=function(e){const t=n.getPageDivHash(e);delete i[t]},o.pageMainBuilder=function(t,n){return'<div class="ace" id="m'+e+"PageCodeEditor_"+t+'" style="flex-grow:1"></div>'},o.pageCommentBuilder=function(t,n){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="m'+e+"PageComment_"+t+'" placeholder="Page comment" aria-label="Page comment"'+(n&&n.Comment?' value="'+n.Comment+'"':"")+'><span class="sModelBtn input-group-text dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="appearance:none"><i class="bi bi-menu-down"></i></span><ul class="dropdown-menu" data-hash="'+t+'"><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="CustomMethods">Custom methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ModelMethods" >Model methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ViewMethods"  >View methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ToolsMethods" >Tools methods</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cCodeMenuItem py-0" data-action="CodeWizard" >Code wizard</li></ul></div>'},o},WebEJS_GUI.elementsPanel_dragFunction=function(e,t){console.log("Drag saved: "+e.target.dataset.drag_info),e.dataTransfer.setData("text","EJS-model_element:"+e.target.dataset.drag_info)},WebEJS_GUI.elementsPanel=function(){const e="#sModelList",t="border border-danger";var n={},a="",o=[],i=0,s={};function r(e){return e.find(".sMEListElementName").first().text()}function l(e){var t="";"html"in e&&(t+='<span class="cMEreadme col m-2" style="user-select: none;" ><figure class="figure m-2"><img src="'+sMainGUI.getSystemIconURL("info32.png")+'" class="m-0 figure-img img-fluid rounded mx-auto d-block" alt="Read Me"    draggable="false"  data-name="'+e.name+'" data-html="'+e.html+'"><figcaption class="sModelBtn figure-caption text-end">'+sLocaleFor("Read me")+"</figcaption></figure></span>");const n=e.elements;for(var i in n){const e=n[i];o.push(e);var s=e.name;"tooltip"in e&&(s+=" "+e.tooltip),t+='<span class=" cMEreadme col m-2" style="user-select: none;" ><figure class="figure m-2" draggable="true" ondragstart="WebEJS_GUI.elementsPanel_dragFunction(event)" data-drag_info="'+e.classname+'"><img src="'+a+e.icon+'" class="m-0 figure-img img-fluid rounded mx-auto d-block" alt="'+e.name+'"  draggable="false"  data-bs-toggle="tooltip" data-bs-placement="top"  data-html="'+e.html+'" data-name="'+e.name+'" title="'+s+'" ><figcaption class="sModelBtn figure-caption text-center">'+e.name+"</figcaption></figure></span>"}return t}function c(e,t){const n={theme:"bootstrap-light",headerLogo:sMainGUI.getWebEJSLogo(),headerTitle:'<h5 class="sTranslatable text-primary modal-title">'+e+"</h5>",headerControls:{smallify:"remove",minimize:"remove"},position:{at:"center",of:"#sMainWorkpanel"},borderRadius:".3rem",panelSize:{width:Math.min(.7*window.innerWidth,600),height:Math.min(.6*window.innerHeight,800)},content:'<iframe src="'+a+t+'" style="width: 100%; height: 100%;"></iframe>'};jsPanel.modal.create(n),$(".jsPanel-hdr").addClass(["p-1","bg-light"]),$(".jsPanel-content").addClass(["m-1","p-2","bg-light","border","border-dark","rounded"])}function u(e){for(var t in o){const n=o[t];if(n.classname==e)return n}return sMainGUI.errorLine(sMainResources.getString("Attempt to create a NON-SUPPORTED model element:")),sMainGUI.errorLine(sMainResources.getString("  - "+e)),alert("Reading error:\nThe file includes a Model Element class not supported by WebEJS!\nCheck out the output area."),null}function d(t){return t=t.replaceAll(" ","_"),$(e).find(".list-group-item").each((function(e,n){r($(n))==t&&(t=d(t+"New"))})),t}function p(t,n){const o=u(t);if(!o)return;if(i++,s[i]=WebEJS_MODEL_ELEMENTS[o.classname](),!n){n=d(o.name.charAt(0).toLowerCase()+o.name.substring(1))}var r=$(MODEL_ELEMENT_INSTANCE_TEMPLATE.replaceAll("{{CLASSNAME}}",t).replaceAll("{{NAME}}",n).replaceAll("{{HASH}}",i).replaceAll("{{ICON}}",a+o.icon).replaceAll("{{VISIBLE}}",s[i].editConfiguration?"":"d-none"));const l=function(t){const n=t.split(".");t=n[n.length-1];var a=null;return $(e).find(".list-group-item").each((function(e,n){const o=$(n),i=o.data("classname").split(".");if(i[i.length-1].localeCompare(t)>0)return a=o,!1})),a}(o.classname);return l?r.insertBefore(l):$(e).append(r),s[i]}return n.readObject=function(t){$(e).empty();const n=t.list;for(var a in n){const e=n[a],t=p(e.Classname,e.Name);"Contents"in e&&t.readXMLContents(e.Contents)}return!0},n.saveObject=function(){var t=[];return $(e).find(".list-group-item").each((function(e,n){const a=$(n);var o={Classname:a.data("classname"),Name:r(a)};const i=s[a.data("hash")];i.saveXMLContents&&(o.Contents=i.saveXMLContents()),t.push(o)})),{list:t}},n.nonReportableChange=function(e){console.log("Model variable, non reportable change: "+e),sMainGUI.setChanged()},n.buildPalette=function(e){for(var t in a=e.model_elements_folder,elementGroups=e.model_elements,o=[],elementGroups){const e="mModelElementPaletteRow_"+t,o=elementGroups[t];var n=jQuery("<div/>",{class:"accordion-item p-0"}),i='<span class="accordion-header" id="'+e+'-header"><button class="sModelBtn accordion-button py-1" type="button" data-bs-toggle="collapse"  data-bs-target="#'+e+'" aria-expanded="true" aria-controls="'+e+'"><img id="'+e+'_group_button" class="cModelElementGroup" draggable="false" src="'+a+o.icon+'">'+o.name+'</button></span><div id="'+e+'" class="accordion-collapse collapse show" aria-labelledby="'+e+'-header"><div class="mElementPaletteSubpanel accordion-body p-0">'+l(o)+"</div></div>";n.html(i),$("#sModelElementsPaletteSubpanel").append(n)}$(".cMEreadme").on("click",(e=>{c($(e.target).data("name"),$(e.target).data("html"))}))},$(e).on("dblclick",".list-group-item",(function(e){const t=$(e.currentTarget).closest(".list-group-item"),n=t.data("hash");if(s[n].editConfiguration)s[n].editConfiguration();else{const e=u(t.data("classname"));c(e.name,e.html)}})),$(e).on("dragenter",(function(n){n.preventDefault(),$(e).addClass(t)})),$(e).on("dragover",(function(n){n.preventDefault(),$(e).addClass(t)})),$(e).on("dragleave",(function(n){n.preventDefault(),$(e).removeClass(t)})),$(e).on("dragenter",".list-group-item",(function(n){n.preventDefault(),$(e).addClass(t)})),$(e).on("dragover",".list-group-item",(function(n){n.preventDefault(),$(e).addClass(t)})),$(e).on("drop",(function(n){$(e).removeClass(t),$(n.target).hasClass("list-group-item")&&($(n.target).closest(".list-group-item").removeClass(t),console.log("Target = "+r($(n.target))));const a=n.originalEvent.dataTransfer.getData("text");if("EJS-model_element"!=a.split(":")[0])return;const o=a.split(":")[1];"undefined"!=o&&(n.preventDefault(),p(o))})),$(e).on("click",".item-icon",(e=>{const t=r($(e.target).closest(".list-group-item"));$(e.target).parent().find(".cMEMenuHeader").text(sMainResources.getString("Menu for")+" "+t)})),$(e).on("click",".cMEMenuItem",(e=>{!function(e){const t=e.closest(".list-group-item");switch(e.data("action")){case"Edit":const e=t.data("hash");s[e].editConfiguration();break;case"Rename":const n=r(t);sInputForm.show("Rename element","New name",n,(function(e){e!==n&&(e=d(e),function(e,t){e.find(".sMEListElementName").first().text(t)}(t,e))}));break;case"Remove":sMainConfirmationForm.show(r(t),"This action cannot be undone. Do you really want to remove this element?","Remove",(function(){delete s[t.data("hash")],t.remove()}));break;case"Help":const a=u(t.data("classname"));c(a.name,a.html)}}($(e.target))})),n},MODEL_ELEMENT_INSTANCE_TEMPLATE='\n<div role="treeitem" class="list-group-item py-0 border-1" style="padding-left:10" data-hash={{HASH}} data-classname="{{CLASSNAME}}">\n\t<span class="dropdown">\n\t\t<img class="item-icon dropdown" style="padding: 0 2px 0 2px;" src="{{ICON}}" \n\t\t\tid="mMEItemMenuIcon_{{HASH}}" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n\t\t</img>\n\t\t<ul class="dropdown-menu py-0" aria-labelledby="mMEItemMenuIcon_{{HASH}}">\n\t\t\t<li><span class="cMEMenuHeader dropdown-item-text py-0 fw-bold">Menu</span></li>\n\n\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t<li class="{{VISIBLE}} dropdown-item sTranslatable cMEMenuItem" data-action="Edit">Edit</li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Rename">Rename</li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Help">Help</li>\n\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t<li class="dropdown-item sTranslatable cMEMenuItem" data-action="Remove">Remove</li>\n\t\t</ul>\n\t</span>\n\t<span class="sMEListElementName">{{NAME}}</span>\n</div>\n',WebEJS_GUI.eventPanel=function(e,t,n){const a=WebEJS_TOOLS.tabbedPanel();WebEJS_TOOLS.textTools();var o={getKeyword:function(){return" Event"},getPageName:function(){return"Event"},getMainPanelSelector:function(){return e},getDefaultPageType:function(){return"EVENT_EDITOR"}};const i='<div class="col-12 h-100 d-flex flex-column">#{content}<div class="m-1 d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm" style="flex-basis:0;"><label class="sTranslatable sModelBtn input-group-text cODEZenoEffectButton">Zeno effect action</label></div><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Check events at steps no larger than</span><input type="text" class="form-control form-control-sm ps-1 cODEEventsStepSize" '+sMainNoAutocorrect+' id="mEventPageEditor_StepSize_'+t+'" ><span class="input-group-text"><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#mEventPageEditor_StepSize_'+t+'"  style="font-size: 1rem;"></i></span></div></div></div>';return o.readObject=function(t){null==t||t.length<=0?o.setNoPages():($(e).html(a.panelHTML(o,t)),a.initPanel(o,t)),$(e).find(".cODEZenoEffectButton").on("click",(e=>{alert("Zenno efect panel here")})),$(e).find(".cVariableChooser").on("click",(e=>{var t=$(e.target).data("types").split("|"),n=$(e.target).data("field");$(n).val().trim();sMainSelectChoiceForm.show("List of suitable variables",function(e){const t=e.split("|");for(var n=sMainGUI.getModel().getVariables().getVariablesOfType(t),a=[],o=0;o<n.length;o++){const e=n[o],t="("+e.type+e.dimension+") : "+e.comment;a.push({name:e.name,value:e.name,description:t,style:"sModelBtn"})}return a}(t),value,(function(e){e!=value&&($(n).val(e),o.nonReportableChange("Parameter changed on "+a.getPageDivName(o,mPageDiv)))}))}))},o.getPageObject=function(e){var t=a.getPageObject(o,e);return t.Comment=$("#m"+mKeyword+"PageComment_"+e).val(),t.Code=mCodeEditors[e].getValue(),t},o.saveObject=function(){return{pages:a.getAllPagesObject(o)}},o.reportableChange=function(e){sMainGUI.setChanged()},o.setNoPages=function(){var t=i.replace(/#{content}/g,'<button class="sModelBtn sPanelNoPageBtn active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create an event page</h5></button>');$(e).html(t),a.initPanel(o,null)},o.pageInitialization=function(e,t){const n=a.getPageDivHash(e);e.find(".ace").each((function(){var i=t?t.Code:"// "+a.getPageDivName(o,e);mCodeEditors[n]=a.initializeCodeEditor($(this).attr("id"),i,(()=>{o.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))})),e.find(".sPageCommentField").on("change",(()=>{sMainGUI.setChanged()})),e.find(".cCodeMenuItem").on("click",(t=>{WebEJS_GUI.codePanelMenuAction($(t.target).data("action"),mCodeEditors[n],o),codeMenuAction(e,$(t.target).data("action"))}))},o.pageDeleted=function(e){const t=a.getPageDivHash(e);mCodeEditors[t]=null},o.pageMainBuilder=function(e,t){return'<div class="ace" id="m'+mKeyword+"PageCodeEditor_"+e+'" style="flex-grow:1"></div>'},o.pageCommentBuilder=function(e,t){return'<div class="input-group input-group-sm dropup drop-start" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="m'+mKeyword+"PageComment_"+e+'" placeholder="Page comment" aria-label="Page comment"'+(t&&t.Comment?' value="'+t.Comment+'"':"")+'><span class="sModelBtn input-group-text dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="appearance:none"><i class="bi bi-menu-down"></i></span><ul class="dropdown-menu" data-hash="'+e+'"><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="CustomMethods">Custom methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ModelMethods" >Model methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ViewMethods"  >View methods</li><li class="dropdown-item sTranslatable cCodeMenuItem" data-action="ToolsMethods" >Tools methods</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cCodeMenuItem py-0" data-action="CodeWizard" >Code wizard</li></ul></div>'},o},WebEJS_GUI.evolutionPanel=function(e){const t=WebEJS_TOOLS.tabbedPanel();var n={},a=WebEJS_TOOLS.tablePanel(n),o="",i={},s={},r={},l={};function c(e){const t=e.split("|");for(var n=sMainGUI.getModel().getVariables().getVariablesOfType(t),a=[],o=0;o<n.length;o++){const e=n[o],t="("+e.type+e.dimension+") : "+e.comment;a.push({name:e.name,value:e.name,description:t,style:"sModelBtn"})}return a}function u(e){a.getRows(e).each((function(){const t=$(this).find(".cODEstate").first(),n=t.find(".cODEvalue").val();d(t,e,n)}))}function d(e,t,n){const a=$("#mEvolutionPageEditor_IndependentVariable_"+t).val();var o=sMainSimulationOptions.useDeltaForODEs(),i=o=sMainSimulationOptions.useDeltaForODEs()?"&#916;":"d";i='<span class="fw-bold">'+o+"</span> "+n+'<span class="fw-bold"> / '+o+"</span> "+a,e.find(".cODEvalue").val(n),e.find(".cODEdisplay").html(i)}function p(e,t){e.find(".cODEvalue").val(t),e.find(".cODEdisplay").html(t)}n.getMainPanelSelector=function(){return e},n.getKeyword=function(){return"Evolution"},n.getPageName=function(){return"Evol Page"},n.getDefaultPageType=function(){return"EVOLUTION_EDITOR"},n.getSecondType=function(){return"ODE_EDITOR"},n.getSecondTypeLabel=function(){return"Create a new page of ODEs"},n.isPageSecondType=function(e){return e.find(".cODEtable").length>0},n.disablePage=function(e,a){n.isPageSecondType(t.getDivPageByHash(n,e))&&a&&(s[e].hide(),r[e].hide(),l[e].hide())},$("#sEvolParamFPSRange").on("input",(e=>{var t=e.target.value;t<25?$("#sEvolParamFPS").val(t):$("#sEvolParamFPS").val(100),n.nonReportableChange("FPS changed")})),$("#sEvolParamFPSRange").on("mouseup",(e=>{var t={action:"SetFPS",value:e.target.value};n.nonReportableChange(t)})),$("#sEvolParamFPSRange").on("touchend",(e=>{var t={action:"SetFPS",value:e.target.value};n.nonReportableChange(t)})),$("#sEvolParamFPS").on("change",(()=>{var e=Math.round($("#sEvolParamFPS").val());isNaN(e)&&(e=15),e<1&&(e=1),e>24?($("#sEvolParamFPSRange").val(25),e=100):$("#sEvolParamFPSRange").val(e),$("#sEvolParamFPS").val(e);var t={action:"SetFPS",value:e};n.nonReportableChange(t)})),$("#sEvolParamSPD").on("change",".sEvolParamSPD",(()=>{var e={action:"SetSPD",value:$("#sEvolParamSPD").val()};n.nonReportableChange(e)})),n.readObject=function(c){if(i={},s={},r={},l={},"information"in c){const e=c.information;e.FPS>24?$("#sEvolParamFPSRange").val(25):$("#sEvolParamFPSRange").val(e.FPS),$("#sEvolParamFPS").val(e.FPS),$("#sEvolParamSPD").val(e.SPD),"false"==e.Autoplay?$("#sEvolParamAutoplay").prop("checked",!1):$("#sEvolParamAutoplay").prop("checked",!0),o="RealTimeVariable"in c?c.RealTimeVariable:""}else $("#sEvolParamFPSRange").val(20),$("#sEvolParamFPS").val(20),$("#sEvolParamSPD").val(1),$("#sEvolParamAutoplay").prop("checked",!0),o="";if("pages"in c){const o=c.pages;null==o||o.length<=0?n.setNoPages():($(e).html(t.panelHTML(n,o)),t.initPanel(n,o),a.processRowsToSet())}else n.setNoPages();return!0},n.getPageObject=function(e){var o=t.getPageObject(n,e);return o.Comment=$("#mEvolutionPageComment_"+e).val(),n.isPageSecondType(t.getDivPageByHash(n,e))?(o.IndependentVariable=$("#mEvolutionPageEditor_IndependentVariable_"+e).val(),o.Increment=$("#mEvolutionPageEditor_Increment_"+e).val(),o.Equations=a.getTableRows(e),o.Method=$("#mEvolution_PageEditor_Method_"+e+" option:selected").val(),o.AbsoluteTolerance=$("#mEvolution_PageEditor_Tolerance_"+e).val(),o.PreliminaryCode=s[e].getContent(),r[e].getContent(o),l[e].getContent(o)):o.Code=i[e].getValue(),o},n.saveObject=function(){return{information:{FPS:$("#sEvolParamFPSRange").val(),SPD:$("#sEvolParamSPD").val(),RealTimeVariable:o,Autoplay:$("#sEvolParamAutoplay").prop("checked")?"true":"false"},pages:t.getAllPagesObject(n)}},n.nonReportableChange=function(e){console.info("Model evolution, non reportable change: "+e),sMainGUI.setChanged()},n.reportableChange=function(e){console.info("Model evolution, reportable change: "+e),sMainGUI.setChanged()},n.setNoPages=function(){$(e).html('<div class="h-100 col-12 mx-auto btn-group-vertical" style="flex-grow:1;"><button class="sModelBtn sPanelNoPageBtn col-12 h-50 active" data-type="'+n.getDefaultPageType()+'" ><h5 class="sTranslatable">Click to create a page of code</h5></button><button class="sModelBtn sPanelNoPageBtn col-12 h-50 active" data-type="'+n.getSecondType()+'" ><h5 class="sTranslatable">Click to create a page of ODEs</h5></button></div>'),t.initPanel(n,null)},n.pageMainBuilder=function(e,t,n){return"ODE_EDITOR"==n?function(e,t){const n=sMainGUI.getSystemInformation("solvers"),o=t?t.Equations:[];var i='<div class="tabContent d-flex flex-column" style="flex-grow:1"><div id="mEvolutionPageEditor_'+e+'" class="cODEtable table-responsive d-flex flex-column" style="flex-grow:1"><div class="m-1 d-flex flex-row" style="flex-basis:0;flex-grow: 0"><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Indep. Var.</span><input type="text" class="form-control form-control-sm ps-1 cODEIndepVar" '+sMainNoAutocorrect+' id="mEvolutionPageEditor_IndependentVariable_'+e+'" '+(t?"value="+t.IndependentVariable:"")+'><span class="input-group-text"><i class="sModelBtn bi bi-link cVariableChooser cEvolutionIndepVar"  data-types="int|double"  data-field="#mEvolutionPageEditor_IndependentVariable_'+e+'"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm me-1" style="flex-grow: 1"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Increment</span><input type="text" class="form-control form-control-sm ps-1 sODEIncrement" '+sMainNoAutocorrect+' id="mEvolutionPageEditor_Increment_'+e+'" '+(t?"value="+t.Increment:"")+'><span class="input-group-text" ><i class="sModelBtn bi bi-link cVariableChooser"  data-types="int|double"  data-field="#mEvolutionPageEditor_Increment_'+e+'"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm" style="flex-basis:0;"><label class="sTranslatable sModelBtn input-group-text cODEPrelimCodeButton">Prelim code</label></div></div><div class="sModelBorderedPanel table-responsive" style="flex-grow: 1">'+a.getTableHTML(e,m,o)+'</div><div class="m-1" style="flex-basis: 0;flex-grow: 0"><div class="d-flex flex-row"><div class="input-group input-group-sm me-1" style="flex-grow: 5"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Solver</span><select class="form-select" id="mEvolution_PageEditor_Method_'+e+'">';const s=t?t.Method:sMainGUI.getSystemInformation("default_solver");for(methodIndex in n){var r=n[methodIndex];r.key==s?i+='<option selected value="'+r.key+'">'+r.name+"</option>":i+='<option value="'+r.key+'">'+r.name+"</option>"}return i+='</select></div><div class="input-group input-group-sm me-1" style="flex-grow: 5"><span class="sTranslatable sModelBtn input-group-text p-1 pe-2">Tol</span><input type="text" class="form-control form-control-sm ps-1"  placeholder="Absolute tolerance" aria-label="Absolute tolerance"'+sMainNoAutocorrect+' id="mEvolution_PageEditor_Tolerance_'+e+'" '+(t&&t.AbsoluteTolerance?' value="'+t.AbsoluteTolerance+'"':"")+'><span class="input-group-text"><i class="sModelBtn bi bi-link col-12 cVariableChooser"  data-types="int|double"  data-field="#mEvolution_PageEditor_Tolerance_'+e+'"  data-name="tolerance"  style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm me-1" style="flex-basis: 0"><span class="input-group-text sODEParameters cODEParametersButton"><i class="sModelBtn bi bi-table" style="font-size: 1rem;"></i></span></div><div class="input-group input-group-sm" style="flex-basis:0;"><span class="sTranslatable sModelBtn cODEEventsButton input-group-text p-1 pe-2" id="mEvolution_PageEvents_'+e+'">'+sLocaleFor("Events")+"</span></div></div></div></div></div>"}(e,t):'<div class="ace" id="mEvolutionPageCodeEditor_'+e+'" style="flex-grow:1"></div>'},n.pageCommentBuilder=function(e,t){return'<div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="sPageCommentField form-control" id="mEvolutionPageComment_'+e+'" placeholder="Page comment" aria-label="Page comment"'+(t&&t.Comment?' value="'+t.Comment+'"':"")+"></div>"},n.selectVariable=function(e,t){const a=$(e.target).data("types"),o=$(e.target).data("field"),i=$(o).val().trim();sMainSelectChoiceForm.show("List of suitable variables",c(a),i,(function(a){a!=i&&($(o).val(a),$(e.target).hasClass("cEvolutionIndepVar")&&u(pageHash),n.nonReportableChange("Parameter changed on "+t+" ("+o+")"))}))},n.pageInitialization=function(e,o){const c=t.getPageDivHash(e);if(n.isPageSecondType(e)){t.getPageDivName(n,e);s[c]=WebEJS_GUI.odePreliminaryCodePanel(n,e,o),r[c]=WebEJS_GUI.odeEventsPanel(n,e,o),l[c]=WebEJS_GUI.odeParametersPanel(n,e,o),e.find(".cVariableChooser").on("click",(a=>{t.isPageDisabled(n,e)||n.selectVariable(a,t.getPageDivName(n,e))})),e.find(".cODEIndepVar").on("change",(e=>{u(c)})),e.find(".cODEPrelimCodeButton").on("click",(function(){t.isPageDisabled(n,e)||s[c].show()})),e.find(".cODEEventsButton").on("click",(function(){t.isPageDisabled(n,e)||r[c].show()})),e.find(".cODEParametersButton").on("click",(function(){t.isPageDisabled(n,e)||l[c].show()})),e.find(".cODEPrelimCodeButton").on("click",(function(){t.isPageDisabled(n,e)||s[c].show()})),a.tableInitialization(c)}else e.find(".ace").each((function(){var a=o?o.Code:"// "+t.getPageDivName(n,e);i[c]=t.initializeCodeEditor($(this).attr("id"),a,(()=>{n.reportableChange("PageContent")}),(()=>{sMainGUI.setChanged()}))}))},n.pageDeleted=function(e){const a=t.getPageDivHash(e);n.isPageSecondType(e)?(s[a].hide(),delete s[a],r[a].hide(),delete r[a],l[a].hide(),delete l[a]):delete i[a]},n.showNumberOfEvents=function(e,n){const a=t.getPageDivHash(n);$("#mEvolution_PageEvents_"+a).text(e+" "+sLocaleFor("Events"))},n.tableRowInitialization=function(e,o,i){i.find(".cODEstate").on("click",(o=>{const s=t.getDivPageByHash(n,e);if(t.isPageDisabled(n,s))return;const r=$(o.target).closest(".cODEstate"),l=r.find(".cODEvalue").val();sMainSelectChoiceForm.show("List of suitable variables",c("double|double[]"),l,(function(t){t!=l&&(d(r,e,t),i.is(":last-child")&&a.appendEmptyRow(e),n.nonReportableChange("ODE state changed on "+e))}))})),i.find(".cODErate").on("click",(o=>{const s=t.getDivPageByHash(n,e);if(t.isPageDisabled(n,s))return;const r=$(o.target).closest(".cODErate"),l=r.find(".cODEvalue").val();sMainSelectChoiceForm.show("List of suitable variables",c("int|int[]|double|double[]"),l,(function(t){t!=l&&(p(r,t),i.is(":last-child")&&a.appendEmptyRow(e),n.nonReportableChange("ODE Rate changed on "+e))}))}))};const m=[{name:"State"},{name:""},{name:"Rate",class:"col-11"}];n.getTableEmptyRow=function(){return{state:"",rate:""}},n.getTableRowHTML=function(e,t,n){return'<td id="'+n+'State" class="col-4 cODEstate"><input hidden class="cODEvalue" type="text" '+sMainNoAutocorrect+'/><span class="cODEdisplay fw-normal" ></span></td><td class="fw-bold">=</td><td id="'+n+'Rate" class="col-8 cODErate"><input hidden class="cODEvalue" type="text" '+sMainNoAutocorrect+'/><span class="cODEdisplay fw-normal" ></span></td>'},n.setTableRow=function(e,t,n){d($("#"+t+"State"),e,n.state),p($("#"+t+"Rate"),n.rate)};return n.getTableRowObject=function(e){return{state:$(e[1]).find(".cODEvalue").val(),rate:$(e[3]).find(".cODEvalue").val()}},n},WebEJS_GUI.variablesPanel=function(e){const t=WebEJS_TOOLS.tabbedPanel(),n=WebEJS_TOOLS.textTools();var a={},o=WebEJS_TOOLS.tablePanel(a);function i(e){var n=[];return t.getAllPagesDivList(a).each((function(){if(!t.isPageDisabled(a,$(this))){const a=t.getPageDivHash($(this));n.push(...o.getTableRows(a,e))}})),n}function s(){for(var e=i(!0),t=[],a=0;a<e.length;a++){(s=e[a]).Name.trim().length<=0||t.push({name:s.Name,value:s.Value,dimension:s.Dimension,tr:s._tr_})}n.checkCode(t);var o=!0;for(var a in t){var s;(s=t[a]).run_ok?s.tr.removeClass("bg-warning"):(s.tr.addClass("bg-warning"),o=!1)}return o}a.getMainPanelSelector=function(){return e},a.getKeyword=function(){return"Variables"},a.getPageName=function(){return"Var Table"},a.getDefaultPageType=function(){return"VARIABLE_EDITOR"},a.disablePage=function(e,t){t&&o.removeWarnings(e)},a.readObject=function(n){if("pages"in n){var i=n.pages;null==i||i.length<=0?a.setNoPages():($(e).html(t.panelHTML(a,i)),t.initPanel(a,i),o.processRowsToSet(),s())}else a.setNoPages();return!0},a.getPageObject=function(e){var n=t.getPageObject(a,e);return n.PageComment=$("#mVariablesPageComment_"+e).val(),n.Variables=o.getTableRows(e),n},a.saveObject=function(){return{pages:t.getAllPagesObject(a)}},a.getVariablesOfType=function(e){for(var t=i(!1),n=[],a=0;a<t.length;a++){var o=t[a];if(!(o.Name.trim().length<=0)){var s=o.Type,r=o.Dimension.trim();r.length>0&&(s+="[]"),e.includes(s)&&(r.length>0&&"["!=r[0]&&(r="["+r+"]"),n.push({name:o.Name,type:o.Type,dimension:r,comment:o.Comment}))}}return n},a.nonReportableChange=function(e){console.log("Model variable, non reportable change: "+e),sMainGUI.setChanged()},a.reportableChange=function(e){if(console.log("Model variable, reportable change: "+e),sMainGUI.setChanged(),s()){var t={panel:"model",action:"setVariables",pages:a.saveObject().pages};sMainGUI.reportPreview(t)}},a.setNoPages=function(){$(e).html('<button class="sModelBtn sPanelNoPageBtn h-100 col-12 active" style="flex-grow:1;"><h5 class="sTranslatable">Click to create a page of variables<h5></button>'),t.initPanel(a,null)},a.pageMainBuilder=function(e,t){const n=t?t.Variables:[];return o.getTableHTML(e,l,n)},a.pageCommentBuilder=function(e,t){return'<div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Comment</span><input type="text" class="form-control cCommentField" id="mVariablesComment_'+e+'" disabled value=""/></div><div class="input-group input-group-sm" style="flex-grow: 1;"><span class="sTranslatable sModelBtn input-group-text">Page comment</span><input type="text" class="sPageCommentField form-control" id="mVariablesPageComment_'+e+'" placeholder="Page comment" aria-label="Page comment"'+(t&&t.PageComment?' value="'+t.PageComment+'"':"")+"></div>"},a.pageInitialization=function(e,n){const i=t.getPageDivHash(e);o.tableInitialization(i),$("#mVariablesComment_"+i).on("change",(e=>{var t=parseInt($(e.target).data("row_hash"));if(isNaN(t))return;const n=o.findRowTDArrayByHash(i,t);n&&o.setText(n,u,$(e.target).val()),a.nonReportableChange("Variable comment changed")})),e.find(".sPageCommentField").on("change",(()=>{a.nonReportableChange("Page comment changed")}))},a.tableRowInitialization=function(e,t,n){n.find(".cTypeMenuItem").on("click",(e=>{const t=n.children();o.setText(t,c,$(e.target).data("type"));const i=a.getTableRowObject(t);a.reportableChange("Changed type of Variable "+i.Name)})),n.find("input").on("change",(t=>{if("checkbox"==$(t.target).attr("type"))return;const i=n.children(),s=a.getTableRowObject(i);a.reportableChange("Changed variable "+s.Name),n.is(":last-child")&&o.appendEmptyRow(e)})),n.find("input").on("focus",(a=>{const i=$("#mVariablesComment_"+e);i.attr("disabled",!1),i.data("row_hash",t),i.val(o.getText(n.children(),u)),o.highlightRows(e,t)}))};const r='<div class="dropdown" data-target="type"><button class="btn btn-link text-decoration-none dropdown-toggle typeMenuButton" style="padding:0px 5px 0px 0px; border:0px; "type="button" id="VarTableTypeMenuButton_#{label}" data-bs-toggle="dropdown" aria-expanded="false"></button><ul class="dropdown-menu"  aria-labelledby="VarTableTypeMenuButton_#{label}"><li class="dropdown-item cTypeMenuItem" data-type="boolean">boolean</li><li class="dropdown-item cTypeMenuItem" data-type="int">int</li><li class="dropdown-item cTypeMenuItem" data-type="double">double</li><li class="dropdown-item cTypeMenuItem" data-type="String">String</li><li class="dropdown-item cTypeMenuItem" data-type="Object">Object</li></ul></div>',l=[{name:"Name"},{name:"Initial Value"},{name:""},{name:"Type"},{name:"Dimension"}];a.getTableEmptyRow=function(){return{Name:"",Value:"",Type:"double",Dimension:"",Comment:"",Domain:""}},a.getTableRowHTML=function(e,t,n){return'<td><input id="'+n+'Name"   type="text" class="col-12"'+sMainNoAutocorrect+'/></td><td><input id="'+n+'Value"  type="text" class="col-12"'+sMainNoAutocorrect+"/></td><td>"+r.replace(/#\{label\}/g,e+"_"+t)+'</td><td><input id="'+n+'Type"   type="text" class="col-12 cTypeColumn"'+sMainNoAutocorrect+'/></td><td><input id="'+n+'Dimension"  type="text" class="col-12"'+sMainNoAutocorrect+'/></td><td hidden><input id="'+n+'Comment" type="text" /></td><td hidden><input id="'+n+'Domain" type="text" /></td>'},a.setTableRow=function(e,t,n){$("#"+t+"Name").val(n.Name),$("#"+t+"Value").val(n.Value),$("#"+t+"Type").val(n.Type),$("#"+t+"Dimension").val(n.Dimension),$("#"+t+"Comment").val(n.Comment),$("#"+t+"Domain").val(n.Domain)},a.rowRemoved=function(e,t){const n=$("#mVariablesComment_"+e);n.data("row_hash")==t&&(n.data("row_hash",null),n.attr("disabled",!0),n.val(""))};const c=4,u=6;return a.getTableRowObject=function(e){return{Name:o.getText(e,1),Value:o.getText(e,2),Type:o.getText(e,c),Dimension:o.getText(e,5),Comment:o.getText(e,u),Domain:o.getText(e,7)}},a},WebEJS_GUI.optionsSimulationPanel=function(){var e={},t=null,n=null;e.toggle=function(){if(sMainHideTooltips(),t)return t.close(),sMainGUI.setSimulationOptionsRadio(!1),!1;const e={content:p,onbeforeclose:function(e){return d(),t=null,!0},onclosed:function(e,n){t=null,sMainGUI.setSimulationOptionsRadio(!1)},footerToolbar:'<button type="button" id="mSimulationOptionsEditorDoneButton" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(e){u(n),$("#mSimulationOptionsEditorDoneButton").click((function(){t.close()})),sMainRefreshTooltips()}};t=WebEJS_TOOLS.createJSPanel(sMainResources.getString("Simulation options"),e),sMainGUI.setSimulationOptionsRadio(!0)};var a=[],o=0,i=[],s=0;function r(e,t){for(var n=0;n<t.length;n++)if(entry=t[n].hash==e)return n;return-1}function l(e,t,n,a){for(var o="",i=0;i<t.length;i++){const e=t[i].hash;var s=t[i].logo;s=s.length<=0?sMainGUI.getSystemIconURL("question-square.svg"):sMainGUI.getURLpathFor(s),o+='<button class="p-1 btn btn-outline-secondary btn-link text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="'+sMainResources.getString("Click to choose a "+n+" x "+a+" PNG file)")+'"><img width="'+n+'" height="'+a+'" class="d-inline-block align-bottom;" src="'+s+'" data-hash="'+e+'" ></button>'}$(e).html(o),sMainRefreshTooltips()}function c(e){for(var t="",n=0;n<e.length;n++){t+="<option>"+e[n].trim()+"</option>"}$("#mSimulationOptionsDetectedFiles").html(t)}function u(t){$("#mSimulationOptionsTitle").val(t.Title);for(var n="",u=0;u<a.length;u++){const e=a[u].name.trim();n+='<option value="'+a[u].hash+'">'+e+"</option>"}$("#mSimulationOptionsAuthor").html(n),l("#mSimulationOptionsAuthorLogoGallery",a,50,50),$("#mSimulationOptionsAuthorLogoGallery").on("click","img",(function(){const e=$(this),t=$(this).data("hash");WebEJS_TOOLS.selectFile(["png","gif","jpg","jpeg"],(function(n,o){const i=r(t,a);i<0?alert("Author hash not found: "+t):(a[i].logo=n,e.attr("src",o))}),!0,null)})),$("#mSimulationOptionsAuthorAdd").click((e=>{const t=prompt(sMainResources.getString("Author name:"),"");null==t||t.trim().length<=0||(o++,a.push({name:t,logo:"",hash:o}),$("#mSimulationOptionsAuthor").append($("<option>",{value:o,text:t})),$('#mSimulationOptionsAuthor option[value="'+o+'"]').attr("selected",!0),l("#mSimulationOptionsAuthorLogoGallery",a,50,50))})),$("#mSimulationOptionsAuthorEdit").click((e=>{const t=$("#mSimulationOptionsAuthor option:selected");var n=t.val();const o=r(n,a);if(o<0)return void alert("Author hash not found: "+n);const i=prompt(sMainResources.getString("Author name:"),a[o].name);null==i||i.trim().length<=0||(a[o].name=i,t.val(i),t.text(i))})),$("#mSimulationOptionsAuthorDelete").click((e=>{const t=$("#mSimulationOptionsAuthor option:selected");var n=t.val();const o=r(n,a);o<0?alert("Author hash not found: "+n):(a.splice(o,1),t.remove(),l("#mSimulationOptionsAuthorLogoGallery",a,50,50))})),$("#mSimulationOptionsCopyright").val(t.Copyright),$("#mSimulationOptionsKeywords").val(t.Keywords),$("#mSimulationOptionsLevel").val(t.Level),$("#mSimulationOptionsLanguages").val(t.Language),$("#mSimulationOptionsAbstract").val(t.Abstract);for(n="",u=0;u<i.length;u++){const e=i[u].logo.trim();n+='<option value="'+i[u].hash+'">'+e+"</option>"}$("#mSimulationOptionsLogo").html(n),l("#mSimulationOptionsLogoGallery",i,320,180),$("#mSimulationOptionsLogoGallery").on("click","img",(function(){const e=$(this),t=$(this).data("hash");WebEJS_TOOLS.selectFile(["png","gif","jpg","jpeg"],(function(n,a){const o=r(t,i);o<0?alert("Logo hash not found: "+t):(i[o].logo=n,$('#mSimulationOptionsLogo option[value="'+t+'"]').text(n),e.attr("src",a))}),!0,null)})),$("#mSimulationOptionsLogoAdd").click((e=>{WebEJS_TOOLS.selectFile(["png","gif","jpg","jpeg"],(function(e,t){s++,i.push({logo:e,hash:s}),$("#mSimulationOptionsLogo").append($("<option>",{value:s,text:e})),$('#mSimulationOptionsLogo option[value="'+s+'"]').attr("selected",!0),l("#mSimulationOptionsLogoGallery",i,320,180)}),!0,null)})),$("#mSimulationOptionsLogoDelete").click((e=>{const t=$("#mSimulationOptionsLogo option:selected");var n=t.val();const a=r(n,i);a<0?alert("Logo hash not found: "+n):(a>-1&&i.splice(a,1),t.remove(),l("#mSimulationOptionsLogoGallery",i,320,180))})),$("#mSimulationOptionsEditorMustPause").prop("checked","false"==t.RunAlways),$("#mSimulationOptionsModelTab").val(t.ModelTab),$("#mSimulationOptionsModelTabTitle").val(t.ModelTabTitle),$("#mSimulationOptionsModelName").val(t.ModelName),$("#mSimulationOptionsFixedNavigationBar").prop("checked","false"==t.FixedNavigationBar),$("#mSimulationOptionsCSS").val(t.CSSFile),$("#mSimulationOptionsCSSEdit").click((e=>{WebEJS_TOOLS.selectFile(["css"],(function(e,t){$("#mSimulationOptionsCSS").val(e)}),!0,null)})),$("#mSimulationOptionsCSSDelete").click((e=>{$("#mSimulationOptionsCSS").val("")}));var d=!0;"IncludeSource"in t&&(d="false"!=t.IncludeSource),$("#mSimulationOptionsIncludeSource").prop("checked",d),d=!0,"IncludeLibrary"in t&&(d="false"!=t.IncludeLibrary),$("#mSimulationOptionsIncludeLibrary").prop("checked",d),d=!1,"SaveInXMLFormat"in t&&(d="true"==t.SaveInXMLFormat),$("#mSimulationOptionsSaveAsXML").prop("checked",d),d=!1,"UglifyJS"in t&&(includeCheck="true"==t.UglifyJS),$("#mSimulationOptionsUglifyJS").prop("checked",includeCheck);{const e=t.AuxiliaryFiles;for(n="",u=0;u<e.length;u++){n+="<option>"+e[u].trim()+"</option>"}$("#mSimulationOptionsUserFiles").html(n),$("#mSimulationOptionsUserFilesAdd").click((e=>{$("#mFileChooserModal").data("bs-target","#sMainSimulationOptionsModal").data("bs-toggle","modal").data("bs-dismiss","modal"),WebEJS_TOOLS.selectFile(null,(function(e){e.startsWith("/")||e.startsWith("./")||(e="./"+e);const t=$("<option>",{text:e});$("#mSimulationOptionsUserFiles").append(t),t.attr("selected",!0)}),!1,null)})),$("#mSimulationOptionsUserFilesDelete").click((e=>{$("#mSimulationOptionsUserFiles option:selected").remove()}))}c(t.DetectedFiles),$("#mSimulationOptionsDetectedFilesRefresh").click((t=>{e.updateDetectedFiles()})),$("#mSimulationOptionsHtmlHead").val(t.HTMLHead),$("#mSimulationOptionsEditorFullModel").prop("checked","true"==t.PreviewFullModel),$("#mSimulationOptionsEditorParse").prop("checked","true"==t.UseInterpreter),$("#mSimulationOptionsEditorUseDelta").prop("checked","true"==t.UseDeltaForODE)}function d(){n.Title=$("#mSimulationOptionsTitle").val(),n.Author=[],n.AuthorLogo=[];for(var e=0;e<a.length;e++)n.Author.push(a[e].name),n.AuthorLogo.push(a[e].logo);n.Keywords=$("#mSimulationOptionsKeywords").val(),n.Abstract=$("#mSimulationOptionsAbstract").val(),n.Copyright=$("#mSimulationOptionsCopyright").val(),n.Level=$("#mSimulationOptionsLevel").val(),n.Language=$("#mSimulationOptionsLanguages").val(),n.Logo=[];for(e=0;e<i.length;e++)n.Logo.push(i[e].logo);n.RunAlways=$("#mSimulationOptionsEditorMustPause").is(":checked")?"false":"true",n.ModelTab=$("#mSimulationOptionsModelTab").val(),n.ModelTabTitle=$("#mSimulationOptionsModelTabTitle").val(),n.ModelName=$("#mSimulationOptionsModelName").val(),n.FixedNavigationBar=$("#mSimulationOptionsFixedNavigationBar").is(":checked")?"false":"true",n.IncludeSource=$("#mSimulationOptionsIncludeSource").is(":checked")?"true":"false",n.IncludeLibrary=$("#mSimulationOptionsIncludeLibrary").is(":checked")?"true":"false",n.SaveInXMLFormat=$("#mSimulationOptionsSaveAsXML").is(":checked")?"true":"false",n.UglifyJS=$("#mSimulationOptionsUglifyJS").is(":checked")?"true":"false",n.CSSFile=$("#mSimulationOptionsCSS").val(),n.AuxiliaryFiles=[],$("#mSimulationOptionsUserFiles > option").each((function(){n.AuxiliaryFiles.push(this.text)})),n.DetectedFiles=[],$("#mSimulationOptionsDetectedFiles > option").each((function(){n.DetectedFiles.push(this.text)})),n.HTMLHead=$("#mSimulationOptionsHtmlHead").val(),n.PreviewFullModel=$("#mSimulationOptionsEditorFullModel").is(":checked")?"true":"false",n.UseInterpreter=$("#mSimulationOptionsEditorParse").is(":checked")?"true":"false",n.UseDeltaForODE=$("#mSimulationOptionsEditorUseDelta").is(":checked")?"true":"false"}e.readObject=function(e){"PreviewFullModel"in e||(e.PreviewFullModel="false"),a=[],o=0;const r=e.Author;if(r&&r.length>0){authorsLogo=e.AuthorLogo;for(var l=0;l<r.length;l++){var c=authorsLogo&&l<authorsLogo.length?authorsLogo[l]:"";o++,a.push({name:r[l],logo:c,hash:o})}}i=[],s=0;const d=e.Logo;if(d)for(l=0;l<d.length;l++)s++,i.push({logo:d[l],hash:s});n=e,t&&u(n),$("#sPreviewFullModel").prop("checked","true"==n.PreviewFullModel)},e.saveObject=function(){return t&&d(),n},e.getDetectedFiles=function(){t&&d();var e=[];e.push(...n.AuthorLogo),e.push(...n.Logo);const a=n.CSSFile.trim();return a.length>0&&e.push(a),e},e.getTitle=function(){return t?$("#mSimulationOptionsTitle").val():n.Title},e.useDeltaForODEs=function(){return t?$("#mSimulationOptionsEditorUseDelta").is(":checked"):"true"==n.UseDeltaForODE},e.previewFullModel=function(){return $("#sPreviewFullModel").is(":checked")},e.updateDetectedFiles=function(){var e=sMainGUI.getDetectedFiles();const a=[...new Set(e)];e=[];for(var o=0;o<a.length;o++){const t=a[o].trim();t.length<=0||(t.startsWith("/")||t.startsWith('"/')||t.startsWith("%")||e.push(t))}const i=e.sort();return t?c(i):n.DetectedFiles=i,i},e.addToDetectedFiles=function(e){var t=!1;if(console.log("Checking detected file : "+e),e.startsWith("./")||(e="./"+e),console.log("Actually file : "+e),$("#mSimulationOptionsDetectedFiles > option").each((function(){if(this.text==e)return t=!0,!1})),!t){const t=$("<option>",{text:e});$("#mSimulationOptionsDetectedFiles").append(t),t.attr("selected",!0)}},e.getRequiredFiles=function(){var a=e.updateDetectedFiles();t?$("#mSimulationOptionsUserFiles > option").each((function(){a.push(this.text)})):a.push(...n.AuxiliaryFiles);return[...new Set(a)].sort()};const p='\n\t<div class="sMainSimulationOptionsDialog dialog-sm">\n\t\t\t\t\n\t\t\t\t\x3c!-- begin tab headers --\x3e\n\t\t\t\t<ul class="nav nav-tabs" role="tablist">\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link active" id="mSimulationOptionsEditorMetadataTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorMetadataDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorMetadataDiv" aria-selected="true">\n\t     \t\t\t  \tMetadata\n\t     \t\t\t </button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link " id="mSimulationOptionsEditorRunningTab" \n\t\t\t\t\t\t \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorRunningDiv"  \n\t   \t\t\t\t\t \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorRunningDiv" aria-selected="false">\n     \t\t\t\t\t Run options\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t  \t<li class="nav-item" role="presentation">\n\t\t\t\t\t\t<button class="sTranslatable nav-link" id="mSimulationOptionsEditorExportTab" \n\t\t\t\t\t\t\t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorExportDiv"  \n\t\t\t\t\t\t\t\ttype="button" role="tab" aria-controls="mSimulationOptionsEditorExportDiv" aria-selected="false">\n\t\t\t\t\t\t\tExport options\n\t\t\t\t\t\t</button>\n\t\t\t\t </li>\n\t\t\t\t <li class="nav-item" role="presentation">\n\t     \t\t\t<button class="sTranslatable nav-link" id="mSimulationOptionsEditorEditTab" \n\t\t\t \t\t  \t\tdata-bs-toggle="tab" data-bs-target="#mSimulationOptionsEditorEditDiv"  \n\t     \t\t\t  \ttype="button" role="tab" aria-controls="mSimulationOptionsEditorEditDiv" aria-selected="false">\n\t     \t\t\t  Edit options\n\t     \t\t\t</button>\n\t    \t\t</li>\n\t\t\t\t</ul> \n\t\t\t\t\x3c!-- end tab headers --\x3e\n\t     \t\t\t\n\t\t\t\t\x3c!-- begin tab content --\x3e\n\t\t\t\t<div class="tab-content">\n\t\t\t \t\t  \t\n\t\t\t \t\t\x3c!-- begin METADATA content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show active" id="mSimulationOptionsEditorMetadataDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mSimulationOptionsEditorMetadataTab">\n\t\t\t \t\t\t  \t\t\t\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsTitleLabel" class="sTranslatable input-group-text">Title</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsTitle" type="text" class="form-control" placeholder="Enter title here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Title" aria-describedby="mSimulationOptionsTitleLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Author</span>\n\t\t\t\t\t    <select id="mSimulationOptionsAuthor" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorAdd" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorEdit" \tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Edit">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsAuthorDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2">\n\t\t\t\t\t\t\t<span id="mSimulationOptionsAuthorLogoGallery" class="btn-group btn-group-sm" role="group" aria-label="AuthorLogoGallery">\n\t\t\t\t\t\t\t</span>\n        \t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsKeywordsLabel" class="sTranslatable input-group-text">Keywords</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsKeywords" type="text" class="form-control" placeholder="Enter keywords here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Keywords" aria-describedby="mSimulationOptionsKeywordsLabel">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t        \t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\x3c!-- div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsAbstractLabel" class="sTranslatable input-group-text">Abstract</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsAbstract" type="text" class="form-control" placeholder="Enter abstract here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Abstract" aria-describedby="mSimulationOptionsAbstractLabel">\n\t\t\t\t\t\t</div --\x3e\n\n\t\t\t\t\t\t<div class="mt-2 form-floating">\n\t\t\t\t\t\t  <textarea  id="mSimulationOptionsAbstract" class="form-control" placeholder="Enter abstract here"style="height: 100px"></textarea>\n\t\t\t\t\t\t  <label class="sTranslatable" for="mSimulationOptionsAbstract">Comments</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsCopyrightLabel" class="sTranslatable input-group-text">Copyright</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsCopyright" type="text" class="form-control" placeholder="Enter copyright here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Copyright" aria-describedby="mSimulationOptionsCopyrightLabel">\n\t\t\t\t\t\t</div>\n        \t\t\t\t\t\t\t\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsLevelLabel" class="sTranslatable input-group-text">Level</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsLevel" type="text" class="form-control" placeholder="Enter level here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Level" aria-describedby="mSimulationOptionsLevelLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsLanguagesLabel" class="sTranslatable input-group-text">Languages</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsLanguages" type="text" class="form-control" placeholder="Enter languages here" \n  \t\t\t\t\t\t\t\t\t\taria-label="Languages" aria-describedby="mSimulationOptionsLanguagesLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Logo</span>\n\t\t\t\t\t    <select id="mSimulationOptionsLogo" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsLogoAdd" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsLogoDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2">\n\t\t\t\t\t\t\t<span id="mSimulationOptionsLogoGallery" class="btn-group btn-group-sm" role="group" aria-label="SimulationLogoGallery">\n\t\t\t\t\t\t\t</span>\n        \t\t</div>\n\n\t\t\t \t\t</div>\n\t\t\t \t\t\x3c!-- end METADATA content --\x3e\n\n\t\t\t\t\t\x3c!-- begging RUNNING content --\x3e\n\t\t\t\t\t<div class="tab-pane fade show " id="mSimulationOptionsEditorRunningDiv" \n\t\t\t \t\t\t  \trole="tabpanel" aria-labelledby="mSimulationOptionsEditorRunningTab">\n\t\t\t \t\t\t  \t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorMustPause" id="mSimulationOptionsEditorMustPause">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorMustPause">\n\t\t\t\t\t\t\t\tThe simulation must pause if the page looses focus\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelTabLabel" class="sTranslatable input-group-text">Simulation Tab</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelTab" type="text" class="form-control" placeholder="Enter tab number here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelTab" aria-describedby="mSimulationOptionsModelTabLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelTabTitleLabel" class="sTranslatable input-group-text">Simulation Tab Title</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelTabTitle" type="text" class="form-control" placeholder="Enter tab title here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelTabTitle" aria-describedby="mSimulationOptionsModelTabTitleLabel">\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsModelNameLabel" class="sTranslatable input-group-text">Simulation Name</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsModelName" type="text" class="form-control" placeholder="Enter simulation name here" \n  \t\t\t\t\t\t\t\t\t\taria-label="ModelName" aria-describedby="mSimulationOptionsModelNameLabel">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsFixedNavigationBar" id="mSimulationOptionsFixedNavigationBar">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsFixedNavigationBar">\n\t\t\t\t\t\t\t\tEJS Reader\'s navigation bar ignores double-clicks\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span  id="mSimulationOptionsCSSLabel" class="sTranslatable input-group-text">CSS</span>\n  \t\t\t\t\t\t<input id="mSimulationOptionsCSS" type="text" class="form-control" readonly \n  \t\t\t\t\t\t\t\t\t\taria-label="Languages" aria-describedby="mSimulationOptionsCSSLabel">\n\t\t\t\t\t\t  <span id="mSimulationOptionsCSSEdit" \t\tclass="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Edit">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsCSSDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">User files</span>\n\t\t\t\t\t    <select id="mSimulationOptionsUserFiles" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsUserFilesAdd" \t\tclass="input-group-text"\n        \t\t\t\t\t\tdata-bs-target="#mFileChooserModal" data-bs-toggle="modal" data-bs-dismiss="modal"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Add">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-plus" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t  <span id="mSimulationOptionsUserFilesDelete" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Delete">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-x" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t \t\n\t\t\t\t\t\t<div class="mt-2 input-group">\n\t\t\t\t\t\t  <span class="sTranslatable input-group-text">Files required</span>\n\t\t\t\t\t    <select id="mSimulationOptionsDetectedFiles" class="form-select"></select>\n\t\t\t\t\t\t  <span id="mSimulationOptionsDetectedFilesRefresh" class="input-group-text"\n\t\t\t\t\t\t  \t\t\tdata-bs-toggle="tooltip" data-bs-placement="bottom" title="Refresh">\n\t\t\t\t\t\t  \t<i class="bi bi-clipboard-data" style="color: black;"></i>\n\t\t\t\t\t\t  </span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t \n\t\t\t\t\t\t<hr>\n\n\t\t\t\t\t\t<div class="mt-2 form-floating">\n\t\t\t\t\t\t  <textarea  id="mSimulationOptionsHtmlHead" class="form-control" placeholder="Enter html head here" style="height: 100px"></textarea>\n\t\t\t\t\t\t  <label class="sTranslatable" for="mSimulationOptionsHtmlHead">HTML head</label>\n\t\t\t\t\t\t</div>\n\n\t\t\t \t\t</div>\n\t\t\t \t\t\x3c!-- end RUNNING content --\x3e\n\n\t\t\t\t\t\x3c!-- begin EXPORT content --\x3e\n\t\t\t\t\t<div class="tab-pane fade show" id="mSimulationOptionsEditorExportDiv" role="tabpanel"\n\t\t\t\t\t\taria-labelledby="mSimulationOptionsEditorExportTab">\n\t\t\t\t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsSaveAsXML" id="mSimulationOptionsSaveAsXML">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsSaveAsXML">\n\t\t\t\t\t\t\t\tSave the source file in EJS 6 format rather than WebEJS format\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\t\t\t\t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsIncludeSource" id="mSimulationOptionsIncludeSource">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsIncludeSource">\n\t\t\t\t\t\t\t\tInclude the source file in the complete simulation ZIP\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" checked \n\t\t\t\t\t\t\t\t name="mSimulationOptionsIncludeLibrary" id="mSimulationOptionsIncludeLibrary">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsIncludeLibrary">\n\t\t\t\t\t\t\t\tInclude all EJS libraries when exporting the complete model\'s ZIP<br><br>\n\t\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t\tThe model’s ZIP file will be smaller if the EJS libraries are excluded \n\t\t\t\t\t\t\t\t\tbecause the EJS libraries will be downloaded from the Internet when the \n\t\t\t\t\t\t\t\t\tmodel’s HTML page is run. This is fast and the files are cached in most \n\t\t\t\t\t\t\t\t\tbrowsers. Include the EJS libraries if you intend to run the HTML page \n\t\t\t\t\t\t\t\t\twithout an internet connection.<br><br>\n\t\t\t\t\t\t\t\t\tNote that EJS 6 uses an XML file to describe the model whereas WebEJS uses a JSON file.\n\t\t\t\t\t\t\t\t\tNew WebEJS options may not be available if the model is exported in EJS 6 format.\n\n\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t    </div>\t\t\t \t\t\t  \t\n\n\t\t\t\t\t\t\x3c!--div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" name="mSimulationOptionsUglifyJS"\n\t\t\t\t\t\t\t\tid="mSimulationOptionsUglifyJS">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsUglifyJS">\n\t\t\t\t\t\t\t\tUglify the Javacript code in the generated model\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div--\x3e\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- end EXPORT content --\x3e\n\t\t \n\t\t\t\t \t\x3c!-- begin EDITION content --\x3e\n\t\t\t \t\t<div class="tab-pane fade show" id="mSimulationOptionsEditorEditDiv" \n\t\t\t \t\t\t   role="tabpanel" aria-labelledby="mSimulationOptionsEditorEditTab">\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorFullModel" id="mSimulationOptionsEditorFullModel">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorFullModel">\n\t\t\t\t\t\t\t\tShow full model in the preview area\ton load\t\t\t\t\t\t\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\n\t\t\t\t \t\t\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorParse" id="mSimulationOptionsEditorParse">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorParse">\n\t\t\t\t\t\t\t\tParse custom method with an interpreter\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\n\n\t\t\t\t\t\t<div class="form-check mt-2 mx-3">\n\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" \n\t\t\t\t\t\t\t\t name="mSimulationOptionsEditorUseDelta" id="mSimulationOptionsEditorUseDelta">\n\t\t\t\t\t\t\t<label class="sTranslatable form-check-label" for="mSimulationOptionsEditorUseDelta">\n\t\t\t\t\t\t\t\tUse &#916; for ODEs\n\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t\n\t\t\t\t \t\t</div>\t\t\t \t\n\t\t\t\t \t\t\n\t\t\t \t\t</div>\t\t\t \t\n\t\t\t\t \t\x3c!-- end EDITION content --\x3e\n\t\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- end tab content --\x3e\n\t\n\t</div>\n  ';return e},(WebEJS_GUI=WebEJS_GUI||{}).outputArea=function(){var e={};function t(e,t){const n=$('<p class="m-0 '+e+'"></p>');var a;n.text(t),$("#sOutputTextarea").append(n),(a=$("#sOutputTextarea")).scrollTop(a[0].scrollHeight-a[0].clientHeight)}return e.println=function(e){t("text-dark",e)},e.logLine=function(e){t("text-dark",e)},e.infoLine=function(e){t("text-primary",e)},e.warningLine=function(e){t("text-warning",e)},e.errorLine=function(e){t("text-danger",e)},e.clear=function(){$("#sOutputTextarea").empty()},$("#sOutputClearButton").click((()=>{e.clear()})),e.clearAndPrintln=function(t){e.clear(),e.println(t)},e},(WebEJS_GUI=WebEJS_GUI||{}).previewArea=function(){var e={};function t(e){$("#sPreviewFrame").attr("src",e)}function n(e){const t=sMainSimulationOptions.previewFullModel()?"FULL MODEL":"PREVIEW";$("#sPreviewTitle").text(sLocaleFor(t)+": "+e)}function a(e){"OK"==e?(sMainGUI.logLine(sLocaleFor("Preview updated OK")),n(sMainGUI.getTitleForPreview())):(sMainGUI.errorLine(sLocaleFor("Error updating preview")),sMainGUI.warningLine(sLocaleFor("This preview may not be correct")),n(sLocaleFor("This preview may not be correct"))),t(sMainComm.getPreviewURL(sMainSimulationOptions.previewFullModel(),!1))}function o(e){sMainGUI.errorLine(sLocaleFor("Error updating preview")),sMainGUI.warningLine(sLocaleFor("Comm error on update")+": "+e),n(sLocaleFor("This preview may not be correct")),t(sMainComm.getPreviewURL(sMainSimulationOptions.previewFullModel(),!1))}function i(){{const t={useCDN:!0,separatePage:!1,fullModel:sMainSimulationOptions.previewFullModel()};return n(sMainGUI.getTitleForPreview()),e=WebEJS_GEN.generate(t),$("#sPreviewFrame").attr("srcdoc",e),!1}var e}return e.clearPreview=function(e){$("#sPreviewFrame").attr("src",sMainEjsAssetsFolder+"WebEJS/EmptyView/empty_view.html"),$("#sPreviewTitle").text(e)},e.updatePreview=function(){i()&&sMainComm.updateSimulation(null,a,o)},e.reportPreview=function(e){i()&&sMainComm.sendActionReport(e,a,o)},e.runSimulation=function(){{const e={useCDN:!0,separatePage:!0,fullModel:!0};window.open(URL.createObjectURL(new Blob([WebEJS_GEN.generate(e)],{type:"text/html"})))}},e},(WebEJS_GUI=WebEJS_GUI||{}).tabbedPage=function(e){var t={},n=e,a=jQuery("<div/>",{style:"padding:0"});return t.setTitle=function(e){n=e},t.getTitle=function(){return n},t.getDiv=function(){return a},t.prepareToShow=function(){},t.saveObject=function(){return{title:e}},t.readObject=function(e){mLabel=e.title},t},WebEJS_GUI.tabbedPanel=function(e,t){WebEJS_RESOURCES.main();var n={};const a="<li class='sTabsLi'><a class='sTabsA' href='#{href}'>#{label}</a><span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>",o=e+"-tabs";var i,s=0,r={},l=jQuery("<div/>",{class:t+" sWorkPanel"}),c=jQuery("<div/>",{id:o}).appendTo(l),u=jQuery("<ul/>",{class:" sTabList"}).appendTo(c),d=jQuery("<div/>",{class:"sTabDialog",title:gettext("Create new page")});jQuery("<div/>",{class:"sTabDialog",title:gettext("Delete page"),html:"<p><span class='ui-icon ui-icon-alert' style='float:left; margin:12px 12px 20px 0;'></span>"+gettext("This page will be permanently deleted")+". "+gettext("Are you sure?")+"</p>"});function p(){u.empty();for(const e in r)$(e).remove();var e;r={},e=jQuery("<button/>",{text:"+",class:"sTabAdd"}),i.find(".ui-tabs-nav").append(e),e.on("click",(function(){document.getElementById(o+"-tab_title").value=gettext("Page")+" "+(s+1),d.dialog("open")})),-1,s=0,i.tabs("refresh")}return n.getMainPanel=function(){return l},n.prepareToShow=function(){},n.saveObject=function(){var e=[];return $("> ul > li > a","#"+o).each((function(){var t=r[$(this).attr("href")];e.push(t.saveObject())})),e},n.readObject=function(e){p();for(var t=0;t<e.length;t++){var a=e[t];n.createPage(a.title).readObject(a)}n.setActive(0)},n.createPage=function(e){alert("Subclasses of Tabs should overwrite the createPage() function!!!")},n.addTab=function(e){var t=o+"-"+(s+1),n="#"+t,l=$(a.replace(/#\{href\}/g,n).replace(/#\{label\}/g,e.getTitle())),u=e.getDiv();return i.find(".ui-tabs-nav").append(l),u.attr("id",t),u.addClass("sTabContent"),c.append(u),i.tabs("refresh"),s++,r[n]=e,t},n.setActive=function(e){i.tabs("option","active",e)},n.getActive=function(){return i.tabs("option","active")},n},(WebEJS_GUI=WebEJS_GUI||{}).viewPropertyEditor=function(e,t,n){var a={};const o="mViewPropertyEditor_"+n.hash>=0?n.hash:"root_properties";var i=null,s=!0,r=0,l=[];const c={width:Math.min(.9*window.innerWidth,1200),height:Math.min(.9*window.innerHeight,1200)};a.show=function(){i&&(i.resize(c),i.reposition(),i.front())},a.hide=function(){s=!1,i&&i.close()};{const a={content:function(){r=0,l=[];const t=e.getElementClassEditionInfo(n.type),a=e.getElementClassProperties(n.type,null);var i="",s="";for(var c in t){const e=t[c],n=0==c?" show active":"";i+='<li class="nav-item" role="presentation"><button class="sTranslatable nav-link'+(0==c?" active":"")+'" id="'+o+"TabHeader_"+c+'" data-bs-toggle="tab" data-bs-target="#'+o+"TabDiv_"+c+'" type="button" role="tab" aria-controls="'+o+"TabDiv_"+c+'" aria-selected="true">'+sMainResources.getString(e.label)+" </button></li>",s+='<div class="tab-pane fade'+n+'" id="'+o+"TabDiv_"+c+'" role="tabpanel" aria-labelledby="'+o+"TabHeader_"+c+'">'+g(e,a)+"</div>"}return html='<div><ul class="nav nav-tabs" role="tablist">'+i+'</ul><div class="tab-content" id="'+o+'Contents">'+s+"</div></div>",html}(),onbeforeclose:function(e){return s&&t.clearPropertyEditor(n.hash),!0},footerToolbar:'<button type="button" id="'+o+'Button" class="sTranslatable btn btn-primary float-left">Done</button>',callback:function(a){$("#"+o+"Button").click((function(){i.close()})),function(){for(var e=0;e<l.length;e++){var t=l[e];$("#"+t[0]).val(t[1])}l=[]}(),$("#"+o+"Contents .cViewPropertyEditorInput").change((e=>{const a=$(e.target).closest(".input-group").data("name"),o=$(e.target).val().trim();t.setPropertyByName(a,o,n.hash)})),$("#"+o+"Contents .cViewPropertyEditorEditIcon").click((a=>{const o=$(a.target).closest(".input-group"),i=o.data("name"),s=o.data("types"),r=o.data("modifiers"),l=o.find(".cViewPropertyEditorInput").first(),c=l?l.val().trim():"",u=function(e){e!=c&&(t.setPropertyByName(i,e,n.hash),l.val(e))},p=d(s,r);return p?p("Edit property",i,c,u):e.isOfType(s,"Action")||e.hasModifier(r,"MULTILINE")?sInputForm.showArea("Edit property",i,c,u,!0):sInputForm.show("Edit property",i,c,u,!0)})),$("#"+o+"Contents .cViewPropertyEditorLinkIcon").click((a=>{const o=$(a.target).closest(".input-group"),i=o.data("name"),s=o.data("types"),r=o.find(".cViewPropertyEditorInput").first(),l=r?r.val().trim():"",c=function(e){e!=l&&(t.setPropertyByName(i,e,n.hash),r.val(e))};e.isOfType(s,"Action")?sMainSelectChoiceForm.show("List of actions",function(){for(var e=sMainGUI.getModel().getCustomCode().getCustomMethods(),t=0;t<e.length;t++)e[t].style="sModelBtn";for(e.push(...sMainGUI.getSystemInformation("model_methods")),e.push(...sMainGUI.getSystemInformation("view_methods")),e.push(...sMainGUI.getSystemInformation("tools_methods")),t=0;t<e.length;t++){var n=e[t].name;const a=n.indexOf("(");a>=0&&(e[t].value="%"+n.substring(0,a)+"%")}return e}(),l,c,"modal-lg"):sMainSelectChoiceForm.show("List of suitable variables",function(t){const n=e.getPropertyTypesList(t);var a=sMainGUI.getModel().getVariables().getVariablesOfType(n),o=[];n.includes("boolean")&&(o.push({name:"_isPlaying",description:"Whether the simulation is playing"}),o.push({name:"_isPaused",description:"Whether the simulation is paused"}),o.push({name:"_isMobile",description:"Whether the simulation is running on a mobile device"}));for(var i=0;i<a.length;i++){const e=a[i],t="("+e.type+e.dimension+") : "+e.comment;o.push({name:e.name,value:e.name,description:t,style:"sModelBtn"})}var s=sMainGUI.getModel().getCustomCode().getCustomMethods();for(i=0;i<s.length;i++){const e=s[i];e.style="text-secondary",o.push(e)}if(n.includes("String"))for(i=0;i<o.length;i++){var r=o[i].name;const e=r.indexOf("(");e>=0&&(o[i].value="%"+r.substring(0,e)+"%")}return o}(s),l,c)})),$("#"+o+"Contents .cViewPropertyEditorLabel").click((t=>{!function(t){const a=e.getElementClassProperties(n.type,null),o=e.getPropertyDescription(t,a),i=e.getPropertyDefaultValue(o),s=e.getPropertyTypesString(o).replaceAll("|",", "),r="<none>"==i?'<span class="fw-bold text-primary">'+sLocaleFor("No particular default value")+"</span>":'<span class="fw-bold text-primary">'+sLocaleFor("Default value")+' = </span><span class="text-danger font-monospace">'+i+"</span>",l=sLocaleFor("Property")+" "+t+" ("+n.type+")",c='<hr><p><span class="fw-bold text-primary">'+sLocaleFor("Types accepted")+' : </span><span class="text-danger font-monospace">'+s+"</span></p><p>"+r+'</p><hr><a class="fw-bold text-success" href="'+e.getWikiHelpPage(n.type)+'" target="_blank">'+sLocaleFor("Click for help on")+" "+n.type+"</a>";sMessageForm.showAllRaw(l,c)}($(t.target).closest(".input-group").data("name"))})),sMainRefreshTooltips(),$("#"+o+"Contents .cViewPropertyEditorColumn").each((function(e,t){var n=0;$(t).find(".cViewPropertyEditorLabel").each((function(e,t){n=Math.max(n,$(t).width())})),$(t).find(".cViewPropertyEditorLabel").each((function(e,t){$(t).width(n)}))}))}};var u=sMainResources.getString("Properties for")+" "+n.name;n.type&&(u+=" ("+n.type+")"),i=WebEJS_TOOLS.createJSPanel(u,a,{minimize:"remove"},c)}function d(t,n){const a=e.getPropertyTypesList(t),o=e.getPropertyModifiersList(n);return WebEJS_GUI.viewPropertyTypeEditor(a,o)}function p(t,a,i){var s="",l="bi-keyboard",c=!0,u="bi-link",p="",m="";if(null==i)sMainGUI.println(sMainResources.getString("WARNING: property not recognized for elements of this type!")+": <"+a+"> ("+n.type+")"),s="text-secondary";else{const n=e.getPropertyTypesString(i),g=e.getPropertyModifiersString(i);l=d(n,g)?"bi-clipboard-data":"bi-keyboard",c=!e.hasPropertyModifier(i,"CONSTANT");const f=e.isPropertyOfType(i,"Action");f||e.hasPropertyModifier(i,"MULTILINE")?(u="bi-gear",f&&(s="text-danger"),p='<textarea id="'+t+'"  class="cViewPropertyEditorInput form-control form-control-sm" rows="1"  aria-label="'+a+'" aria-describedby="'+o+"Property_"+r+'"></textarea>'):p='<input id="'+t+'" type="text" class="cViewPropertyEditorInput form-control form-control-sm" '+sMainNoAutocorrect+' aria-label="'+a+'" aria-describedby="'+o+"Property_"+r+'">',m=' data-types="'+n+'" data-modifiers="'+g+'" '}return'<div class="mb-0 input-group input-group-sm" data-name="'+a+'" '+m+'><span id="'+o+"Property_"+r+'" class="cViewPropertyEditorLabel sTranslatable input-group-text input-group-text-sm '+s+'">'+sMainResources.getString(a)+"</span>"+p+'<span class="cViewPropertyEditorEditIcon input-group-text input-group-text-sm"><i class="bi '+l+'" style="color: black;"></i></span><span class="cViewPropertyEditorLinkIcon input-group-text input-group-text-sm"><i class="bi '+u+'" style="color: black;"'+(c?"":" disabled ")+"></i></span></div>"}function m(a,i){for(var s="",c=0;c<a.length;c++){var u=a[c];if(u.startsWith("<LABEL")){const e=u.substring(6,u.length-1);s+='<div class="my-0 text-center"><label class="my-0 form-label text-center fw-bold text-primary">'+sMainResources.getString(e)+"</label></div>"}else if("<SEP>"==u)s+='<hr class="my-0">';else{r++;const a=t.getPropertyByName(u,n.properties),c=o+"PropertyInput_"+r;null!=a&&l.push([c,a]),s+=p(c,u,e.getPropertyDescription(u,i))}}return s}function g(e,t){for(var n="",a=0;a<e.columns.length;a++){n+='<div class="col cViewPropertyEditorColumn">'+m(e.columns[a],t)+"</div>"}return'<div class="container"><div class="row">'+n+"</div></div>"}return a},(WebEJS_GUI=WebEJS_GUI||{}).viewPropertyTypeEditor=function(e,t){if(e.includes("Color")||e.includes("Color3D"))return function(e,t,n,a){sMainEditorForColor.show(e,n,a)};if(e.includes("Font"))return function(e,t,n,a){sMainEditorForFont.show(e,n,a)};if(e.includes("File"))return function(e,n,a,o){var i=null;t.includes("BASE64_IMAGE")&&(i=WebEJS_GUI.viewPropertyFileHelperHtml()),WebEJS_TOOLS.selectFile(["png","gif","jpg","jpeg"],(function(e,t){const n=e.startsWith('"')?e:'"'+e+'"';n!=a&&(o(n),sMainSimulationOptions.updateDetectedFiles())}),!0,i)};var n=[];function a(e,t){for(var a=0;a<t.length;a++){const r=t[a];var o=r,i=null;Array.isArray(r)&&(o=r[0],i=r[1]);var s={name:'"'+o+'"',icon:'<img class="d-inline-block align-bottom;" style="padding: 0 2px 0 2px;" src="'+sMainGUI.getSystemIconURL("Editors/"+e+"_"+o.toUpperCase()+".gif")+'">'};i&&(s.old_names='"'+i+'"'),n.push(s)}}return e.includes("boolean")&&n.push({name:"true",icon:'<i class="bi bi-check-circle"></i>'},{name:"false",icon:'<i class="bi bi-x-circle"></i>'}),e.includes("3DDecorationType")&&a("Decoration",["NONE","AXES","CUBE","CENTERED_AXES"]),e.includes("3DDraggable")&&a("3DDraggable",["NONE","ANY","AZIMUTH","ALTITUDE"]),e.includes("3DProjectionType")&&a("DisplayMode",["PLANAR_XY","PLANAR_XZ","PLANAR_YZ","PERSPECTIVE_OFF","PERSPECTIVE_ON"]),e.includes("ArrowMark")&&a("ArrowStyle",["NONE","ANGLE","CIRCLE","RECTANGLE","LINE","CURVE","TRIANGLE","DIAMOND","WEDGE","POINTED","INVANGLE","INVTRIANGLE"]),e.includes("CursorShape")&&a("CursorShape",["HORIZONTAL","VERTICAL","CROSSHAIR"]),e.includes("GraphicsMode")&&a("GraphicsMode",["SVG","CANVAS"]),e.includes("Interaction2D")&&a("Interaction2D",["ENABLED_NONE","ENABLED_ANY","ENABLED_X","ENABLED_Y","ENABLED_NO_MOVE"]),e.includes("MarkType")&&a("MarkerShape",["ELLIPSE","RECTANGLE","AREA","BAR"]),e.includes("MeshDataType")&&a("MeshDataType",["MESH_2D","MESH_3D","SCALAR_2D_FIELD","SCALAR_3D_FIELD","VECTOR_2D_FIELD","VECTOR_3D_FIELD"]),e.includes("Offset")&&a("JSArrowPosition",["SOUTH_WEST","CENTERED","NORTH_EAST"]),e.includes("Orientation")&&a("Orientation",["HORIZONTAL","VERTICAL"]),e.includes("Position")&&a("ElementPosition",["CENTERED",["NORTH","hor_centered|hor_centered_down"],["SOUTH","hor_centered_up"],["EAST","ver_centered_left"],["WEST","ver_centered|ver_centered_right"],"NORTH_EAST",["NORTH_WEST","upper_left"],"SOUTH_EAST",["SOUTH_WEST","lower_left"]]),e.includes("ShapeType")&&a("MarkerShape",[["NONE","no_marker"],["ELLIPSE","circle|filled_circle"],["RECTANGLE","square|filled_square"],"ROUND_RECTANGLE","WHEEL"]),e.includes("TextAlign")&&a("Alignment",["left","center","right","justify"]),e.includes("ScaleType")&&a("ScaleType",["SCALE_NUM","SCALE_LOG"]),n.length>0?function(e,t,a,o){sMainSelectChoiceForm.show(t,n,a,o,null)}:null},WebEJS_GUI.viewPropertyFileHelperHtml=function(){function e(e){e.indexOf(".")<0&&(e+=".gif");const t="/org/opensourcephysics/resources/controls/images/"+e;return'<img class="cFileChooserHelperImage p-0 d-inline-block align-bottom;" width="16" height="16" src="'+sMainGUI.getSystemIconURL(t)+'" data-value="'+t+'">'}const t=["play","pause","stop","stepforward","stepback","continue","reset","initial","reset1","reset2","cycle","clear","forward","time","notime","close","folder","inspectfolder","window","inspect","value","hilite","erase","i_erase","caution","wrench","wrench_monkey","pdf","power_on.png","power_off.png","expand.png","download.png","center","apple.png","android.png"];for(var n=1,a='<div class="container m-0 p-0"><div class="row m-0 p-0">',o=0;o<t.length;o++)a+='<div class="col m-0 p-0">'+e(t[o])+"</div>",n>=3?(n=1,a+="</div>",o+1<t.length&&(a+='<div class="row m-0 p-0">')):n++;if(n>1){for(;n<=3;n++)a+='<div class="col m-0 p-0"></div>';a+="</div>"}return a+="</div>"},(WebEJS_GUI=WebEJS_GUI||{}).viewTree=function(e,t){const n="sViewTree-item-",a="sViewTree-group-",o="bi bi-chevron-down",i="bi bi-chevron-right",s="bi bi-dash",r="0.25rem",l="Root";function c(e){return e>0?(.5+.5*e).toString()+"rem":r}var u,d={},p={},m=0,g={},f={},h=[];function b(e,t){const n=w(t),a=x(t),o=R(t),i=g[n];var s={Name:a,Type:I(t)};if(o&&(s.Expanded=""+o.hasClass("show")),i&&(s.Properties=i),e.push(s),o){var r=[];o.children(".list-group-item").each((function(e,t){b(r,$(t))})),s.Children=r}}function v(e,t,n){const a=w(t),o=x(t),i=R(t),s=g[a];var r={Name:o,Type:I(t)};n&&(r.Parent=n),i&&(r.Expanded=""+i.hasClass("show")),s&&(r.Properties=s),e.push(r),i&&i.children(".list-group-item").each((function(t,n){v(e,$(n),o)}))}function _(e,n,a){const o=w(n),i=R(n),s=g[o];if(s&&s.length>0){const o=t.getElementClassProperties(I(n),a);for(var r=0;r<o.length;r++){const t=o[r];var l=d.getPropertyByName(t.name,s);l&&l.trim().length>0&&((l=l.trim()).startsWith('"')&&(l=l.substring(1)),l.endsWith('"')&&(l=l.substring(0,l.length-1)),e.push(l))}}i&&i.children(".list-group-item").each((function(t,n){_(e,$(n),a)}))}function E(e,t,n){var a=y(n,t.Name,t.Type);e.append(a),g[m]=t.Properties;const o="Children"in t?t.Children:[];if(o.length>0){const e=T(a,"Expanded"in t&&"true"==t.Expanded);m++,n++;for(var i=0;i<o.length;i++)E(e,o[i],n)}else m++}function S(t,n){for(var a={},o=0;o<n.length;o++){var i=n[o],s=i.Type.split(".");i.Type=s[s.length-1];var r,l,c=V(i.Name),u=null;if("Parent"in i&&!("group"in(u=a[i.Parent]))){const e=u.element,t="Expanded"in e&&"true"==e.Expanded;u.group=T(u.tree_item,t)}u?(r=y(l=u.depth+1,c,i.Type),u.group.append(r)):O(t)?(l=0,r=y(0,c,i.Type),e.append(r)):(r=y(l=M(t)+1,c,i.Type),N(t).append(r)),a[i.Name]={tree_item:r,element:i,depth:l},i.Properties&&(g[m]=JSON.parse(JSON.stringify(i.Properties))),m++}a={},d.reportableTreeChange("Paste subtree")}function T(e,t){const r=e.data("hash"),l=$('<div role="group" class="list-group ps-2 collapse'+(t?" show":"")+'"  data-parent="'+n+r+'"  id="'+a+r+'"></div>'),c=t?o:i;return e.find(".state-icon").removeClass(s).addClass(c),e.append(l),l}function y(e,o,i){const s=c(e),r=t.getElementClassIconSRC(i);return $('<div role="treeitem" class="list-group-item py-0 border-0" style="padding-left:'+s+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'element\')" data-drag_info="'+m+'"  id ="'+n+m+'" data-type="'+i+'" data-hash="'+m+'" data-depth="'+e+'"  data-bs-target="#'+a+m+'" "aria-level="'+e+'" ><i class="state-icon '+'bi bi-dash"></i><span class="dropdown"><img class="item-icon dropdown" style="padding: 0 2px 0 2px;" src="'+r+'" data-drag_info="'+m+'"  id="mViewItemMenuIcon_'+m+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></img><ul class="dropdown-menu py-0" aria-labelledby="mViewItemMenuIcon_'+m+'"><li><span class="cViewMenuHeader dropdown-item-text py-0 fw-bold">Menu</span></li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Properties">Properties</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Rename">Rename</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Reparent">Reparent</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="MoveUp">Move up</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="MoveDown">Move down</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Cut">Cut</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Copy">Copy</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Paste">Paste</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Remove">Remove</li><li><hr class="dropdown-divider m-0"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="AddCustom">Add to custom</li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Help">Help</li></ul></span><span class="sViewTreeElement">'+o+"</span></div>")}function P(e,t){var n=sMainResources.getString("WARNING")+": ";n+=e?sMainResources.getString("Element")+" "+x(e):sMainResources.getString("Root"),n+=" "+sMainResources.getString("does not take children of type")+" "+t+"!",sMainGUI.println(n)}function C(e,n,a){if(e.data("hash")<0)return t.parentAcceptsChild(l,n)?{accept:!0,parent:null}:(P(null,n),{accept:!1});if(t.parentAcceptsChild(I(e),n))return{accept:!0,parent:null};if(a){const a=D(e);if(a&&t.parentAcceptsChild(I(a),n))return{accept:!0,parent:a}}return P(e,n),{accept:!1}}function O(e){return w(e)<0}function w(e){return e.data("hash")}function M(e){return e.data("depth")}function x(e){return e.find(".sViewTreeElement").first().text()}function I(e){return e.data("type")}function R(e){const t=$(e.data("bs-target"));return t.length>0?t.first():null}function D(e){const t=e.closest(".list-group");return t.length>0?$("#"+t.data("parent")):null}function L(e,t){e.css("padding-left",c(t)),e.data("depth",t);const n=R(e);n&&n.children(".list-group-item").each((function(e,n){L($(n),t+1)}))}function A(e,t){const n=R(e),a=t?D(e):null,o=w(e);delete g[o],delete f[o],e.remove(),n&&(n.children(".list-group-item").each((function(e,t){A($(t),!1)})),n.remove()),a&&k(a),d.reportableTreeChange("Delete element")}function F(t){var n=null;return $(e).find(".list-group-item").each((function(e,a){const o=$(a);if(w(o)>=0&&x(o)===t)return n=o,!1})),n}function N(e){const t=$(e.data("bs-target"));return t.length>0?t.first():T(e,!0)}function k(e){if(null!=e){var t=$(e.data("bs-target"));t.length<=0||(t=t.first()).children().length<=0&&(e.find(".state-icon").removeClass(o).removeClass(i).addClass(s),t.remove())}}function W(t,n){const a=n.data("hash");var o=e,i=0;a<0||(o=N(n),i=M(n)+1),L(t,i),o.append(t);const s=R(t);s&&o.append(s),d.reportableTreeChange("Moving"),k(D(t))}function J(e,t){const n=function(e){const t=$("#sViewTree-item-"+e);return t.length>0?t.first():null}(e);if(null==n)return void sMainGUI.println("ERROR: item with hash "+e+" NOT FOUND!!!");const a=I(n),o=D(n),i=C(t,a,!0);if(i.accept)if(i.parent){const e=i.parent;if(e&&e!=n){L(n,M(t)),n.insertBefore(t);const e=R(n);return e&&e.insertBefore(t),d.reportableTreeChange("Reparenting"),k(o)}}else W(n,t);else sMessageForm.showWarning("Move error","Target does not accept children of this type!")}function B(e,t){if(t.length<=0)return;const n=C(e,t[0].Type,!1);n.accept?n.parent?S(n.parent,t):S(e,t):sMessageForm.showWarning("Paste/Drag error","Target does not accept children of this type!")}function V(e){for(var t=1,n=e;F(n);)n=e+"_"+ ++t;return n}function U(e,n){var a=[];const o=t.getElementClassTextProperty(n);o&&a.push({name:o,value:'"'+e+'"'});const i=t.getElementClassDefaultProperties(n);for(var s=0;s<i.length;s++){const e=i[s];a.push({name:e.name,value:e.value})}g[m]=a,m++,d.reportableTreeChange("Create element")}function G(t,n,a){const o=V(t.charAt(0).toLowerCase()+t.slice(1));w(n)<0?sInputForm.show("Create new element","Name",o,(function(n){n=V(n),e.append(y(0,n,t)),U(n,t)})):sInputForm.show("Create new element","Name",o,(function(e){e=V(e);const o=y(M(n)+1,e,t);a?o.insertBefore(a):N(n).append(o),U(e,t)}))}function H(e){const n=w(e);f[n]?f[n].show():f[n]=WebEJS_GUI.viewPropertyEditor(t,d,function(e){const t=w(e);return t<0?{hash:t,name:sMainResources.getString("Simulation view"),type:"Root",properties:p}:{hash:t,name:x(e),type:I(e),properties:g[t]}}(e))}function j(e){const n=e.closest(".list-group-item"),a=e.data("action");switch(a){case"Properties":H(n);break;case"Rename":const e=x(n);sInputForm.show("Rename element","New name",e,(function(t){t!==e&&(t=V(t),function(e,t){e.find(".sViewTreeElement").first().text(t)}(n,t))}));break;case"Reparent":sInputForm.show("Reparent element","New parent","",(function(e){!function(e,t){const n=F(t);if(null==n)return void sMainGUI.println("ERROR: parent element not found!!! : "+t);C(n,I(e),!1).accept?W(e,n):sMessageForm.showWarning("Reparent error","Target does not accept children of this type!")}(n,e)}));break;case"Remove":sMainConfirmationForm.show(x(n),"This action cannot be undone. Do you really want to remove this element?","Remove",(function(){A(n,!0)}));break;case"AddCustom":v(h=[],n,null),sCustomElementForm.show((function(e,a){t.addToCustomGroup(e,a,x(n),h)}));break;case"Copy":case"Cut":v(h=[],n,null),"Cut"==a&&A(n,!0);break;case"Paste":B(n,h);break;case"MoveUp":!function(e){var t=e.prev();if(t.length>0){if((t=t.first()).hasClass("list-group")&&(t=t.prev().first()),O(t))return;e.insertBefore(t);const n=R(e);n&&n.insertAfter(e),d.reportableTreeChange("Move Up")}}(n);break;case"MoveDown":!function(e){var t=e.next();const n=R(e);if((t=n?n.next():e.next()).length>0){const a=R(t=t.first());a&&(t=a),e.insertAfter(t),n&&n.insertAfter(e),d.reportableTreeChange("Move Down")}}(n);break;case"Help":t.showElementClassHelp(I(n))}}return d.reportableTreeChange=function(e){sMainGUI.setChanged();var n={panel:"view",action:"setView",pages:t.saveObject().pages};sMainGUI.reportPreview(n)},d.reportablePropertyChange=function(e,t,n){d.reportableTreeChange("On behalf of element :"+t)},d.getRootProperties=function(){return p},d.isEmpty=function(){return $(e).children(".list-group-item").length<=1},d.getTree=function(){var t=[];return $(e).children(".list-group-item").each((function(e,n){const a=$(n);if(w(a)<0)return!0;b(t,a)})),t},d.getPropertyByName=function(e,t){if(!t)return null;for(var n=0;n<t.length;n++){const a=t[n];if(a.name==e)return a.value}return null},d.setPropertyByName=function(e,t,n){const a=t.length<=0,o=g[n];if(!o)return a?o:(g[n]=[{name:e,value:t}],d.reportablePropertyChange(n,e,t),g[n]);for(var i=0;i<o.length;i++){const s=o[i];if(s.name==e)return a?o.splice(i,1):s.value=t,d.reportablePropertyChange(n,e,t),o}return a||(o.push({name:e,value:t}),d.reportablePropertyChange(n,e,t)),o},d.getDetectedPropertiesOfType=function(t){var n=[];return $(e).children(".list-group-item").each((function(e,a){const o=$(a);if(w(o)<0)return!0;_(n,o,t)})),n},d.setTree=function(n,a){for(var o in m=0,g={},f)f.hasOwnProperty(o)&&f[o]&&f[o].hide();if(f={},null==u&&(u=function(){const e=t.getElementClassIconSRC(l);return $('<div role="treeitem" class="list-group-item fw-bold py-0 border-0" data-hash="-1" style="padding-left:0.25rem" aria-level="0"><span class="dropdown"><img class="root-icon dropdown" style="padding: 0 2px 0 2px;" src="'+e+'"  id="mViewItemMenuIcon_'+m+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></img><ul class="dropdown-menu" aria-labelledby="mViewItemMenuIcon_'+m+'"><li><span class="sTranslatable dropdown-item-text">Menu for Simulation view</span></li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Properties">Properties</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Paste">Paste</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cViewMenuItem" data-action="Help">Help</li></ul></span><span class="sViewTreeElement">Simulation view</span></div>')}()),n&&(p=n),$(e).empty(),e.append(u),a)for(var i=0;i<a.length;i++){var s=a[i],r=s.Type.split(".");s.Type=r[r.length-1],E(e,s,0)}},$(e).addClass("bstreeview"),$(e).on("click",".state-icon",(function(e){var t=$(e.currentTarget);if(t.hasClass(s))return;t.toggleClass(o).toggleClass(i);const n=$(e.currentTarget).closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle")})),$(e).on("dblclick",".sViewTreeElement",(function(e){H($(e.currentTarget).closest(".list-group-item"))})),$(e).on("dragenter",".sViewTreeElement",(function(e){e.preventDefault(),$(e.target).parent().addClass("bg-info")})),$(e).on("dragover",".sViewTreeElement",(function(e){e.preventDefault()})),$(e).on("dragleave",".sViewTreeElement",(function(e){e.preventDefault(),$(e.target).parent().removeClass("bg-info")})),$(e).on("drop",".sViewTreeElement",(function(e){const n=e.originalEvent.dataTransfer.getData("text"),a=n.split(":")[1];if("undefined"==a)return;e.preventDefault();const o=$(e.target).parent();if(o.removeClass("bg-info"),n.startsWith("EJS-element"))J(a,o);else if(n.startsWith("EJS-palette")){const e=a;e.startsWith("_custom_")?B(o,t.getCodeForCustomElement(e)):function(e,t){const n=C(t,e,!1);n.accept?n.parent?G(e,n.parent,t):G(e,t,null):sMessageForm.showWarning("Creation error","Target does not accept children of this type!")}(e,o)}})),d.clearPropertyEditor=function(e){delete f[e]},$(e).on("click",".item-icon",(e=>{const t=$(e.target).closest(".list-group-item");$(e.target).parent().find(".cViewMenuHeader").text(sMainResources.getString("Menu for")+" "+x(t))})),$(e).on("click",".cViewMenuItem",(e=>{j($(e.target))})),d},(WebEJS_GUI=WebEJS_GUI||{}).viewElements_dragFunction=function(e,t){e.dataTransfer.setData("text","EJS-"+t+":"+e.target.dataset.drag_info)},WebEJS_GUI.viewWorkpanel=function(){var e={};const t=WebEJS_GUI.viewTree($("#sViewTree"),e);var n,a,o;function i(){return'<div class="col px-1 py-1 cViewEmptyElement"><img src="'+sMainGUI.getSystemIconURL("elements/EMPTY.gif")+'"></div>'}var s=[];function r(e){const t=e.HtmlViewFragment,n=t["HtmlViewFragment.Parent"],a=t["HtmlViewFragment.Code"]["HtmlView.Element"];for(var o=[],i=0;i<a.length;i++){const e=a[i];e.Parent==n&&delete e.Parent,e.Type.startsWith("Elements.")&&(e.Type=e.Type.substring(9));const t=e.Property,r=[];if(t){for(var s=0;s<t.length;s++){const e=t[s];r.push({name:e["@name"],value:e["#text"]})}delete e.Property}e.Properties=r,o.push(e)}return o}function l(e,t){for(var n="<HtmlViewFragment>\n<HtmlViewFragment.Parent>Simulation view</HtmlViewFragment.Parent>\n<HtmlViewFragment.Code>\n",a=0;a<t.length;a++){const e=t[a];n+="  <HtmlView.Element>\n    <Expanded>"+("true"==e.Expanded?"true":"false")+"</Expanded>\n    <Type>Elements."+e.Type+"</Type>\n    <Name><![CDATA["+e.Name+"]]></Name>\n","Parent"in e&&e.Parent&&(n+="    <Parent><![CDATA["+e.Parent+"]]></Parent>\n");const i=e.Properties;for(var o=0;o<i.length;o++){const e=i[o];n+='    <Property name="'+e.name+'"><![CDATA['+e.value+"]]></Property>\n"}n+="  </HtmlView.Element>\n"}return n+="</HtmlViewFragment.Code>\n</HtmlViewFragment>\n"}function c(e,t,n,a){const o="_custom_"+(a?"user_":"system_")+e;s[o]=n;const i=e.indexOf("_"),r=a?"cViewUserElement":"cViewElementOnPalette",l=i>0?e.substring(i+1):e;return'<div class="col px-1 py-1" style="user-select: none;" data-element_class="'+e+'"><img class="'+r+'" src="data:image/gif;base64,'+t+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'palette\')" data-drag_info="'+o+'" data-element_type="'+e+'" data-bs-toggle="tooltip" data-bs-placement="top" title="'+l+'"></img></div>'}function u(e,t,n){return'<div class="col px-1 py-1" style="user-select: none;" ><img class="cViewElementOnPalette" src="'+t+'"  draggable="true" ondragstart="WebEJS_GUI.viewElements_dragFunction(event,\'palette\')" data-drag_info="'+e+'"'+(n?' data-bs-toggle="tooltip" data-bs-placement="top" title="'+n+'"':"")+"></img></div>"}function d(t,n){var a=" active ",o="true",s=0,l='<ul class="nav nav-pills justify-content-center" role="tablist" ">',d='<div class="tab-content">';for(const[v,_]of Object.entries(n)){var p="mViewElements_"+t+"_"+ ++s;l+='<li class="nav-item" role="presentation"><button class="nav-link py-0 px-2'+a+'"  id="'+p+'-tab" data-bs-toggle="tab" data-bs-target="#'+p+'"  type="button" role="tab" aria-controls="'+p+'" aria-selected="'+o+'" data-bs-toggle="tooltip" data-bs-placement="top" title="'+v+'"><img src="'+sMainGUI.getSystemIconURL("groups/"+v+".gif")+'"></button></li>',d+='<div class="tab-pane fade show '+a+'" id="'+p+'" role="tabpanel" aria-labelledby="'+p+'-tab"><div class="mPaletteSubpanel container" '+("Compound"==v?'id="mPaletteGroup_Compound"':"")+'><div class="row m-0">';var m=1,f=0;if("Compound"==v)for(var h=0;h<_.length;h++){const e=_[h];d+=c(e.name,e.icon,r(e.fragment),"true"==e.is_user),++f%8==0&&h<_.length-1&&(m++,f=0,d+='</div><div class="row m-0">')}else for(h=0;h<_.length;h++){const t=_[h];d+="EMPTY"==t?i():u(t,e.getElementClassIconSRC(t),g(t)),++f%8==0&&h<_.length-1&&(m++,f=0,d+='</div><div class="row m-0">')}for(;f<8;)d+=i(),f++;for(d+="</div>";m<2;){if(d+='<div class="row m-0">',"Compound"==v)for(var b=0;b<8;b++)d+=i();else d+=i();d+="</div>",m++}d+="</div></div>",a="",o="false"}return(l+="</ul>")+(d+="</div>")}function p(e){return a[e]}function m(e){const t=e.split(".");return o[t[0]][t[1]]}function g(e){const t=m(p(e));return"description"in t?t.description:sMainResources.getString(e+"_INFO")}function f(e){for(var t=[];;){t.push(e);const n=m(e);if(!("parent"in n))return t;e=n.parent}}return e.getCodeForCustomElement=function(e){return s[e]},e.addToCustomGroup=function(e,t,n,a){const o=c(e,t,a,!0);var i=$("#mPaletteGroup_Compound .cViewEmptyElement");i.length<=0&&alert("No places left"),$(i[0]).replaceWith(o),sMainRefreshTooltips();const s={name:e,icon:t,code:l(0,a)};sMainComm.addCustomElement(s)},e.buildPalette=function(e){n=e.view_elements,a=n.classnames,o=e.view_elements_info;var t="",i=0;for(const[e,a]of Object.entries(n.panels)){var s="mViewPaletteRow_"+ ++i;t+='<div class="accordion-item p-0"><span class="accordion-header" id="'+s+'-header"><button class="sViewBtn accordion-button py-1" type="button" data-bs-toggle="collapse"  data-bs-target="#'+s+'" aria-expanded="true" aria-controls="'+s+'">'+e+'</button></span><div id="'+s+'" class="accordion-collapse collapse show" aria-labelledby="'+s+'-header"><div class="mPaletteSubpanel accordion-body p-0">'+d(i,a)+"</div></div></div>"}$("#sViewPaletteSubpanel").html(t)},e.saveObject=function(){return{Tree:t.getTree(),RootProperties:t.getRootProperties()}},e.readObject=function(e){var n=!1,a=[],o={};if("view"in e){const t=e.view;"Tree"in t&&(o=t.Tree,a=t.RootProperties,n=!0)}return t.setTree(a,o),n},e.getDetectedFiles=function(){var e=[];return e.push(...t.getDetectedPropertiesOfType("File")),e},e.viewIsEmpty=function(){return t.isEmpty()},e.getWikiHelpPage=function(e){if(!e)return"https://t.um.es/webejs";return"Poligon"===e?e="Polygon":e.startsWith("UserDefined.")&&(e="UserDefined"),"https://www.um.es/fem/EjsWiki/Main/HtmlViewElements"+e},e.showElementClassHelp=function(t){window.open(e.getWikiHelpPage(t),"_blank")},e.getElementClassIconSRC=function(e){const t=m(p(e));return"icon"in t?t.icon:sMainGUI.getSystemIconURL("elements/"+e+".gif")},e.getElementClassTextProperty=function(e){const t=m(p(e));return"text"in t?t.text:null},e.getElementClassEditionInfo=function(e){return m(p(e)).edition},e.getElementClassDefaultProperties=function(e){for(var t=[],n=p(e);;){const e=m(n);if("defaults"in e){const n=e.defaults;for(var a in n)n.hasOwnProperty(a)&&t.push({name:a,value:n[a]})}if(!("parent"in e))return t;n=e.parent}},e.getElementClassProperties=function(t,n){for(var a=p(t),o=[];;){const t=m(a);if("properties"in t){const a=t.properties;if(n)for(var i=0;i<a.length;i++){const t=a[i];e.isPropertyOfType(t,n)&&o.push(t)}else o.push(...a)}if(!("parent"in t))return o;a=t.parent}},e.parentAcceptsChild=function(e,t){const n=f(p(e)),a=f(p(t));for(var o=0;o<n.length;o++){const e=m(n[o]);if("accepts"in e){const t=e.accepts;for(var i=0;i<a.length;i++)for(var s=0;s<t.length;s++)if(t[s]==a[i])return!0}}return!1},e.getPropertyDescription=function(e,t){for(var n=0;n<t.length;n++){var a=t[n];if(e==a.name)return a}return null},e.getPropertyDefaultValue=function(e){return e.default},e.getPropertyModifiersString=function(e){return e.modifiers},e.getPropertyTypesString=function(e){return e.types},e.getPropertyTypesList=function(e){return e.split("|")},e.hasPropertyModifier=function(e,t){return e.modifiers.indexOf(t)>=0},e.getPropertyModifiersList=function(e){return e.split("|")},e.isPropertyOfType=function(e,t){return e.types.indexOf(t)>=0},e.hasModifier=function(e,t){return e.indexOf(t)>=0},e.isOfType=function(e,t){return e.indexOf(t)>=0},$("#sViewPaletteSubpanel").on("dblclick",".cViewElementOnPalette",(function(t){e.showElementClassHelp($(t.currentTarget).data("drag_info"))})),$("#sViewPaletteSubpanel").on("dblclick",".cViewUserElement",(function(e){sMainConfirmationForm.show($(e.currentTarget).data("element_type"),"This element was created by the user and is not editable.<br>Do you want to delete it?","Delete",(function(){!function(e){sMainComm.deleteCustomElement(e);const t=$('#mPaletteGroup_Compound *[data-element_class="'+e+'"]');t.length>0&&$(t[0]).replaceWith(i())}($(e.currentTarget).data("element_type"))}))})),e};var WebEJS_GUI,WebEJS_TOOLS,WebEJS_RESOURCES=WebEJS_RESOURCES||{};WebEJS_RESOURCES.sSingleton=null,WebEJS_RESOURCES.main=function(e){if(null!=WebEJS_RESOURCES.sSingleton)return WebEJS_RESOURCES.sSingleton;var t={},n="en",a=null;const o={Description:"Descripción",Model:"Modelo",View:"Vista",Preview:"Previsualización",Output:"Salida",D:"D",M:"M",V:"V",P:"P",O:"S","Clear output":"Borrar salida","Create a new simulation":"Crear una simulación nueva","Load a simulation from your device":"Cargar una simulación desde su dispositivo","Download a simulation from a digital library":"Descargar una simulación desde una librería digital","Manage the simulation files":"Organizar los archivos de la simulación","Download ZIP with the sources":"Descargar un ZIP con las fuentes de la simulación","Download ZIP with the complete simulation":"Descargar un ZIP con la simulación completa","Search in the simulation":"Buscar en la simulación","Run the simulation":"Ejecutar la simulación","Translate the simulation":"Traducir la simulación","Run the simulation":"Ejecutar la simulación","Show WebEJS options":"Mostrar las opciones de WebEJS","Show info and help":"Mostrar información y ayuda",Variables:"Variables",Initialization:"Inicialización",Evolution:"Evolución","Fixed relations":"Relaciones fijas",Custom:"Propio",Elements:"Elementos",Name:"Nombre","Create new page":"Crear una nueva página",Page:"Página","Click to create a page of variables":"Haga clic para crear una página de variables","Click to create a page of initialization":"Haga clic para crear una página de inicialización","Click to create a page of fixed relations":"Haga clic para crear una página de relaciones fijas","Click to create a page of code":"Haga clic para crear una página de código","Click to create a page of ODEs":"Haga clic para crear una página de EDO","Click to create a page of custom code":"Haga clic para crear una página de código propio","Frames<br>per second":"Imágenes<br>por segundo","Tree of elements":"Árbol de elementos","Elements for the view":"Elementos para la vista"};return t.setLocale=function(e){"es"==e?(a=o,n="es"):(a=null,n="en"),t.translateAll()},t.translateAll=function(){$(".sTranslatable").each((function(){$(this).text(t.getString($(this).data("original_string")))})),$(".sTranslatableHTML").each((function(){$(this).html(t.getString($(this).data("original_string")))})),$(".sTranslatableTitle").each((function(){$(this).prop("title",t.getString($(this).data("original_string")))})),sMainRefreshTooltips()},t.prepareForTranslation=function(e){$(e).find(".sTranslatable").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).text())})),$(e).find(".sTranslatableHTML").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).html())})),$(e).find(".sTranslatableTitle").each((function(){$(this).data("original_string")||$(this).data("original_string",$(this).prop("title"))})),t.translateAll()},t.updateTranslation=function(e){for(var n=0;n<e.length;n++)parentSelector=e[n],$(parentSelector).find(".sTranslatable").each((function(){$(this).data("original_string",$(this).text()),$(this).text(t.getString($(this).data("original_string")))})),$(parentSelector).find(".sTranslatableHTML").each((function(){$(this).data("original_string",$(this).html()),$(this).html(t.getString($(this).data("original_string")))})),$(parentSelector).find(".sTranslatableTitle").each((function(){$(this).data("original_string",$(this).prop("title")),$(this).prop("title",t.getString($(this).data("original_string")))}))},t.getLocale=function(){return n},t.getString=function(e){return null==a?e:e in a?a[e]:"[?] "+e},t.prepareForTranslation("#sMainBody"),null!=e&&t.setLocale(e),WebEJS_RESOURCES.sSingleton=t,t},(WebEJS_GUI=WebEJS_GUI||{}).confirmationForm=function(){var e={};$("body").append($('\n  <div class="modal fade" id="mConfirmationFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mConfirmationFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 id="mConfirmationFormTitle" class="sTranslatable text-primary modal-title">Confirmation</h5>\n      \t\t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n\n\n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div id="mConfirmationFormMessage" class="modal-body">\n\t\t\t\t<p>Do you really want to do this?</p>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mConfirmationFormCloseButton" class="btn btn-secondary me-auto">Oops! Please cancel</button>\n\t\t\t\t<button type="button" id="mConfirmationFormOkButton" \t\tclass="btn btn-primary">Confirm</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var t,n,a=new bootstrap.Modal(document.getElementById("mConfirmationFormModal"));$("#mConfirmationFormLogo").attr("src",sMainEjsLogo);var o=!1;function i(e,i,s,r,l,c){$("#mConfirmationFormTitle").text(e),$("#mConfirmationFormTitle").removeClass(["text-primary","text-danger"]).addClass(i),$("#mConfirmationFormMessage").html(s),$("#mConfirmationFormOkButton").text(sMainResources.getString(r)),t=l,n=c,o=!1,a.show()}return $("#mConfirmationFormModal").on("hidden.bs.modal",(function(){o?t():n&&n()})),$("#mConfirmationFormCloseButton").click((function(){a.hide()})),$("#mConfirmationFormOkButton").click((function(){o=!0,a.hide()})),e.showWarning=function(e,t,n,a,o){i(e,"text-danger","<p>"+sMainResources.getString(t)+"</p>",n,a,o)},e.show=function(e,t,n,a,o){i(e,"text-primary","<p>"+sMainResources.getString(t)+"</p>",n,a,o)},e.showHtml=function(e,t,n,a,o){i(e,"text-primary",t,n,a,o)},e},(WebEJS_GUI=WebEJS_GUI||{}).customElementForm=function(){var e={};$("body").append($('\n<div class="modal fade" id="mCustomElementFormModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\n\t\t\n\t<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">\n\t\t\n\t\t<div class="modal-content">\n      \t\n\t\t\t<div class="modal-header bg-light text-dark">\n    \t\t<img id="mCustomElementFormLogo" height="40" class="me-2 d-inline-block align-bottom;">\n      \t\t<h5 class="sTranslatable text-primary modal-title">Add custom element</h5>\n\t\t\t\t</img>\n      \t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n    \t</div>  \n    \t\x3c!------------------  end modal header ---------------\x3e\n\n\t\t\t<div class="modal-body">\n\t\t\t\t<div class="mb-2">\n\t\t\t\t\t<label id="mCustomElementFormNameLabel" for="mCustomElementFormNameValue" class="sTranslatable form-label form-label-sm">Name</label>\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" name="mCustomElementFormNameValue" id="mCustomElementFormNameValue"\n\t\t\t\t\t\tplaceholder="Enter name here" >\n\t\t\t\t</div>\n\t       <div class="input-group mb-3">\n\t         <label class="input-group-text sTranslatable" for="mCustomElementFormIconField" class="form-label">Click to choose a (24x24) icon</label>\n\t         <label class="input-group-text bg-white" id="mCustomElementFormIconButton">\n\t           <img id="mCustomElementFormIconImage" width="24" height="24">\n\t         </label>\n         <input class="form-control d-none" accept="image/*"  id="mCustomElementFormIconField" type="file">\n       </div>\n\t\t\t</div>\n      \t\n    \t\x3c!------------------  end modal body ---------------\x3e\n\t\t\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" id="mCustomElementFormCancelButton" class="sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Cancel</button>\n\t\t\t\t<button type="button" id="mCustomElementFormOkButton" class="sTranslatable btn btn-primary float-left">OK</button>\n\t\t\t</div>\n\n    \t\x3c!------------------  end modal footer ---------------\x3e\n\n\t\t</div>\n\t\t\x3c!------------------  end modal content ---------------\x3e\n\t\t\n\t</div>\t\n\t\x3c!------------------  end modal-dialog ---------------\x3e\n\n</div>\n\x3c!------------------  end modal ---------------\x3e\n'));var t,n=new bootstrap.Modal(document.getElementById("mCustomElementFormModal"));return $("#mCustomElementFormLogo").attr("src",sMainEjsLogo),$("#mCustomElementFormIconField").change((function(e){$("#mCustomElementFormIconImage").attr("src",URL.createObjectURL(e.target.files[0]))})),$("#mCustomElementFormCancelButton").click((function(){n.hide()})),$("#mCustomElementFormOkButton").click((function(){var e=$("#mCustomElementFormNameValue").val().trim();if(""!=e&&null!=e){var a=$("#mCustomElementFormIconField").val().trim();""!=a&&null!=a?(n.hide(),t&&t(e,WebEJS_TOOLS.getBase64("mCustomElementFormIconImage"))):alert("An icon is required!")}else alert("Name field is required!")})),e.show=function(e){t=e,n.show()},e},(WebEJS_GUI=WebEJS_GUI||{}).fileChooser_drag_prefix="_webEJSFileChooserPath_:",WebEJS_GUI.fileChooser_dragFunction=function(e){e.dataTransfer.setData("text",WebEJS_GUI.fileChooser_drag_prefix+e.target.dataset.path)},WebEJS_GUI.fileChooser=function(e,t,n){var a={},o="webEJSFileChooserModal";for(var i=1;$("#"+o).length>0&&i<1e3;)o="webEJSFileChooserModal"+ ++i;["fullscreen","lg","xl"].includes(t)||(t="fullscreen");var s=function(e){return"(en) "+e},r=function(e){$(e+" .sTranslatable").each((function(){const e=$(this).data("_locale_original_text");if(e)$(this).text(s(e));else{const e=$(this).text();$(this).data("_locale_original_text",e),$(this).text(s(e))}}))};void 0!==n&&(s=n.getString,r=n.translateAll);const l='\n\t\t<div class="modal-header bg-light text-dark">\n\t\t<img src="'+sMainEjsLogo+'" height="40" class="me-2 d-inline-block align-bottom;">\n\t\t<h5 class="ps-2 sTranslatable text-primary modal-title">#{TITLE}</h5>\n\t\t\t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n\t\t</div>\n\t\t',c='\n\t\t<div id="#{ID}" \n\t\t\t\t\tclass="modal modal-dialog-scrollable fade" \n\t\t\t\t\tdata-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\t\n\t\t\t<div class="modal-dialog modal-#{SIZE} modal-dialog-centered modal-dialog-scrollable">\n\t\t\t\t<div class="modal-content h-100">\n\t\t\t\t\t'+l+'\n\n\t\t\t\t\t<div class="modal-body d-flex flex-row">\n\t\t\t\t\n\t\t\t\t\t\t<div id="mFileChooserHelper" class="col-2 m-0 p-0" style="flex-grow:1;">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\n\t\t\t\t\t<div class="h-100 col-10 d-flex flex-column" style="flex-grow:1;">\n\t\t\t\t\t\t<div class="bstreeview h-100 d-flex flex-column" style="flex-grow: 1"></div>\n\t\t\t\t\t\t<div class="border-top" style="flex-grow: 0; flex-basis: 0">\n\t\t\t\t\t\t\t<span class="flex flex-grow input-group input-group-sm mt-1">\n\t\t\t\t\t\t\t\t<nav aria-label="breadcrumb">\n\t\t\t\t\t\t\t\t\t<ol class="breadcrumb m-0"></ol>\n\t\t\t\t\t\t\t\t</nav>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="filename_div flex flex-grow input-group input-group-sm mt-1">\n\t\t\t\t\t\t\t\t<span  class="sTranslatable input-group-text">Filename</span>\n\t\t\t\t\t\t\t\t<input type="text" class="filename_input flex flex-grow form-control"   \n\t\t\t\t\t\t\t\t\tplaceholder="<Type in or click on an option>" aria-label="Filename"   \n\t\t\t\t\t\t\t\t\tvalue="">\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t<div class="modal-footer">\n\t\t\t   \t\t\t<button type="button" class="cancel_button sTranslatable btn btn-secondary me-auto" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t<button type="button" class="upload_button sTranslatable btn btn-outline-secondary me-auto">Upload File</button>\n\t\t\t\t\t\t<button type="button" class="folder_button sTranslatable btn btn-outline-secondary me-auto">New Folder</button>\n\t\t\t\t\t\t<button type="button" class="ok_button btn btn-primary">Done</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',u='\n\t\t<div id="#{ID}-new_folder_modal" class="modal fade"\n\t\t\t data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n\t\t\n\t\t\t<div class="modal-dialog modal-dialog-centered">\n\t\t\t\t<div class="modal-content">\n\t\t\t\t'+l+'\n\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="input-group mb-3">\n\t\t\t\t\t\t\t\t<span  id="#{ID}-new_folder_label" class="sTranslatable input-group-text">Name</span>\n\t\t\t\t\t\t\t\t<input id="#{ID}-new_folder_name"  type="text" class="name_input form-control" \n\t\t\t\t\t\t\t\t\tplaceholder="Folder name here" aria-label="Folder name" aria-describedby="#{ID}-new_folder_label">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t<button type="button" class="sTranslatable btn btn-secondary me-auto" \n\t\t\t\t\t\t\t\t\t\tdata-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n\t\t\t\t\t\t<button type="button" class="ok_button sTranslatable btn btn-primary">Create</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',d='\n\t\t<div id="#{ID}-upload_modal" class="modal fade"\n\t\t\tdata-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n\t\t\n\t\t\t<div class="modal-dialog modal-dialog-centered">\n\t\t\t\t<div class="modal-content">\n\t\t\t\t'+l+'\n\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t<div class="input-group mb-3">\n\t\t\t\t\t\t\t<span  id="#{ID}-upload_label" class="sTranslatable input-group-text">Name</span>\n\t\t\t\t\t\t\t<input id="#{ID}-upload_name"  type="text" class="name_input form-control" \n\t\t\t\t\t\t\t\t\tplaceholder="File name here" aria-label="File name" aria-describedby="#{ID}-upload_label">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="input-group mb-3">\n\t\t\t\t\t\t\t<input  id="#{ID}-upload_input" class="form-control" type="file">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t<button type="button" class="sTranslatable btn btn-secondary me-auto" \n\t\t\t\t\t\t\t\t\t\tdata-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n\t\t\t\t\t\t<button type="button" class="ok_button sTranslatable btn btn-primary">Upload</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',p='\n\t<div id="#{ID}-rename_modal" class="modal fade"\n\t\t data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n\t\n\t\t<div class="modal-dialog modal-dialog-centered">\n\t\t\t<div class="modal-content">\n\t\t\t'+l+'\n\t\t\t<div class="modal-body">\n\t\t\t\t\t\t<div class="input-group mb-3">\n\t\t\t\t\t\t\t<span  id="#{ID}-rename_label" class="sTranslatable input-group-text">New name</span>\n\t\t\t\t\t\t\t<input id="#{ID}-rename_name"  type="text" class="name_input form-control" \n\t\t\t\t\t\t\t\tplaceholder="New name here" aria-label="Folder name" aria-describedby="#{ID}-rename_label">\n\t\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t<button type="button" class="sTranslatable btn btn-secondary me-auto" data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n\t\t\t\t\t<button type="button" class="ok_button sTranslatable btn btn-primary">Apply</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';$("body").append($(c.replace(/#\{ID\}/g,o).replace(/#\{TITLE\}/g,"File Manager").replace(/#\{SIZE\}/g,t))),$("body").append($(u.replace(/#\{ID\}/g,o).replace(/#\{TITLE\}/g,"New Folder"))),$("body").append($(d.replace(/#\{ID\}/g,o).replace(/#\{TITLE\}/g,"Upload File"))),$("body").append($(p.replace(/#\{ID\}/g,o).replace(/#\{TITLE\}/g,"Rename")));const m=new bootstrap.Modal(document.getElementById(o)),g=new bootstrap.Modal(document.getElementById(o+"-new_folder_modal")),f=new bootstrap.Modal(document.getElementById(o+"-upload_modal")),h=new bootstrap.Modal(document.getElementById(o+"-rename_modal"));["","-new_folder_modal","-upload_modal","-rename_modal"].forEach((function(e){$("#"+o+e).on("show.bs.modal",(function(t){r("#"+o+e)}))})),$("#"+o).on("hide.bs.modal",(function(e){M=[],$("#"+o+" ."+k).each((function(){const e=$(this).closest(".list-group-item");M.push(e.data("path"))}))})),$("#mFileChooserHelper").on("click",".cFileChooserHelperImage",(function(e){m.hide();const t=$(e.currentTarget).data("value");x&&x(t)}));const b=$("#"+o+" .bstreeview"),v=$("#"+o+" .breadcrumb"),_=0,E=1,S=2;var T=null,y="/",P=_,C=null,O=0,w=null,M=[],x=null;function I(t){t?($("#mFileChooserHelper").html(t),$("#mFileChooserHelper").removeClass("d-none")):($("#mFileChooserHelper").html(""),$("#mFileChooserHelper").addClass("d-none")),null==T?e.refreshUserFiles((function(e){T={root_path:"/",root_entries:A(e,"/")},F(y)})):F(y)}function R(e,t){if("/"==e||""==e)return{parent:"/",name:""};e.startsWith("/")||(e="/"+e),t&&e.endsWith("/")&&(e=e.substring(0,e.length-1));const n=e.lastIndexOf("/");return{parent:e.substring(0,n+1),name:e.substring(n+1)}}function D(e){return""==e.name?e.parent:e.parent+e.name+"/"}function L(e){return e.parent+e.name}function A(e,t){for(var n=[],a=0;a<e.length;a++){var o=e[a];const i="DIRECTORY"==o.type,s=R(o.path,i);s.parent==t&&(s.name.startsWith(".")||(i?n.push({name:s.name,path:D(s),description:o.description,entries:A(e,D(s))}):n.push({name:s.name,path:L(s),description:o.description,url:o.url})))}return n}function F(e){switch(P){case S:$("#"+o+" .filename_div").removeClass("d-none"),$("#"+o+" .ok_button").text(s("Save")),$("#"+o+" .filename_input").attr("disabled",null==C);break;case E:$("#"+o+" .filename_div").addClass("d-none"),$("#"+o+" .ok_button").text(s("Read"));break;default:$("#"+o+" .filename_div").addClass("d-none"),$("#"+o+" .ok_button").text(s("Done"))}w=null,e;const t=e.endsWith("/"),n=R(e,t);if(t){if(!G(D(n)))return;Z(D(n))}else{if(!G(n.parent+"/"))return;Z(n.parent+"/"),K(e)}m.show()}a.reset=function(){T=null,y="/",w=null,O=0},a.showManager=function(){P=_,C=null,x=null,I(null)},a.showRead=function(e,t,n){P=E,C=e,x=t,I(n)},a.showWrite=function(e,t){P=S,C=e,x=t,I(null)};const N=o+"-tree-group-",k="bi-chevron-down",W="bi-chevron-right",J="bi-dash";function B(e){return e.startsWith("/")&&(e=e.substring(1)),e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function V(e,t){for(var n=0;n<t.length;n++){const a=t[n];if("entries"in a&&e==a.name)return a}return null}function U(e){if("/"==e)return T.root_entries;const t=B(e).split("/");for(var n=T.root_entries,a=0;a<t.length;a++){const e=V(t[a],n);if(null==e)return[];n=e.entries}return n}function G(e){var t=e?U(e):T.root_entries;$(b).empty();for(var n=0,a=0;a<t.length;a++){var o=t[a];n+=j(b,o,0,C)}return 0==n&&b.append($('<div class="m-3 text-secondary">'+s("(This folder is empty)")+"</div>")),M=[],!0}const H='\n\t\t<div role="treeitem" class="list-group-item py-0 border-0" style="padding-left: #{PADDING}" \n\t\t\tdraggable="true" ondragstart="WebEJS_GUI.fileChooser_dragFunction(event)" \n\t\t\tdata-path="#{PATH}" aria-level="#{DEPTH}" \n\t\t\t#{EXTRA_INFO}\n\t\t\t>\n\t\t\t<i class="state-icon pe-1 bi #{BI_CLASS}"></i>\n\t\t\t<span class="#{CLASS_STR}">\n\t\t\t\t<span class="dropdown">\n\t\t\t\t\t<i class="item-icon dropdown me-1 bi #{ICON_CLASS}"\n\t\t\t\t\t\tid="#{ID}-MenuIcon_#{HASH}" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n\t\t\t\t\t</i>\n\t\t\t\t\t<ul class="dropdown-menu py-0" aria-labelledby="#{ID}-MenuIcon_#{HASH}">\n\t\t\t\t\t\t\x3c!--li><span class="cFileChooserMenuHeader sTranslatable dropdown-item-text py-0 fw-bold">Menu</span></li>\n\n\t\t\t\t\t\t<li><hr class="dropdown-divider m-0"></li--\x3e\n\t\t\t\t\t\t<li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Rename">Rename</li>\n\t\t\t\t\t\t<li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Duplicate">Duplicate</li>\n\t\t\t\t\t\t#{FOLDER_OPTIONS}\n\t\t\t\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t\t\t\t<li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Delete">Delete</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</span>\n\t\t\t\t<span class="cFileChooserName">\n\t\t\t\t#{NAME}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</div>';function j(e,t,n,a){const i=function(e){return e>0?(.5+.5*e).toString()+"rem":"0.25rem"}(n),s="entries"in t;var r=0,l="";if(s){const e=M.includes(t.path)?k:W,a='\n\t\t\t\t<li><hr class="dropdown-divider m-0"></li>\n\t\t\t\t<li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Upload">Upload File</li>\n\t\t\t\t<li class="dropdown-item sTranslatable  cFileChooserMenuItem" data-action="Subfolder">Create Subfolder</li>\n\t\t\t';l=H.replace(/#\{ID\}/g,o).replace(/#\{PADDING\}/g,i).replace(/#\{PATH\}/g,t.path).replace(/#\{DEPTH\}/g,n).replace(/#\{EXTRA_INFO\}/g,' data-bs-target="#'+N+O+'" data-level="'+n+'" ').replace(/#\{BI_CLASS\}/g,e).replace(/#\{CLASS_STR\}/g,"cFileChooserFolder").replace(/#\{ICON_CLASS\}/g,"bi-folder").replace(/#\{FOLDER_OPTIONS\}/g,a).replace(/#\{NAME\}/g,t.name)}else{var c=!0;if(null!=a){const e=/(?:\.([^.]+))?$/.exec(t.path)[1];c=e&&a.includes(e)}const e=c?"cFileChooserElement":"text-muted",s=c?"bi-file-check":"bi-file";l=H.replace(/#\{ID\}/g,o).replace(/#\{PADDING\}/g,i).replace(/#\{PATH\}/g,t.path).replace(/#\{DEPTH\}/g,n).replace(/#\{EXTRA_INFO\}/g," ").replace(/#\{BI_CLASS\}/g,J).replace(/#\{CLASS_STR\}/g,e).replace(/#\{ICON_CLASS\}/g,s).replace(/#\{FOLDER_OPTIONS\}/g,"").replace(/#\{NAME\}/g,t.name),r++}if(e.append($(l)),s){const o=function(e,t){const n=$('<div role="group" class="list-group ps-2 collapse'+(t?" show":"")+'"  id="'+N+O+'"></div>');return e.append(n),n}(e,M.includes(t.path));r++,O++,n++;const i=t.entries;for(var u=0;u<i.length;u++){r+=j(o,i[u],n,a)}}return r}function z(t){t.startsWith("/")||(t="/"+t),t.endsWith("/")||(t+="/"),M=[],$("#"+o+" ."+k).each((function(){const e=$(this).closest(".list-group-item");M.push(e.data("path"))})),e.refreshUserFiles((e=>{T={root_path:"/",root_entries:A(e,"/")},G(t),Z(t)}),"Could not refresh files tree!")}function Z(e){e=B(e),v.empty();const t=e.split("/");if(e.length<=0||t.length<=0)v.append($('<li class="breadcrumb-item sTranslatable active" href="#" data-path="/">Simulation</li>'));else{v.append($('<li class="breadcrumb-item sTranslatable" href="#" data-path="/"><a href="#" >Simulation</a></li>'));for(var n=T.root_entries,a=0;a<t.length;a++){const e=V(t[a],n);if(null==e)return;var o;o=a==t.length-1?'<li class="breadcrumb-item active" aria-current="page" data-path="'+e.path+'">'+e.name+"</li>":'<li class="breadcrumb-item" href="#" data-path="'+e.path+'"><a href="#">'+e.name+"</a></li>",v.append($(o)),n=e.entries}}}function X(){var e=v.find("li.active").data("path");return e.endsWith("/")||(e+="/"),e}function Y(e){const t=e.data("path");return R(t,t.endsWith("/")).name}function K(e){if(P!=S)return;const t=e.endsWith("/");if(t)return void $("#mFileChooserFilename").val("");const n=R(e,t);$("#"+o+" .filename_input").val(n.name)}function q(e){const t=e.endsWith("/"),n=R(e,t);var a=U(n.parent);if(null==a)return!1;for(var o=0;o<a.length;o++)if(n.name==a[o].name)return!0;return!1}function Q(e){q(e)?sMainConfirmationForm.showWarning(e,"Existing file will be overwriten","Overwrite",(function(){x&&x(e)}),(function(){m.show()})):x&&x(e)}function ee(){const t=$("#"+o+"-rename_name").val().trim(),n=Y(w);if(t.length>0&&t!=n){if(t.indexOf("/")>=0)return h.hide(),void sMessageForm.showWarning("Error","Name can not contain '/' characters!",t,(function(){h.show()}));const n=w.data("path"),a=R(n,n.endsWith("/"));if("/"==a.parent&&t.startsWith("_"))return g.hide(),void sMessageForm.showWarning("Error","Names of files in the root can not begin with the '_' character!",t,(function(){h.show()}));const o=a.parent+t;if(q(o))return h.hide(),void sMessageForm.showWarning("Error","Name is taken!",o,(function(){h.show()}));e.userFileCommand({command:"Rename",path:n,new_path:o},(function(){z(y)}))}$("#"+o+"-rename_name").val(""),h.hide(),m.show()}$(v).on("click","a",(function(e){$(e.currentTarget).closest(".list-group-item");e.stopPropagation(),G(y=$(e.currentTarget).closest("li").data("path")),Z(y)})),$("#"+o+" .cancel_button").click((function(){m.hide()})),$("#"+o+" .ok_button").click((function(){if(P==S){const e=$("#"+o+" .filename_input").val().trim();if(e.length<=0)return;m.hide(),Q(X()+e)}else if(P==E){if(!w)return;m.hide(),x&&x(w.data("path"))}else m.hide()})),$("#"+o+" .folder_button").click((function(){oe=X(),m.hide(),g.show()})),$("#"+o+" .upload_button").click((function(){m.hide(),ne=y,f.show()})),$("#"+o+" .filename_input").change((function(){const e=$("#"+o+" .filename_input").val().trim();e.length<=0||(m.hide(),Q(X()+e))})),$("#"+o).on("click",".cFileChooserMenuItem",(t=>{const n=$(t.target).closest(".list-group-item"),a=$(t.target).data("action"),o=n.data("path");switch(console.log("Action "+a+" for path: "+o),a){case"Rename":m.hide(),h.show();break;case"Duplicate":!function(){const t=w.data("path");if("/"==t)return;var n;if(t.endsWith("/")){const e=t.substring(0,t.length-1);n=e+" copy/";for(var a=1;q(n)&&a<1e3;)n=e+" copy "+ ++a+"/"}else{n=t+" copy";for(a=1;q(n)&&a<1e3;)n=t+" copy "+ ++a}e.userFileCommand({command:"Duplicate",path:t,new_path:n},(function(){z(y)}))}();break;case"Delete":!function(){const t=w.data("path");if("/"==t)return;m.hide(),sMainConfirmationForm.showWarning(s("Delete"),s("WARNING!!! This action CANNOT be undone!!!")+"<br>"+t,s("Delete"),(function(){e.userFileCommand({command:"Delete",path:t},(function(){z(y),m.show()}))}),(function(){m.show()}))}();break;case"Subfolder":oe=n.data("path"),m.hide(),g.show();break;case"Upload":m.hide(),mUploadBasePath=w.data("path"),f.show()}})),$("#"+o+"-rename_modal").on("show.bs.modal",(function(e){const t=Y(w);$("#"+o+"-rename_name").val(t)})),$("#"+o+"-rename_modal .name_input").change((function(){ee()})),$("#"+o+"-rename_modal .ok_button").click((function(){ee()}));var te=null,ne="/";function ae(t){e.userFileCommand({command:"Upload",path:t,data:te},(function(){z(y)})),$("#"+o+"-upload_name").val(""),$("#"+o+"-upload_input").val(""),te=null,f.hide(),m.show()}$("#"+o+"-upload_input").change((function(e){const t=e.target.files[0];$("#"+o+"-upload_name").val().trim().length<=0&&$("#"+o+"-upload_name").val(t.name);const n=new FileReader;n.readAsBinaryString(t),n.onload=function(){te=btoa(n.result)}})),$("#"+o+"-upload_modal .ok_button").click((function(){if(null==te)return f.hide(),void sMessageForm.showWarning("Error","No upload file specified!","",(function(){f.show()}));const e=$("#"+o+"-upload_name").val().trim();if(e.length<=0)return;if(e.indexOf("/")>=0)return f.hide(),void sMessageForm.showWarning("Error","File name can not contain '/' characters!",e,(function(){f.show()}));if("/"==ne&&e.startsWith("_"))return f.hide(),void sMessageForm.showWarning("Error","Names of files in the root can not begin with the '_' character!",e,(function(){f.show()}));const t=ne+e;console.log("Want to upload file: "+t),q(t)?(f.hide(),sMainConfirmationForm.showWarning(s("Upload"),s("WARNING!!! Existing file will be overwriten!!!")+"<br>"+t,s("Overwrite"),(function(){ae(t)}),(function(){f.show()}))):ae(t)}));var oe="/";return $("#"+o+"-new_folder_modal .ok_button").click((function(){const t=$("#"+o+"-new_folder_name").val().trim();if(t.length>0){if(t.indexOf("/")>=0)return g.hide(),void sMessageForm.showWarning("Error","Folder name can not contain '/' characters!",t,(function(){g.show()}));if("/"==oe&&t.startsWith("_"))return g.hide(),void sMessageForm.showWarning("Error","Names of root folders can not begin with the '_' character!",t,(function(){g.show()}));const n=oe+t;e.userFileCommand({command:"NewFolder",path:n},(function(e){z(y)}))}$("#"+o+"-new_folder_name").val(""),g.hide(),m.show()})),$("#"+o).on("dragenter",".list-group-item,.breadcrumb-item",(function(e){e.preventDefault();var t=$(e.currentTarget);console.log("Currenttarget:"),console.log(t),console.log(t.attr("class")),t.hasClass("breadcrumb-item")||(t=t.closest(".list-group-item")),t.data("path").endsWith("/")&&t.addClass("bg-warning")})),$("#"+o).on("dragover",".list-group-item,.breadcrumb-item",(function(e){e.preventDefault();var t=$(e.currentTarget);t.hasClass("breadcrumb-item")||(t=t.closest(".list-group-item")),t.data("path").endsWith("/")&&t.addClass("bg-warning")})),$("#"+o).on("dragleave",".list-group-item,.breadcrumb-item",(function(e){e.preventDefault();var t=$(e.currentTarget);t.hasClass("breadcrumb-item")||(t=t.closest(".list-group-item")),t.removeClass("bg-warning")})),$("#"+o).on("drop",".list-group-item,.breadcrumb-item",(function(t){var n=t.originalEvent.dataTransfer.getData("text");if(!n.startsWith(WebEJS_GUI.fileChooser_drag_prefix))return;n=n.substring(WebEJS_GUI.fileChooser_drag_prefix.length),t.preventDefault();var a=$(t.currentTarget);a.hasClass("breadcrumb-item")||(a=a.closest(".list-group-item")),a.removeClass("bg-warning");const o=a.data("path");console.log("Element "+o+" received: "+n),e.userFileCommand({command:"Move",path:n,folder:o},(function(){z(y)}))})),$(b).on("click",".state-icon",(function(e){var t=$(e.currentTarget);if(t.hasClass(J))return;t.toggleClass(k).toggleClass(W);const n=$(e.currentTarget).closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle")})),$(b).on("dblclick",".cFileChooserFolder",(function(e){const t=$(e.currentTarget);t.closest(".state-icon").toggleClass(k).toggleClass(W);const n=t.closest(".list-group-item");$(n.attr("data-bs-target")).collapse("toggle"),G(y=n.data("path")),Z(y),w=null,K("/")})),$(b).on("click",".cFileChooserFolder",(function(e){if(P!=_)return;const t=$(e.currentTarget).closest(".list-group-item");w&&w.removeClass("bg-info"),(w=t).addClass("bg-info");K(t.data("path"))})),$(b).on("click",".cFileChooserElement",(function(e){const t=$(e.currentTarget).closest(".list-group-item");w&&w.removeClass("bg-info"),(w=t).addClass("bg-info");K(t.data("path"))})),$(b).on("dblclick",".cFileChooserElement",(function(e){if(P==_)return;m.hide();const t=$(e.currentTarget).closest(".list-group-item").data("path");P==S?Q(t):x(t)})),a},(WebEJS_GUI=WebEJS_GUI||{}).getTranslateAll=function(e){return void 0!==e?e.translateAll:function(e){$(e+" .sTranslatable").each((function(){const e=$(this).data("_locale_original_text");if(e)$(this).text("(en) "+e);else{const e=$(this).text();$(this).data("_locale_original_text",e),$(this).text("(en) "+e)}}))}},WebEJS_GUI.MODAL_TEMPLATE='\n<div id="#{ID}" class="modal fade"\n\tdata-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">\t\n\n<div class="modal-dialog modal-dialog-centered">\n\t<div class="modal-content">\n\n\t<div class="modal-header bg-light text-dark">\n\t   <img  src="#{LOGO}" height="40" class="me-2 d-inline-block align-bottom;">\n\t   <h5 class="ps-2 sTranslatable text-primary modal-title">#{TITLE}</h5>\n\t   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n\t</div>\n\t<div class="modal-body">\n\t\t#{BODY_HTML}\n\t</div>\n\t\t<div class="modal-footer">\n\t\t   <button type="button" class="sTranslatable btn btn-secondary me-auto" data-bs-target="##{ID}" data-bs-toggle="modal">Cancel</button>\n\t\t   #{FOOTER_HTML}\n\t   </div>\n   </div>\n</div>\n</div>\n',WebEJS_GUI.filenameForm=function(e){var t={},n="webEJSFilenameFormModal";const a=WebEJS_GUI.getTranslateAll(e),o='\n\t\t<div class="input-group mb-3">\n\t\t\t<span  id="#{ID}-label" class="sTranslatable input-group-text">Filename</span>\n\t\t\t<input id="#{ID}-name"  type="text" class="filename_input form-control" \n\t\t\t\tplaceholder="New name here" aria-label="Folder name" aria-describedby="#{ID}-label">\n\t\t</div>'.replace(/#\{ID\}/g,n);var i=WebEJS_GUI.MODAL_TEMPLATE.replace(/#\{ID\}/g,n).replace(/#\{LOGO\}/g,sMainEjsLogo).replace(/#\{TITLE\}/g,"Choose ZIP filename").replace(/#\{BODY_HTML\}/g,o).replace(/#\{FOOTER_HTML\}/g,'\n\t\t<button type="button" class="ok_button sTranslatable btn btn-primary">Download</button>\n\t\t');$("body").append($(i));const s=new bootstrap.Modal(document.getElementById(n));var r;return $("#"+n).on("show.bs.modal",(function(e){a("#"+n)})),$("#"+n+" .cancel_button").click((function(){s.hide()})),$("#"+n+" .ok_button").click((function(){const e=$("#"+n+" .filename_input").val().trim();""!=e&&null!=e&&(s.hide(),r&&r(e))})),t.show=function(e,t){$("#"+n+" .filename_input").val(e),r=t,s.show()},t},(WebEJS_TOOLS=WebEJS_TOOLS||{}).createJSPanel=function(e,t,n,a,o){t.config={theme:"bootstrap-light",headerLogo:sMainGUI.getWebEJSLogo(),headerTitle:'<h5 class="sTranslatable '+(o||"text-primary")+' modal-title">'+sMainResources.getString(e)+"</h5>",headerControls:n||{smallify:"remove",minimize:"remove"},position:{at:"center",of:"#sMainWorkpanel"},borderRadius:".3rem",panelSize:a||{width:Math.min(.7*window.innerWidth,600),height:Math.min(.6*window.innerHeight,800)}};const i=jsPanel.create(t);return $(".jsPanel-hdr").addClass(["p-1","bg-light"]),$(".jsPanel-content").addClass(["m-1","p-2","bg-light","border","border-dark","rounded"]),i},WebEJS_TOOLS.getBase64=function(e){var t=document.getElementById(e);if(t.naturalHeight<=0||t.naturalWidth<=0)return"";var n=document.createElement("canvas"),a=n.getContext("2d");n.height=t.naturalHeight,n.width=t.naturalWidth,a.drawImage(t,0,0);var o=n.toDataURL("image/png").replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return n.remove(),o},WebEJS_TOOLS.selectFile=function(e,t,n,a){sMainFileChooser.showRead(e,(function(e){e.startsWith("/org/opensourcephysics")||e.startsWith("/")&&(e="."+e),console.log("selected (relative) path = "+e),e.startsWith("/org/")&&(n=!1),n?sMainComm.checkRequiredFile(e,t,(function(e){var t="<p>"+sMainResources.getString("The selected file is not included in your simulation list of <i>User files</i>:")+'</p><p class="text-danger">'+e+"</p><p>"+sMainResources.getString("Please, add it before using it.","User file error")+"</p>";sMessageForm.showWarningHTML("User File Error",t)})):t(e)}),a)},(WebEJS_TOOLS=WebEJS_TOOLS||{}).LibraryComPADRE={OSP_INFO_URL:"https://www.compadre.org/OSP/online_help/EjsDL/OSPCollection.html",EJS_SERVER_TREE_LOCAL:"osp.php?basename=tree",EJS_SERVER_TREE:"https://www.compadre.org/services/rest/osp_ejss.cfm?verb=Identify&OSPType=EJSS+Model",EJS_SERVER_RECORDS_LOCAL:"osp.php?basename=records",EJS_SERVER_RECORDS:"https://www.compadre.org/osp/services/REST/osp_ejss.cfm?OSPType=EJSS+Model",EJS_SERVER_SEARCH:"https://www.compadre.org/osp/services/REST/search_v1_02.cfm?verb=Search&OSPType=EJSS+Model&Skip=0&Max=30&q=",EJS_COLLECTION_NAME:"EJS OSP Collection",EJS_INFO_URL:"http://www.compadre.org/OSP/online_help/EjsDL/DLModels.html",TRACKER_SERVER_TREE:"http://www.compadre.org/osp/services/REST/osp_tracker.cfm?verb=Identify&OSPType=Tracker",TRACKER_SERVER_RECORDS:"http://www.compadre.org/osp/services/REST/osp_tracker.cfm?OSPType=Tracker",TRACKER_COLLECTION_NAME:"Tracker OSP Collection",TRACKER_INFO_URL:"http://www.cabrillo.edu/~dbrown/tracker/library/comPADRE_collection.html",PRIMARY_ONLY:"&OSPPrimary=Subject",GENERIC_COLLECTION_NAME:"AAPT-ComPADRE OSP Collection",ABOUT_OSP:"About OSP and AAPT-ComPADRE",Description_DoubleClick:"dblClick",Description_Author:"Author",Description_DownloadSize:"Download Size",Description_InfoField:"Info"},WebEJS_TOOLS.LibraryResource={UNKNOWN_TYPE:"Unknown",COLLECTION_TYPE:"Collection",TRACKER_TYPE:"Tracker",EJS_TYPE:"EJS",VIDEO_TYPE:"Video",HTML_TYPE:"HTML",PDF_TYPE:"PDF"},WebEJS_TOOLS.libraryResource=function(e,t){var n,a={},o="",i="",s="",r="",l=WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE,c={},u=e+"/"+t;function d(e,t){return-1!==e.indexOf(t,e.length-t.length)}return a.getParent=function(){return e},a.getName=function(){return t},a.getId=function(){return u},a.getBasePath=function(){return i},a.setBasePath=function(e){return(e=e?e.trim():"")!=i&&(i=e,!0)},a.getTarget=function(){return r},a.setTarget=function(e){return(e=e?e.trim():"")!=r&&(n=null,r=e,d(e=e.toUpperCase(),".TRK")?a.setType(WebEJS_TOOLS.LibraryResource.TRACKER_TYPE):d(e,".PDF")?a.setType(WebEJS_TOOLS.LibraryResource.PDF_TYPE):e.indexOf("EJS")>-1?a.setType(WebEJS_TOOLS.LibraryResource.EJS_TYPE):""==e&&(null==a.getHTMLPath()?a.setType(WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE):a.setType(WebEJS_TOOLS.LibraryResource.HTML_TYPE)),!0)},a.getHTMLPath=function(){return o},a.setHTMLPath=function(e){return(e=e?e.trim():"")!=o&&(o=e,a.addResource||""!=a.getTarget()||(""==e?a.setType(WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE):a.setType(WebEJS_TOOLS.LibraryResource.HTML_TYPE)),!0)},a.getDescription=function(){return s},a.setDescription=function(e){return(e=e?e.trim():"")!=s&&(s=e,!0)},a.getType=function(){return l},a.setType=function(e){return l!=e&&(l=e,!0)},a.setProperty=function(e,t){c[e]=t},a.getProperty=function(e){return c[e]},a.getThumbnail=function(){return n},a.setThumbnail=function(e){n=e},a.toJSON=function(){var a={};return a.id=u,a.parent=e,a.text=t,a.type="file",a.data={},a.data.htmlPath=o,a.data.basePath=i,a.data.description=s,a.data.target=r,a.data.type=l,a.data.thumbnail=n,a},a},WebEJS_TOOLS.libraryCollection=function(e,t){var n=WebEJS_TOOLS.libraryResource(e,t),a={};return n.addResource=function(e){a[e.getName()]||(a[e.getName()]=e)},n.removeResource=function(e){a[e.getName()]&&delete a[e.getName()]},n.getResources=function(){return a},n.toJSON=function(){var e=[],t={};for(var o in t.id=n.getId(),t.parent=n.getParent(),t.text=n.getName(),t.type="folder",n.getName()===WebEJS_TOOLS.LibraryComPADRE.GENERIC_COLLECTION_NAME&&(t.state={opened:!0,selected:!0,disabled:!1}),t.data={},t.data.htmlPath=n.getHTMLPath(),t.data.basePath=n.getBasePath(),t.data.description=n.getDescription(),t.data.target=n.getTarget(),t.data.type=n.getType(),t.data.thumbnail=n.getThumbnail(),e.push(t),a){var i=a[o];e=e.concat(i.toJSON())}return e},n.setType(WebEJS_TOOLS.LibraryResource.COLLECTION_TYPE),n},WebEJS_TOOLS.libraryComPADRE=function(){var e={};function t(e,n,a,i){for(var s=!1,r=WebEJS_TOOLS.LibraryComPADRE.Description_DoubleClick,c=e.getId(),u=0;u<n.length;u++)if(n.item(u)instanceof Element){var d=n.item(u);if("sub-tree-set"==d.nodeName.toLowerCase()&&a==d.getAttribute("type")){var p=o(d,"sub-tree");if(p.length>0){for(var m=null,g=0;g<p.length;g++)if(p[g]instanceof Element){var f=p[g],h=f.getAttribute("name"),b=f.getAttribute("service-parameter");if(b=i+"&"+l(b),"Unclassified"!=h){var v=WebEJS_TOOLS.libraryCollection(c,h);if(e.addResource(v),s=!0,0==o(f,"sub-tree-set").length){var _="<h2>"+h+"</h2><blockquote>";v.setDescription(_+r+"</blockquote>"),v.setTarget(b)}else t(v,f.childNodes,a+"-detail",b)}else m=b}null!=m&&e.setTarget(m)}}}return s}function n(e,t){for(var n=s(e,"file-identifier"),o=e.childNodes,r=null,l=0,c=o.length;l<c;l++){var u=o.item(l);if("attached-document"!=!u.nodeName.toLowerCase()){var d=a(u,"file-type");if(null!=d&&t==i(d)){var p=a(u,"download-url");if(null!=p&&(null==r||n==s(u,"file-identifier"))){var m=i(p),g=a(u,"file-name");r=null!=g?[m,i(g),g.getAttribute("file-size")]:[m,null,null]}}}}return r}function a(e,t){for(var n=e.childNodes,a=0,o=n.length;a<o;a++){var i=n.item(a);if(i.nodeName.toLowerCase()==t.toLowerCase())return i}return null}function o(e,t){for(var n=[],a=e.childNodes,o=0,i=a.length;o<i;o++){var s=a.item(o);s.nodeName.toLowerCase()==t.toLowerCase()&&n.push(s)}return n}function i(e){for(var t=e.childNodes[0];null!=t;t=t.getNextSibling())if(t.nodeType==Node.TEXT_NODE)return t.nodeValue;return null}function s(e,t){var n=a(e,t);return null!=n?i(n):null}function r(e){for(var t=[],n=e.indexOf("&amp;");n>=0;)t.push(e.subSequence(0,n+1)),n=(e=e.substring(n+5)).indexOf("&amp;");return t.push(e),t.toString()}function l(e){if(null==e)return null;var t=e;for(0===t.indexOf("file:")&&(t=t.substring(5));0===t.indexOf("//");)t=t.substring(1);0===t.indexOf("/")&&t.indexOf(":")>-1&&(t=t.substring(1));for(var n=t.indexOf("%20");n>-1;){var a=t.substring(0,n);n=(t=a+" "+t.substring(n+3)).indexOf("%20")}return t}return e.getNameFromId=function(e){return e.substr(e.lastIndexOf("/")+1)},e.load=function(e,n){for(var a=n.getElementsByTagName("Identify"),o=!1,i=0;i<a.length;i++)o=t(e,a.item(i).childNodes,"osp-subject","")||o;return o},e.getResources=function(e,t){for(var l,c,u=!1,d=WebEJS_TOOLS.LibraryComPADRE.Description_Author,p=WebEJS_TOOLS.LibraryComPADRE.Description_DownloadSize,m=WebEJS_TOOLS.LibraryComPADRE.Description_InfoField,g=e.getId(),f=t.getElementsByTagName("record"),h=0;h<f.length;h++){var b,v=f.item(h);if(null!=(b=n(v,"Source Code"))){var _=s(v,"title"),E=WebEJS_TOOLS.libraryResource(g,_);e.addResource(E);var S=r(b[0]);E.setTarget(S),E.setProperty("download_filename",b[1]);var T=s(v,"osp-type").toUpperCase();T=0===T.indexOf("EJS")?WebEJS_TOOLS.LibraryResource.EJS_TYPE:"TRACKER"==T?WebEJS_TOOLS.LibraryResource.TRACKER_TYPE:WebEJS_TOOLS.LibraryResource.UNKNOWN_TYPE,E.setType(T);var y=s(v,"description"),P=s(v,"information-url"),C=s(v,"thumbnail-url"),O="",w=o(a(v,"contributors"),"contributor");for(var M in w){var x=w[M];"Author"==x.getAttribute("role")&&(O+=i(x)+", ")}c=", ",-1!==(l=O).indexOf(c,l.length-c.length)&&(O=O.substring(0,O.length-2));var I=[];I.push('<p align="center"><img src="'+C+'" alt="'+_+'"></p>'),I.push("<p><b></b></p>"),I.push("<h2>"+_+"</h2>"),O.length>0&&I.push("<p><b>"+d+":</b> "+O+"</p>"),y&&I.push("<p>"+y.replace(/\n([ \t]*\n)+/g,"</p><p>").replace("\n","<br />")+"</p>"),I.push("<p><b>"+m+'</b><br><a href="'+P+'" target="_blank">'+P+"</a></p>"),I.push("<p><b>"+p+"</b> "+b[2]+" bytes</p>"),E.setDescription(I.join("")),u=!0}}return u},e.getCollection=function(t,n,a){var o=function(e){return 0===e.indexOf(WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_TREE)?WebEJS_TOOLS.LibraryComPADRE.EJS_COLLECTION_NAME:0===e.indexOf(WebEJS_TOOLS.LibraryComPADRE.TRACKER_SERVER_TREE)?WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME:WebEJS_TOOLS.LibraryComPADRE.GENERIC_COLLECTION_NAME}(n),i=n.indexOf(WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY)>-1,s=WebEJS_TOOLS.libraryCollection(t,o);o==WebEJS_TOOLS.LibraryComPADRE.EJS_COLLECTION_NAME?s.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.EJS_INFO_URL):o==WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME&&s.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.TRACKER_INFO_URL);var r=WebEJS_TOOLS.libraryResource(s.getId(),WebEJS_TOOLS.LibraryComPADRE.ABOUT_OSP);r.setHTMLPath(WebEJS_TOOLS.LibraryComPADRE.OSP_INFO_URL),s.addResource(r),e.load(s,a);var l=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_RECORDS;return o==WebEJS_TOOLS.LibraryComPADRE.TRACKER_COLLECTION_NAME&&(l=WebEJS_TOOLS.LibraryComPADRE.TRACKER_SERVER_RECORDS),i&&(l+=WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY),s.setBasePath(l),s},e}(),WebEJS_TOOLS.getComPADRECollectionIndex=function(e){return WebEJS_TOOLS.getComPADRECollection(null,null,null,e)},WebEJS_TOOLS.getComPADRECollection=function(e,t,n,a){const o=null==t;e?e=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_RECORDS+e:(e=WebEJS_TOOLS.LibraryComPADRE.EJS_SERVER_TREE+WebEJS_TOOLS.LibraryComPADRE.PRIMARY_ONLY,t="#"),$.ajax({type:"POST",url:e,headers:{"Content-type":"application/x-www-form-urlencoded"},dataType:"xml",processData:!1,success:i=>{if(console.log("Received:"),console.log(i),o){var s=WebEJS_TOOLS.libraryComPADRE.getCollection(t,e,i);a(!0,s.toJSON())}else{var r=WebEJS_TOOLS.libraryComPADRE.getNameFromId(n),l=WebEJS_TOOLS.libraryCollection(t,r);const e=WebEJS_TOOLS.libraryComPADRE.getResources(l,i);a(e,l.toJSON())}},error:e=>{console.log("No XML content in OSP connection!"),console.log(e)}})},(WebEJS_TOOLS=WebEJS_TOOLS||{}).sTabbedPanelSingleton=null,WebEJS_TOOLS.tabbedPanel=function(){if(null!=WebEJS_TOOLS.sTabbedPanelSingleton)return WebEJS_TOOLS.sTabbedPanelSingleton;var e={};function t(e,t){$(e+" .cPageDiv").each((function(){t<0&&(t=$(this).data("hash")),$(this).data("hash")==t?$(this).removeClass("d-none"):$(this).addClass("d-none")})),$(e+" .sPageEditButton").each((function(){$(this).closest(".cPageTabButton").data("hash")==t?$(this).removeClass("d-none"):$(this).addClass("d-none")}))}function n(e,n){e.hasClass("cPageMenuItem")||e.closest(".cPageTabButton").find(".sPageEditButton").first().hasClass("d-none")&&t(n,e.closest(".cPageTabButton").data("hash"))}function a(e,t){const n=e.closest(".cPageTabButton").data("hash");p(t,e.data("action"),n,e.data("type"))}function o(e,t,n,a){const o=e.getKeyword();return'<li class="nav-item" role="presentation"><button class="cPageTabButton nav-link '+a.active+'" type="button"  role="tab" data-bs-toggle="tab"  data-hash='+t+' data-name="'+n.Name+'" data-active='+n.Active+" data-internal="+n.Internal+' data-type="'+n.Type+'" id="m'+o+"PageTab_"+t+'"  data-bs-target="#m'+o+"Page_"+t+'"  aria-controls="m'+o+"Page_"+t+'"  aria-selected="'+a.aria+'"><span class="dropdown"><i class="sPageEditButton dropdown bi bi-file-code '+a.display+'"  id="m'+o+"PageTabIcon_"+t+'" type="button" data-bs-toggle="dropdown" aria-expanded="false"></i><ul class="dropdown-menu" aria-labelledby="m'+o+"PageTabIcon_"+t+'"><li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageNew"  data-type="'+e.getDefaultPageType()+'" >Create a new page</li>'+(e.isPageSecondType?'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageNew"  data-type="'+e.getSecondType()+'">'+e.getSecondTypeLabel()+"</li>":"")+'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageEdit">Rename/Move this page</li><li><hr class="dropdown-divider"></li>'+("DESCRIPTION_EDITOR"==e.getDefaultPageType()?'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageToggleInternal">Tag/Untag as Internal</li>':"")+'<li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageToggle">Enable/Disable this page</li><li class="dropdown-item sTranslatable cPageMenuItem" data-action="PageDelete">Remove this page</li></ul></span><span class="cPageTabButtonLabel">'+n.Name+"</span></button></li>"}function i(e,t,n,a,o){const i=e.getKeyword();var s=e.pageCommentBuilder?'<div class="sCommentPanel d-flex flex-column" style="flex-basis:0;flex-grow: 0">'+e.pageCommentBuilder(t,n)+"</div>":"";return'<div class="cPageDiv tab-pane fade col-12 h-100 d-flex flex-column '+o+'" role="tabpanel"  data-hash='+t+' id="m'+i+"Page_"+t+'"  aria-labelledby="m'+i+"PageTab_"+t+'"><div class="sModelBorderedPanel tabContent d-flex flex-column" style="flex-grow:1">'+e.pageMainBuilder(t,n,a)+"</div>"+s+"</div>"}function s(e,t){const n=$(e.getMainPanelSelector()+" .cPageTabButton");var a=null;return n.each((function(){if($(this).data("hash")==t)return a=$(this),!1})),a}function r(e,t){const n=s(e,t);return n?n.closest("li"):null}function l(e){var t=e.data("name");e.data("internal")&&(t+=" (I)"),e.data("active")||(t+=" (D)");e.children(".cPageTabButtonLabel").first().text(t)}function c(t,n,a){const o=e.getDivPageByHash(t,n);o.attr("disabled",a),o.find("*").attr("disabled",a),t.disablePage&&t.disablePage(n,a)}function u(t,s){const l=s.relative_hash,c=l>=0?r(t,l):null;var u,d;const p=s.copy_hash>=0?t.getPageObject(s.copy_hash):null,m={Name:s.name,Active:!0,Internal:"false",Type:s.type};if(null==c){const n={disabled:"",active:" active show ",display:"",aria:"true"};u=$(o(t,s.hash,m,n)),d=$(i(t,s.hash,null,s.type," show active ")),$(t.getMainPanelSelector()).html(e.panelHTML(t,null)),$(t.getMainPanelSelector()+" .cPageTabs").append(u)}else{const e={disabled:"",active:"",display:" d-none ",aria:"false"};u=$(o(t,s.hash,m,e)),d=$(i(t,s.hash,p,s.type,"d-none")),"before"==s.relative_position?u.insertBefore(c):u.insertAfter(c)}$(t.getMainPanelSelector()+" .cAllPagesDivs").append(d),t.pageInitialization(d,p),u.on("click"," .cPageTabButton",(e=>{n($(e.target),t.getMainPanelSelector())})),u.on("click"," .cPageMenuItem",(e=>{a($(e.target),t)})),u.find(".cPageTabButton").trigger("click"),sMainGUI.setChanged()}function d(e,t){if(function(e,t,n){$(e.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==t)return $(this).data("name",n),l($(this)),!1}))}(e,t.hash,t.name),"as_is"!=t.relative_position){const n=r(e,t.hash),a=r(e,t.relative_hash);"before"==t.relative_position?n.insertBefore(a):n.insertAfter(a),e.reportableChange&&e.reportableChange("page relocated")}}function p(t,n,a,o){switch(n){case"PageNew":m(t,a,u,{type:o,edition:!1});break;case"PageEdit":m(t,a,d,{edition:!0});break;case"PageDelete":sMainConfirmationForm.show(e.getPageDivNameByHash(t,a),"Do you really want to delete this page?","Delete",(function(){!function(t,n){const a=r(t,n),o=e.getDivPageByHash(t,n),i=a.index();var s=null;$(t.getMainPanelSelector()+" .cAllPagesDivs").children().length>1&&(s=i>0?a.prev():a.next()),t.pageDeleted&&t.pageDeleted(o),a.remove(),o.remove(),s?s.find(".cPageTabButton").trigger("click"):t.setNoPages(),t.reportableChange&&t.reportableChange("page deleted")}(t,a)}));break;case"PageToggle":!function(e,t){const n=s(e,t);var a=!n.data("active");n.data("active",a),c(e,t,!a),l(n),e.reportableChange&&e.reportableChange("page enabled/disabled")}(t,a);break;case"PageToggleInternal":!function(e,t){$(e.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==t)return $(this).data("internal")?$(this).data("internal",!1):$(this).data("internal",!0),l($(this)),!1})),e.reportableChange&&e.reportableChange("page tagged/untagged internal")}(t,a)}}function m(t,n,a,o){const i=$(t.getMainPanelSelector()+" .cPageTabButton"),s=e.getDivPageByHash(t,n),r=o.edition?-1:function(e){var t=0;return $(e.getMainPanelSelector()+" .cPageTabButton").each((function(){t=Math.max(t,$(this).data("hash"))})),t+1}(t);var l="",c=s&&!o.edition;if(c){if(t.isPageSecondType){const e=o.type==t.getSecondType();c=e==t.isPageSecondType(s)}c&&(l='<div class="form-check mb-3"><input class="form-check-input" type="checkbox" value=""  name="mMainPageModalCopy" id="mMainPageModalCopy"><label class="form-check-label" for="mMainPageModalCopy">'+sMainResources.getString("Copy existing page")+"</label></div>")}const u='<div class="input-group mb-3 mt-3"><span class="input-group-text" id="mMainPageModalNameLabel">'+sMainResources.getString("Name")+'</span><input type="text" class="form-control" id="mMainPageModalNameField" '+(o.edition?'value="'+e.getPageDivNameByHash(t,n)+'" ':'value="'+sMainResources.getString(t.getPageName())+" "+r+'" ')+'placeholder="Page name here" aria-label="Page name" aria-describedby="mMainPageModalNameLabel"></div>'+l+function(e,t,n){if(0==e.length)return"";if(n&&1==e.length)return"";var a='<div class="mb-3"><label class="form-label">'+sMainResources.getString("Place it")+'</label><div class="input-group-text" id="mMainPageModalLocation">'+(n?'<span class="form-check form-check-inline"><input class="form-check-input" type="radio" checked  name="mMainPageModalLocationOptions" id="mMainPageModalLocationAsIs" value="as_is"><label class="form-check-label" for="mMainPageModalLocationAsIs">'+sMainResources.getString("As is")+"</label></span>":"")+'<span class="form-check form-check-inline"><input class="form-check-input" type="radio"  name="mMainPageModalLocationOptions" id="mMainPageModalLocationBefore" value="before"><label class="form-check-label" for="mMainPageModalLocationBefore">'+sMainResources.getString("Before")+'</label></span><span class="form-check form-check-inline"><input class="form-check-input" type="radio" '+(n?"":" checked ")+' name="mMainPageModalLocationOptions" id="mMainPageModalLocationAfter" value="after"><label class="form-check-label" for="mMainPageModalLocationAfter">'+sMainResources.getString("After")+'</label></span><select class="form-select" id="mMainPageModalLocationList">',o=!0;return e.each((function(){const e=$(this).data("hash");n?e!=t&&(a+='<option value="'+e+'"'+(o?" selected":"")+">"+$(this).data("name")+"</option>",o=!1):a+='<option value="'+e+'"'+(e==t?" selected":"")+">"+$(this).data("name")+"</option>"})),a+="</select></div></div>"}(i,n,o.edition),d='<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable "><div class="modal-content"><div class="modal-header bg-light text-dark">'+sMainGUI.getWebEJSLogoImg()+'<h5 class="text-primary modal-title">'+sMainResources.getString(o.edition?"Edit page":"Create page")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body">'+u+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary me-auto" data-action="Close">'+sMainResources.getString("Cancel")+'</button><button type="button" class="btn btn-primary"   data-action="Apply">'+sMainResources.getString("OK")+"</button></div></div></div>";$("#mMainPageModal").html(d);var p=new bootstrap.Modal(document.getElementById("mMainPageModal"));$("#mMainPageModal .modal-content button").click((function(e){const s=e.currentTarget.dataset.action;if(s)switch(s){case"Close":default:p.hide();break;case"Apply":p.hide(),o.name=$("#mMainPageModalNameField").val();var l=$("input[name=mMainPageModalLocationOptions]:checked");o.relative_position=l.length>0?l.val():"as_is",i.length>0?o.relative_hash=$("#mMainPageModalLocationList option:selected").val():o.relative_hash=-1,o.hash=o.edition?n:r,o.copy_hash=c&&$("#mMainPageModalCopy").is(":checked")?n:-1,a(t,o)}})),p.show()}return e.initPanel=function(o,i){const s=o.getMainPanelSelector();null==i||i.length<=0?$(s+" .sPanelNoPageBtn").on("click",(e=>{const t=$(e.target).closest(".sPanelNoPageBtn").data("type");p(o,"PageNew",-1,t)})):($(s+" .cPageDiv").each((function(){o.pageInitialization($(this),e.findUserPage($(this),i))})),$(s+" .cPageTabButton").on("click",(e=>{n($(e.target),s)})),$(s+" .cPageMenuItem").on("click",(e=>{a($(e.target),o)})),$(s+" .cPageTabButton").each((function(){const e=$(this).data("hash");c(o,e,!$(this).data("active")),l($(this))})),t(s,-1))},e.panelHTML=function(e,t){var n='<ul class="cPageTabs nav nav-pills justify-content-center" role="tablist" style="flex-grow:0; flex-basis:0;">';if(t)for(var a in t){var s=t[a],r=0==a?{active:" active ",display:"",aria:"true"}:{active:"",display:" d-none ",aria:"false"};const i=1*a+1;t[a].gui_hash=i,n+=o(e,i,s,r)}if(n+='</ul><div class="cAllPagesDivs tab-content d-flex flex-column" style="flex-grow:1;">',t)for(var a in t){const o=0==a?" show active ":"d-none";n+=i(e,1*a+1,t[a],t[a].Type,o)}return n+="</div>"},e.getAllPagesDetectedFiles=function(t){var n=[],a=e.getAllPagesHashList(t);for(var o in a){var i=a[o];n.push(...t.getPageDetectedFiles(i))}return n},e.getAllPagesObject=function(t){var n=[],a=e.getAllPagesHashList(t);for(var o in a){var i=a[o];n.push(t.getPageObject(i))}return n},e.getAllPagesHashList=function(e){var t=[];return $(e.getMainPanelSelector()+" .cPageTabButton").each((function(){t.push($(this).data("hash"))})),t},e.getAllPagesDivList=function(e){return $(e.getMainPanelSelector()+" .cPageDiv")},e.getPagesCount=function(e){return $(e.getMainPanelSelector()+" .cPageDiv").length},e.getDivPageByHash=function(e,t){var n=null;return $(e.getMainPanelSelector()+" .cPageDiv").each((function(){if($(this).data("hash")==t)return n=$(this),!1})),n},e.getPageDivNameByHash=function(e,t){var n="Unnamed";return $(e.getMainPanelSelector()+" .cPageTabButton").each((function(){if($(this).data("hash")==t)return n=$(this).data("name"),!1})),n},e.getPageDivName=function(t,n){return e.getPageDivNameByHash(t,e.getPageDivHash(n))},e.getPageDivHash=function(e){return e.data("hash")},e.findUserPage=function(t,n){return function(e,t){for(var n in e)if(e[n].gui_hash==t)return e[n];return null}(n,e.getPageDivHash(t))},e.getPageObject=function(t,n){const a=s(t,n);e.getDivPageByHash(t,n);return{Name:a.data("name"),Active:a.data("active")?"true":"false",Internal:a.data("internal")?"true":"false",Type:a.data("type")}},e.initializeCodeEditor=function(e,t,n,a){var o=ace.edit(e);return o.setTheme("ace/theme/xcode"),o.session.setMode("ace/mode/javascript"),o.resize(),o.on("blur",n),o.setValue(t,-1),o.clearSelection(),o},e.isPageDisabled=function(e,t){return t.attr("disabled")},WebEJS_TOOLS.sTabbedPanelSingleton=e,e},(WebEJS_TOOLS=WebEJS_TOOLS||{}).tablePanel=function(e){var t={},n=0,a=[],o=[];function i(t,a){n++;const i=s(t)+"_Row_"+n;return o.push([t,i,a]),'<tr class="cTableTr" data-hash="'+n+'"><td><input type="checkbox"/></td>'+e.getTableRowHTML(t,n,i)+"</tr>"}function s(t){return"m"+e.getKeyword()+"_Table_"+t}function r(e){return $("#"+s(e)+"_Body")}t.processRowsToSet=function(){for(var t=0;t<o.length;t++){var n=o[t];e.setTableRow(n[0],n[1],n[2])}o=[]},t.getRows=function(e){return $("#"+s(e)+"_Body .cTableTr")},t.getTableHTML=function(t,n,a){const o=s(t);0==a.length&&a.push(e.getTableEmptyRow());for(var r='<table id="'+o+'" class="table table-sm small">'+function(e,t){for(var n='<thead class="table-primary"><tr><th scope="col"><div class="dropdown"><button type="button" class="btn btn-link text-decoration-none dropdown-toggle" id="'+e+'_MenuButton" style="padding:0px 5px 0px 0px; border:0px; " data-bs-toggle="dropdown"aria-expanded="false"></button><ul class="dropdown-menu cTablePanelMenu" data-target="variables" aria-labelledby="'+e+'_MenuButton"><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="InsertBefore">Insert before</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="InsertAfter" >Insert after</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="MoveUp"      >Move up</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="MoveDown"    >Move down</li><li><hr class="dropdown-divider"></li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Cut"         >Cut</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Copy"        >Copy</li><li class="dropdown-item sTranslatable cTablePanelMenuItem" data-action="Paste"       >Paste</li></ul></div></th>',a=0;a<t.length;a++){const e=t[a];n+="class"in e?'<th class="sTranslatable '+e.class+'" scope="col">'+e.name+"</th>":'<th class="sTranslatable" scope="col">'+e.name+"</th>"}return n+"</tr></thead>"}(o,n)+'<tbody id="'+o+'_Body">',l=0;l<a.length;l++)r+=i(t,a[l]);return r+="</tbody></table>"},t.getTableRows=function(n,a){var o=[];return t.getRows(n).each((function(){const t=$(this).children();var n=e.getTableRowObject(t);a&&(n._tr_=$(this)),o.push(n)})),o};function l(a,o,s){const l=e.getTableEmptyRow(),c=r(a);var u=$(i(a,l));if(c.children().length<=0)c.append(u);else{const e=t.getRows(a);s?u.insertBefore(e.eq(o)):o>=0?u.insertAfter(e.eq(o)):c.append(u)}t.processRowsToSet(),e.tableRowInitialization(a,n,u),e.nonReportableChange("Empty row added")}function c(n,a,o){var i=null;const s=t.getRows(n);o?s.each((function(){a.includes($(this).index())?null!=i&&$(this).insertBefore(i):i=$(this)})):$(s.get().reverse()).each((function(){a.includes($(this).index())?null!=i&&$(this).insertAfter(i):i=$(this)})),e.reportableChange("Raw orders changed in page "+n)}function u(n,o,i){a=[];var s=[];t.getRows(n).each((function(){o.includes($(this).index())&&(a.push(e.getTableRowObject($(this).children())),i&&s.push($(this)))})),s.length>0&&function(t,n){for(var a=0;a<n.length;a++){const o=n[a];e.rowRemoved&&e.rowRemoved(t,o.data("hash")),o.remove()}e.reportableChange("Rows removed in page "+t)}(n,s)}return t.getText=function(e,t){return e[t].firstChild.value},t.setText=function(e,t,n){return e[t].firstChild.value=n},t.findRowTDArrayByHash=function(e,n){var a=null;return t.getRows(e).each((function(){if($(this).data("hash")==n)return a=$(this).children(),!1})),a},t.highlightRows=function(e,n){t.getRows(e).each((function(){$(this).data("hash")==n?$(this).css("background","lightGrey"):$(this).css("background","white")}))},t.removeWarnings=function(e){t.getRows(e).removeClass("bg-warning")},t.tableInitialization=function(o){t.getRows(o).each((function(){e.tableRowInitialization(o,$(this).data("hash"),$(this))})),$("#"+s(o)).find(".cTablePanelMenuItem").on("click",(s=>{!function(o,s,d){switch(console.log("Action "+s+" on page "+o+". Selection = "),console.log(d),s){case"InsertBefore":var p=0;d.length>0&&(p=d[0]),l(o,p,!0);break;case"InsertAfter":p=-1;d.length>0&&(p=d[d.length-1]),l(o,p,!1);break;case"MoveUp":c(o,d,!0);break;case"MoveDown":c(o,d,!1);break;case"Cut":u(o,d,!0);break;case"Copy":u(o,d,!1);break;case"Paste":!function(o,s){if(a.length<=0)return;var l=null;if(t.getRows(o).each((function(){s.includes($(this).index())&&(l=$(this))})),null==l){const t=r(o);for(var c=0;c<a.length;c++){var u=$(i(o,a[c]));t.append(u),e.tableRowInitialization(o,n,u)}}else for(c=0;c<a.length;c++){(u=$(i(o,a[c]))).insertAfter(l),e.tableRowInitialization(o,n,u),l=u}t.processRowsToSet(),e.reportableChange("Rows pasted in page "+o)}(o,d)}}(o,$(s.target).data("action"),function(e){var n=[];return t.getRows(e).each((function(){$(this).children()[0].firstChild.checked&&n.push($(this).index())})),n}(o))})),t.processRowsToSet()},t.appendEmptyRow=function(a){const o=e.getTableEmptyRow(),s=$(i(a,o));r(a).append(s),t.processRowsToSet(),e.tableRowInitialization(a,n,s)},t},(WebEJS_TOOLS=WebEJS_TOOLS||{}).sTextSingleton=null,WebEJS_TOOLS.textTools=function(){if(null!=WebEJS_TOOLS.sTextSingleton)return WebEJS_TOOLS.sTextSingleton;var e={};function t(e){var t=e.name.trim(),n=e.value.trim();if(t.length>0){var a=t.indexOf("[");if(a>0){if(just_name=t.substring(0,a),n.length<=0)return just_name+" = []";if(name_end=t.substring(a+1),(a=name_end.indexOf("]"))<=0)return"{ __i=0; "+just_name+" = []; "+just_name+"[__i] = "+n+" }";var o=name_end.substring(0,a).trim();if(o.length<=0)return"{ __i=0; "+just_name+" = []; "+just_name+"[__i] = "+n+" }";return"{ "+o+"=0; "+just_name+" = []; "+just_name+"["+o+"] = "+n+" }"}return n.length>0?t+" = "+n:t+" = undefined"}return n.length>0?n:""}function n(e,t,n){try{return e.appendCode(n),e.run(),!0}catch(e){return sMainGUI.println("INTERPRETER ERROR IN "+t.name+" = "+t.value+" : "+e.message),!1}}e.removeQuotes=function(e){for(;e.startsWith('"');)e=e.substring(1);for(;e.endsWith('"');)e=e.substring(0,e.length-1);return e},e.addQuotes=function(e){return e.startsWith('"')||(e='"'+e),e.endsWith('"')||(e+='"'),e},e.scapeQuotes=function(e){return e.replaceAll('"','\\"')},e.getCustomMethods=function(e,t){var n=[];const a=esprima.parseScript(t);if(console.log(a),!a.body)return n;for(var o in a.body){var i=a.body[o];if("FunctionDeclaration"==i.type){var s="";for(var r in i.params){s+=", "+i.params[r].name}s.startsWith(",")&&(s=s.substring(1).trim());const t=i.id.name+"("+s+")",a="// "+sMainResources.getString("Declared in page")+" "+e;n.push({name:t,description:a})}}return n};const a=void 0!==navigator&&navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i);return e.checkCode=function(e){var o=new Interpreter("_i=0;");for(var i in o.appendCode("_isPlaying = false;"),o.appendCode("_isPaused = true;"),o.appendCode("_isEPub = false;"),o.appendCode("_isMobile = "+a),e){const a=e[i];try{var s=a.name.trim();if(s.length>0){var r=s.indexOf("[");if(r>0&&(s=s.substring(0,r)),o.appendCode("typeof "+s+' === "undefined"'),o.run(),0==o.value){a.run_ok=!1;continue}}const e=t(a);a.run_ok=!(e.length>0)||n(o,a,e)}catch(e){a.run_ok=!1}}return e},WebEJS_TOOLS.sTextSingleton=e,e};